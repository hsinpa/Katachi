var w=1e-6,P=typeof Float32Array!="undefined"?Float32Array:Array,B=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Ir(){var e=new P(9);return P!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function te(){var e=new P(16);return P!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ke(e){var t=new P(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Dr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Me(e,t,r,i,n,a,s,o,l,h,f,d,c,u,p,m){var v=new P(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=i,v[4]=n,v[5]=a,v[6]=s,v[7]=o,v[8]=l,v[9]=h,v[10]=f,v[11]=d,v[12]=c,v[13]=u,v[14]=p,v[15]=m,v}function Ur(e,t,r,i,n,a,s,o,l,h,f,d,c,u,p,m,v){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=h,e[9]=f,e[10]=d,e[11]=c,e[12]=u,e[13]=p,e[14]=m,e[15]=v,e}function Xe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lr(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Nr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],f=t[8],d=t[9],c=t[10],u=t[11],p=t[12],m=t[13],v=t[14],x=t[15],A=r*o-i*s,y=r*l-n*s,T=r*h-a*s,g=i*l-n*o,E=i*h-a*o,U=n*h-a*l,b=f*m-d*p,I=f*v-c*p,D=f*x-u*p,L=d*v-c*m,N=d*x-u*m,z=c*x-u*v,R=A*z-y*N+T*L+g*D-E*I+U*b;return R?(R=1/R,e[0]=(o*z-l*N+h*L)*R,e[1]=(n*N-i*z-a*L)*R,e[2]=(m*U-v*E+x*g)*R,e[3]=(c*E-d*U-u*g)*R,e[4]=(l*D-s*z-h*I)*R,e[5]=(r*z-n*D+a*I)*R,e[6]=(v*T-p*U-x*y)*R,e[7]=(f*U-c*T+u*y)*R,e[8]=(s*N-o*D+h*b)*R,e[9]=(i*D-r*N-a*b)*R,e[10]=(p*E-m*T+x*A)*R,e[11]=(d*T-f*E-u*A)*R,e[12]=(o*I-s*L-l*b)*R,e[13]=(r*L-i*I+n*b)*R,e[14]=(m*y-p*g-v*A)*R,e[15]=(f*g-d*y+c*A)*R,e):null}function zr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],f=t[8],d=t[9],c=t[10],u=t[11],p=t[12],m=t[13],v=t[14],x=t[15];return e[0]=o*(c*x-u*v)-d*(l*x-h*v)+m*(l*u-h*c),e[1]=-(i*(c*x-u*v)-d*(n*x-a*v)+m*(n*u-a*c)),e[2]=i*(l*x-h*v)-o*(n*x-a*v)+m*(n*h-a*l),e[3]=-(i*(l*u-h*c)-o*(n*u-a*c)+d*(n*h-a*l)),e[4]=-(s*(c*x-u*v)-f*(l*x-h*v)+p*(l*u-h*c)),e[5]=r*(c*x-u*v)-f*(n*x-a*v)+p*(n*u-a*c),e[6]=-(r*(l*x-h*v)-s*(n*x-a*v)+p*(n*h-a*l)),e[7]=r*(l*u-h*c)-s*(n*u-a*c)+f*(n*h-a*l),e[8]=s*(d*x-u*m)-f*(o*x-h*m)+p*(o*u-h*d),e[9]=-(r*(d*x-u*m)-f*(i*x-a*m)+p*(i*u-a*d)),e[10]=r*(o*x-h*m)-s*(i*x-a*m)+p*(i*h-a*o),e[11]=-(r*(o*u-h*d)-s*(i*u-a*d)+f*(i*h-a*o)),e[12]=-(s*(d*v-c*m)-f*(o*v-l*m)+p*(o*c-l*d)),e[13]=r*(d*v-c*m)-f*(i*v-n*m)+p*(i*c-n*d),e[14]=-(r*(o*v-l*m)-s*(i*v-n*m)+p*(i*l-n*o)),e[15]=r*(o*c-l*d)-s*(i*c-n*d)+f*(i*l-n*o),e}function Vr(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],f=e[9],d=e[10],c=e[11],u=e[12],p=e[13],m=e[14],v=e[15],x=t*s-r*a,A=t*o-i*a,y=t*l-n*a,T=r*o-i*s,g=r*l-n*s,E=i*l-n*o,U=h*p-f*u,b=h*m-d*u,I=h*v-c*u,D=f*m-d*p,L=f*v-c*p,N=d*v-c*m;return x*N-A*L+y*D+T*I-g*b+E*U}function ce(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],f=t[7],d=t[8],c=t[9],u=t[10],p=t[11],m=t[12],v=t[13],x=t[14],A=t[15],y=r[0],T=r[1],g=r[2],E=r[3];return e[0]=y*i+T*o+g*d+E*m,e[1]=y*n+T*l+g*c+E*v,e[2]=y*a+T*h+g*u+E*x,e[3]=y*s+T*f+g*p+E*A,y=r[4],T=r[5],g=r[6],E=r[7],e[4]=y*i+T*o+g*d+E*m,e[5]=y*n+T*l+g*c+E*v,e[6]=y*a+T*h+g*u+E*x,e[7]=y*s+T*f+g*p+E*A,y=r[8],T=r[9],g=r[10],E=r[11],e[8]=y*i+T*o+g*d+E*m,e[9]=y*n+T*l+g*c+E*v,e[10]=y*a+T*h+g*u+E*x,e[11]=y*s+T*f+g*p+E*A,y=r[12],T=r[13],g=r[14],E=r[15],e[12]=y*i+T*o+g*d+E*m,e[13]=y*n+T*l+g*c+E*v,e[14]=y*a+T*h+g*u+E*x,e[15]=y*s+T*f+g*p+E*A,e}function ye(e,t,r){var i=r[0],n=r[1],a=r[2],s,o,l,h,f,d,c,u,p,m,v,x;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],l=t[2],h=t[3],f=t[4],d=t[5],c=t[6],u=t[7],p=t[8],m=t[9],v=t[10],x=t[11],e[0]=s,e[1]=o,e[2]=l,e[3]=h,e[4]=f,e[5]=d,e[6]=c,e[7]=u,e[8]=p,e[9]=m,e[10]=v,e[11]=x,e[12]=s*i+f*n+p*a+t[12],e[13]=o*i+d*n+m*a+t[13],e[14]=l*i+c*n+v*a+t[14],e[15]=h*i+u*n+x*a+t[15]),e}function Te(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Fr(e,t,r,i){var n=i[0],a=i[1],s=i[2],o=Math.hypot(n,a,s),l,h,f,d,c,u,p,m,v,x,A,y,T,g,E,U,b,I,D,L,N,z,R,j;return o<w?null:(o=1/o,n*=o,a*=o,s*=o,l=Math.sin(r),h=Math.cos(r),f=1-h,d=t[0],c=t[1],u=t[2],p=t[3],m=t[4],v=t[5],x=t[6],A=t[7],y=t[8],T=t[9],g=t[10],E=t[11],U=n*n*f+h,b=a*n*f+s*l,I=s*n*f-a*l,D=n*a*f-s*l,L=a*a*f+h,N=s*a*f+n*l,z=n*s*f+a*l,R=a*s*f-n*l,j=s*s*f+h,e[0]=d*U+m*b+y*I,e[1]=c*U+v*b+T*I,e[2]=u*U+x*b+g*I,e[3]=p*U+A*b+E*I,e[4]=d*D+m*L+y*N,e[5]=c*D+v*L+T*N,e[6]=u*D+x*L+g*N,e[7]=p*D+A*L+E*N,e[8]=d*z+m*R+y*j,e[9]=c*z+v*R+T*j,e[10]=u*z+x*R+g*j,e[11]=p*z+A*R+E*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Or(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],f=t[9],d=t[10],c=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+h*i,e[5]=s*n+f*i,e[6]=o*n+d*i,e[7]=l*n+c*i,e[8]=h*n-a*i,e[9]=f*n-s*i,e[10]=d*n-o*i,e[11]=c*n-l*i,e}function jr(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],h=t[8],f=t[9],d=t[10],c=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-h*i,e[1]=s*n-f*i,e[2]=o*n-d*i,e[3]=l*n-c*i,e[8]=a*i+h*n,e[9]=s*i+f*n,e[10]=o*i+d*n,e[11]=l*i+c*n,e}function Br(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],h=t[4],f=t[5],d=t[6],c=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+h*i,e[1]=s*n+f*i,e[2]=o*n+d*i,e[3]=l*n+c*i,e[4]=h*n-a*i,e[5]=f*n-s*i,e[6]=d*n-o*i,e[7]=c*n-l*i,e}function Gr(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function $r(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qr(e,t,r){var i=r[0],n=r[1],a=r[2],s=Math.hypot(i,n,a),o,l,h;return s<w?null:(s=1/s,i*=s,n*=s,a*=s,o=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=i*i*h+l,e[1]=n*i*h+a*o,e[2]=a*i*h-n*o,e[3]=0,e[4]=i*n*h-a*o,e[5]=n*n*h+l,e[6]=a*n*h+i*o,e[7]=0,e[8]=i*a*h+n*o,e[9]=n*a*h-i*o,e[10]=a*a*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function kr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function We(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=i+i,l=n+n,h=a+a,f=i*o,d=i*l,c=i*h,u=n*l,p=n*h,m=a*h,v=s*o,x=s*l,A=s*h;return e[0]=1-(u+m),e[1]=d+A,e[2]=c-x,e[3]=0,e[4]=d-A,e[5]=1-(f+m),e[6]=p+v,e[7]=0,e[8]=c+x,e[9]=p-v,e[10]=1-(f+u),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Qr(e,t){var r=new P(3),i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],h=t[6],f=t[7],d=i*i+n*n+a*a+s*s;return d>0?(r[0]=(o*s+f*i+l*a-h*n)*2/d,r[1]=(l*s+f*n+h*i-o*a)*2/d,r[2]=(h*s+f*a+o*n-l*i)*2/d):(r[0]=(o*s+f*i+l*a-h*n)*2,r[1]=(l*s+f*n+h*i-o*a)*2,r[2]=(h*s+f*a+o*n-l*i)*2),We(e,t,r),e}function Yr(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Qe(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],h=t[9],f=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(l,h,f),e}function Kr(e,t){var r=new P(3);Qe(r,t);var i=1/r[0],n=1/r[1],a=1/r[2],s=t[0]*i,o=t[1]*n,l=t[2]*a,h=t[4]*i,f=t[5]*n,d=t[6]*a,c=t[8]*i,u=t[9]*n,p=t[10]*a,m=s+f+p,v=0;return m>0?(v=Math.sqrt(m+1)*2,e[3]=.25*v,e[0]=(d-u)/v,e[1]=(c-l)/v,e[2]=(o-h)/v):s>f&&s>p?(v=Math.sqrt(1+s-f-p)*2,e[3]=(d-u)/v,e[0]=.25*v,e[1]=(o+h)/v,e[2]=(c+l)/v):f>p?(v=Math.sqrt(1+f-s-p)*2,e[3]=(c-l)/v,e[0]=(o+h)/v,e[1]=.25*v,e[2]=(d+u)/v):(v=Math.sqrt(1+p-s-f)*2,e[3]=(o-h)/v,e[0]=(c+l)/v,e[1]=(d+u)/v,e[2]=.25*v),e}function Hr(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,h=a+a,f=s+s,d=n*l,c=n*h,u=n*f,p=a*h,m=a*f,v=s*f,x=o*l,A=o*h,y=o*f,T=i[0],g=i[1],E=i[2];return e[0]=(1-(p+v))*T,e[1]=(c+y)*T,e[2]=(u-A)*T,e[3]=0,e[4]=(c-y)*g,e[5]=(1-(d+v))*g,e[6]=(m+x)*g,e[7]=0,e[8]=(u+A)*E,e[9]=(m-x)*E,e[10]=(1-(d+p))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Zr(e,t,r,i,n){var a=t[0],s=t[1],o=t[2],l=t[3],h=a+a,f=s+s,d=o+o,c=a*h,u=a*f,p=a*d,m=s*f,v=s*d,x=o*d,A=l*h,y=l*f,T=l*d,g=i[0],E=i[1],U=i[2],b=n[0],I=n[1],D=n[2],L=(1-(m+x))*g,N=(u+T)*g,z=(p-y)*g,R=(u-T)*E,j=(1-(c+x))*E,J=(v+A)*E,ee=(p+y)*U,$e=(v-A)*U,qe=(1-(c+m))*U;return e[0]=L,e[1]=N,e[2]=z,e[3]=0,e[4]=R,e[5]=j,e[6]=J,e[7]=0,e[8]=ee,e[9]=$e,e[10]=qe,e[11]=0,e[12]=r[0]+b-(L*b+R*I+ee*D),e[13]=r[1]+I-(N*b+j*I+$e*D),e[14]=r[2]+D-(z*b+J*I+qe*D),e[15]=1,e}function _e(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,h=r*s,f=i*s,d=i*o,c=n*s,u=n*o,p=n*l,m=a*s,v=a*o,x=a*l;return e[0]=1-d-p,e[1]=f+x,e[2]=c-v,e[3]=0,e[4]=f-x,e[5]=1-h-p,e[6]=u+m,e[7]=0,e[8]=c+v,e[9]=u-m,e[10]=1-h-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Jr(e,t,r,i,n,a,s){var o=1/(r-t),l=1/(n-i),h=1/(a-s);return e[0]=a*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(s+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*h,e[15]=0,e}function en(e,t,r,i,n){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==Infinity?(s=1/(i-n),e[10]=(n+i)*s,e[14]=2*n*i*s):(e[10]=-1,e[14]=-2*i),e}function tn(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),h=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((s-o)*l*.5),e[9]=(n-a)*h*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function rn(e,t,r,i,n,a,s){var o=1/(t-r),l=1/(i-n),h=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*h,e[15]=1,e}function nn(e,t,r,i){var n,a,s,o,l,h,f,d,c,u,p=t[0],m=t[1],v=t[2],x=i[0],A=i[1],y=i[2],T=r[0],g=r[1],E=r[2];return Math.abs(p-T)<w&&Math.abs(m-g)<w&&Math.abs(v-E)<w?Xe(e):(f=p-T,d=m-g,c=v-E,u=1/Math.hypot(f,d,c),f*=u,d*=u,c*=u,n=A*c-y*d,a=y*f-x*c,s=x*d-A*f,u=Math.hypot(n,a,s),u?(u=1/u,n*=u,a*=u,s*=u):(n=0,a=0,s=0),o=d*s-c*a,l=c*n-f*s,h=f*a-d*n,u=Math.hypot(o,l,h),u?(u=1/u,o*=u,l*=u,h*=u):(o=0,l=0,h=0),e[0]=n,e[1]=o,e[2]=f,e[3]=0,e[4]=a,e[5]=l,e[6]=d,e[7]=0,e[8]=s,e[9]=h,e[10]=c,e[11]=0,e[12]=-(n*p+a*m+s*v),e[13]=-(o*p+l*m+h*v),e[14]=-(f*p+d*m+c*v),e[15]=1,e)}function an(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=i[0],l=i[1],h=i[2],f=n-r[0],d=a-r[1],c=s-r[2],u=f*f+d*d+c*c;u>0&&(u=1/Math.sqrt(u),f*=u,d*=u,c*=u);var p=l*c-h*d,m=h*f-o*c,v=o*d-l*f;return u=p*p+m*m+v*v,u>0&&(u=1/Math.sqrt(u),p*=u,m*=u,v*=u),e[0]=p,e[1]=m,e[2]=v,e[3]=0,e[4]=d*v-c*m,e[5]=c*p-f*v,e[6]=f*m-d*p,e[7]=0,e[8]=f,e[9]=d,e[10]=c,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function sn(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function on(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ln(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ye(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function hn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function fn(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function cn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function un(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],f=e[8],d=e[9],c=e[10],u=e[11],p=e[12],m=e[13],v=e[14],x=e[15],A=t[0],y=t[1],T=t[2],g=t[3],E=t[4],U=t[5],b=t[6],I=t[7],D=t[8],L=t[9],N=t[10],z=t[11],R=t[12],j=t[13],J=t[14],ee=t[15];return Math.abs(r-A)<=w*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(i-y)<=w*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-T)<=w*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-g)<=w*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-E)<=w*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-U)<=w*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(l-b)<=w*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(h-I)<=w*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(f-D)<=w*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(d-L)<=w*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(c-N)<=w*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(u-z)<=w*Math.max(1,Math.abs(u),Math.abs(z))&&Math.abs(p-R)<=w*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-j)<=w*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(v-J)<=w*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(x-ee)<=w*Math.max(1,Math.abs(x),Math.abs(ee))}var dn=ce,pn=Ye,C=Object.freeze({__proto__:null,create:te,clone:ke,copy:Dr,fromValues:Me,set:Ur,identity:Xe,transpose:Lr,invert:Nr,adjoint:zr,determinant:Vr,multiply:ce,translate:ye,scale:Te,rotate:Fr,rotateX:Or,rotateY:jr,rotateZ:Br,fromTranslation:Gr,fromScaling:$r,fromRotation:qr,fromXRotation:kr,fromYRotation:Xr,fromZRotation:Wr,fromRotationTranslation:We,fromQuat2:Qr,getTranslation:Yr,getScaling:Qe,getRotation:Kr,fromRotationTranslationScale:Hr,fromRotationTranslationScaleOrigin:Zr,fromQuat:_e,frustum:Jr,perspective:en,perspectiveFromFieldOfView:tn,ortho:rn,lookAt:nn,targetTo:an,str:sn,frob:on,add:ln,subtract:Ye,multiplyScalar:hn,multiplyScalarAndAdd:fn,exactEquals:cn,equals:un,mul:dn,sub:pn});function ue(){var e=new P(3);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vn(e){var t=new P(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ke(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function q(e,t,r){var i=new P(3);return i[0]=e,i[1]=t,i[2]=r,i}function mn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xn(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Mn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function He(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Ze(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Je(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function yn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Tn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function _n(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function gn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function En(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Sn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function An(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function et(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function tt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function rt(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function wn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Rn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function nt(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function ge(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function de(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=n*l-a*o,e[1]=a*s-i*l,e[2]=i*o-n*s,e}function it(e,t,r,i){var n=t[0],a=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e}function Cn(e,t,r,i,n,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,h=s*(a-1),f=s*(3-2*a);return e[0]=t[0]*o+r[0]*l+i[0]*h+n[0]*f,e[1]=t[1]*o+r[1]*l+i[1]*h+n[1]*f,e[2]=t[2]*o+r[2]*l+i[2]*h+n[2]*f,e}function Pn(e,t,r,i,n,a){var s=1-a,o=s*s,l=a*a,h=o*s,f=3*a*o,d=3*l*s,c=l*a;return e[0]=t[0]*h+r[0]*f+i[0]*d+n[0]*c,e[1]=t[1]*h+r[1]*f+i[1]*d+n[1]*c,e[2]=t[2]*h+r[2]*f+i[2]*d+n[2]*c,e}function bn(e,t){t=t||1;var r=B()*2*Math.PI,i=B()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function In(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,e}function Dn(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e}function Un(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],l=t[1],h=t[2],f=n*h-a*l,d=a*o-i*h,c=i*l-n*o,u=n*c-a*d,p=a*f-i*c,m=i*d-n*f,v=s*2;return f*=v,d*=v,c*=v,u*=2,p*=2,m*=2,e[0]=o+f+u,e[1]=l+d+p,e[2]=h+c+m,e}function Ln(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Nn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function zn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Vn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt(r*r+i*i+n*n),h=Math.sqrt(a*a+s*s+o*o),f=l*h,d=f&&ge(e,t)/f;return Math.acos(Math.min(Math.max(d,-1),1))}function Fn(e){return e[0]=0,e[1]=0,e[2]=0,e}function On(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function jn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Bn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=w*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=w*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=w*Math.max(1,Math.abs(n),Math.abs(o))}var Gn=He,$n=Ze,qn=Je,kn=et,Xn=tt,at=Ke,Wn=rt,Qn=function(){var e=ue();return function(t,r,i,n,a,s){var o,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}(),M=Object.freeze({__proto__:null,create:ue,clone:vn,length:Ke,fromValues:q,copy:mn,set:xn,add:Mn,subtract:He,multiply:Ze,divide:Je,ceil:yn,floor:Tn,min:_n,max:gn,round:En,scale:Sn,scaleAndAdd:An,distance:et,squaredDistance:tt,squaredLength:rt,negate:wn,inverse:Rn,normalize:nt,dot:ge,cross:de,lerp:it,hermite:Cn,bezier:Pn,random:bn,transformMat4:In,transformMat3:Dn,transformQuat:Un,rotateX:Ln,rotateY:Nn,rotateZ:zn,angle:Vn,zero:Fn,str:On,exactEquals:jn,equals:Bn,sub:Gn,mul:$n,div:qn,dist:kn,sqrDist:Xn,len:at,sqrLen:Wn,forEach:Qn});function st(){var e=new P(4);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ot(e){var t=new P(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function re(e,t,r,i){var n=new P(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function lt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ht(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function ft(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ct(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function ut(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function dt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Yn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Kn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Hn(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Zn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Jn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function pt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ei(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function vt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,i,n,a)}function mt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function Ee(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function Se(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function ti(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ri(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function xt(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=a*s,e}function Mt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ni(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],f=t[0],d=t[1],c=t[2],u=t[3];return e[0]=d*h-c*l+u*o,e[1]=-(f*h)+c*s-u*a,e[2]=f*l-d*s+u*n,e[3]=-(f*o)+d*a-c*n,e}function yt(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e}function ii(e,t){t=t||1;var r,i,n,a,s,o;do r=B()*2-1,i=B()*2-1,s=r*r+i*i;while(s>=1);do n=B()*2-1,a=B()*2-1,o=n*n+a*a;while(o>=1);var l=Math.sqrt((1-s)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*a*l,e}function ai(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,e}function si(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2],h=r[3],f=h*i+o*a-l*n,d=h*n+l*i-s*a,c=h*a+s*n-o*i,u=-s*i-o*n-l*a;return e[0]=f*h+u*-s+d*-l-c*-o,e[1]=d*h+u*-o+c*-s-f*-l,e[2]=c*h+u*-l+f*-o-d*-s,e[3]=t[3],e}function oi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function li(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Tt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _t(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(r-s)<=w*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=w*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-h)<=w*Math.max(1,Math.abs(a),Math.abs(h))}var hi=ct,fi=ut,ci=dt,ui=vt,di=mt,pi=Ee,vi=Se,mi=function(){var e=st();return function(t,r,i,n,a,s){var o,l;for(r||(r=4),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}(),ne=Object.freeze({__proto__:null,create:st,clone:ot,fromValues:re,copy:lt,set:ht,add:ft,subtract:ct,multiply:ut,divide:dt,ceil:Yn,floor:Kn,min:Hn,max:Zn,round:Jn,scale:pt,scaleAndAdd:ei,distance:vt,squaredDistance:mt,length:Ee,squaredLength:Se,negate:ti,inverse:ri,normalize:xt,dot:Mt,cross:ni,lerp:yt,random:ii,transformMat4:ai,transformQuat:si,zero:oi,str:li,exactEquals:Tt,equals:_t,sub:hi,mul:fi,div:ci,dist:ui,sqrDist:di,len:pi,sqrLen:vi,forEach:mi});function pe(){var e=new P(4);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function gt(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Mi(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>w?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function yi(e,t){var r=Et(e,t);return Math.acos(2*r*r-1)}function St(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],l=r[1],h=r[2],f=r[3];return e[0]=i*f+s*o+n*h-a*l,e[1]=n*f+s*l+a*o-i*h,e[2]=a*f+s*h+i*l-n*o,e[3]=s*f-i*o-n*l-a*h,e}function Ti(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=s*l-i*o,e}function _i(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*o,e[1]=n*l+s*o,e[2]=a*l+i*o,e[3]=s*l-n*o,e}function gi(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e}function Ei(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function At(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=Math.exp(a),l=s>0?o*Math.sin(s)/s:0;return e[0]=r*l,e[1]=i*l,e[2]=n*l,e[3]=o*Math.cos(s),e}function wt(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=s>0?Math.atan2(s,a)/s:0;return e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=.5*Math.log(r*r+i*i+n*n+a*a),e}function Si(e,t,r){return wt(e,t),Rt(e,e,r),At(e,e),e}function ie(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],l=r[0],h=r[1],f=r[2],d=r[3],c,u,p,m,v;return u=n*l+a*h+s*f+o*d,u<0&&(u=-u,l=-l,h=-h,f=-f,d=-d),1-u>w?(c=Math.acos(u),p=Math.sin(c),m=Math.sin((1-i)*c)/p,v=Math.sin(i*c)/p):(m=1-i,v=i),e[0]=m*n+v*l,e[1]=m*a+v*h,e[2]=m*s+v*f,e[3]=m*o+v*d,e}function Ai(e){var t=B(),r=B(),i=B(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function wi(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e}function Ri(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Ct(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[a*3+a]-t[s*3+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[a*3+s]-t[s*3+a])*i,e[a]=(t[a*3+n]+t[n*3+a])*i,e[s]=(t[s*3+n]+t[n*3+s])*i}return e}function Ci(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),l=Math.cos(r),h=Math.sin(i),f=Math.cos(i);return e[0]=a*l*f-s*o*h,e[1]=s*o*f+a*l*h,e[2]=s*l*h-a*o*f,e[3]=s*l*f+a*o*h,e}function Pi(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var bi=ot,ve=re,Ii=lt,Di=ht,Ui=ft,Li=St,Rt=pt,Et=Mt,Ni=yt,Pt=Ee,zi=Pt,bt=Se,Vi=bt,Ae=xt,Fi=Tt,Oi=_t,ji=function(){var e=ue(),t=q(1,0,0),r=q(0,1,0);return function(i,n,a){var s=ge(n,a);return s<-.999999?(de(e,t,n),at(e)<1e-6&&de(e,r,n),nt(e,e),gt(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(de(e,n,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Ae(i,i))}}(),Bi=function(){var e=pe(),t=pe();return function(r,i,n,a,s,o){return ie(e,i,s,o),ie(t,n,a,o),ie(r,e,t,2*o*(1-o)),r}}(),Gi=function(){var e=Ir();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Ae(t,Ct(t,e))}}(),$=Object.freeze({__proto__:null,create:pe,identity:xi,setAxisAngle:gt,getAxisAngle:Mi,getAngle:yi,multiply:St,rotateX:Ti,rotateY:_i,rotateZ:gi,calculateW:Ei,exp:At,ln:wt,pow:Si,slerp:ie,random:Ai,invert:wi,conjugate:Ri,fromMat3:Ct,fromEuler:Ci,str:Pi,clone:bi,fromValues:ve,copy:Ii,set:Di,add:Ui,mul:Li,scale:Rt,dot:Et,lerp:Ni,length:Pt,len:zi,squaredLength:bt,sqrLen:Vi,normalize:Ae,exactEquals:Fi,equals:Oi,rotationTo:ji,sqlerp:Bi,setAxes:Gi});function It(){var e=new P(2);return P!=Float32Array&&(e[0]=0,e[1]=0),e}function $i(e){var t=new P(2);return t[0]=e[0],t[1]=e[1],t}function qi(e,t){var r=new P(2);return r[0]=e,r[1]=t,r}function ki(e,t){return e[0]=t[0],e[1]=t[1],e}function Xi(e,t,r){return e[0]=t,e[1]=r,e}function Wi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Dt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ut(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Lt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Qi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Yi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Ki(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Hi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Zi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Ji(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function ea(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function Nt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function zt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Vt(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Ft(e){var t=e[0],r=e[1];return t*t+r*r}function ta(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ra(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function na(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function ia(e,t){return e[0]*t[0]+e[1]*t[1]}function aa(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function sa(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e}function oa(e,t){t=t||1;var r=B()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function la(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function ha(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function fa(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function ca(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function ua(e,t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=n*o-a*s+r[0],e[1]=n*s+a*o+r[1],e}function da(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),o=s&&(r*n+i*a)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function pa(e){return e[0]=0,e[1]=0,e}function va(e){return"vec2("+e[0]+", "+e[1]+")"}function ma(e,t){return e[0]===t[0]&&e[1]===t[1]}function xa(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=w*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))}var Ma=Vt,ya=Dt,Ta=Ut,_a=Lt,ga=Nt,Ea=zt,Sa=Ft,Aa=function(){var e=It();return function(t,r,i,n,a,s){var o,l;for(r||(r=2),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}(),F=Object.freeze({__proto__:null,create:It,clone:$i,fromValues:qi,copy:ki,set:Xi,add:Wi,subtract:Dt,multiply:Ut,divide:Lt,ceil:Qi,floor:Yi,min:Ki,max:Hi,round:Zi,scale:Ji,scaleAndAdd:ea,distance:Nt,squaredDistance:zt,length:Vt,squaredLength:Ft,negate:ta,inverse:ra,normalize:na,dot:ia,cross:aa,lerp:sa,random:oa,transformMat2:la,transformMat2d:ha,transformMat3:fa,transformMat4:ca,rotate:ua,angle:da,zero:pa,str:va,exactEquals:ma,equals:xa,len:Ma,sub:ya,mul:Ta,div:_a,dist:ga,sqrDist:Ea,sqrLen:Sa,forEach:Aa});var O=Object.freeze({up:"up",down:"down",left:"left",right:"right"}),ae=Object.create({w:O.up,s:O.down,d:O.right,a:O.left,ArrowUp:O.up,ArrowDown:O.down,ArrowRight:O.right,ArrowLeft:O.left});var me=Object.freeze({Up:F.fromValues(0,1),Down:F.fromValues(0,-1),Left:F.fromValues(-1,0),Right:F.fromValues(1,0),Center:F.fromValues(0,0)}),Ot=class{constructor(){this._buttonState=Object.create({}),this._cacheKeyboardDirection=F.create()}GetButtonState(t){return!1}RegisterButtonEvent(t){window.addEventListener("click",r=>{t()})}RegisterMouseMovement(t,r){t.requestPointerLock();let i=[0,0];window.addEventListener("mousemove",n=>{i[0]=n.movementX,i[1]=n.movementY,r(i)})}RegisterMovementEvent(t){let r=this;this._keyboardCallback=t,window.addEventListener("keydown",i=>{i.key in ae&&this.SetKeyboardState(ae[i.key],!0)}),window.addEventListener("keyup",i=>{i.key in ae&&this.SetKeyboardState(ae[i.key],!1)})}OnUpdate(){this._cacheKeyboardDirection[0]=0,this._cacheKeyboardDirection[1]=0,this._buttonState.hasOwnProperty(O.left)&&F.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Left),this._buttonState.hasOwnProperty(O.down)&&F.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Down),this._buttonState.hasOwnProperty(O.right)&&F.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Right),this._buttonState.hasOwnProperty(O.up)&&F.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Up),this._keyboardCallback(this._cacheKeyboardDirection)}SetKeyboardState(t,r){r?this._buttonState[t]=!0:delete this._buttonState[t]}},jt=Ot;var we=.02;var Re=class{constructor(){this.gltfCache={}}async LoadGLTFContent(t,r){let i=r.gltf.map(s=>t.shapeBuilder.BuildGLTFShape(s.id,s.path)),n=this,a=r.gltf.length;for(let s=0;s<a;s++){let o=await i[s];n.SetGLTFToConfigLayout(t,r.gltf[s],o)}}GetGLTFShapeObject(t){return this.gltfCache.hasOwnProperty(t)?this.gltfCache[t]:null}ClearUp(){this.gltfCache={}}SetGLTFToConfigLayout(t,r,i){this.gltfCache[r.id]=i;let n=this.GetGLTFShapeObject(r.parent_id);i.transform.Scale(r.scale),i.transform.SetEuler(r.orientation[0],r.orientation[1],r.orientation[2]),i.transform.SetPosition(r.position[0],r.position[1],r.position[2]),t.scene.AddShapeObj(i),n!=null&&t.scene.SetParent(n,i)}},Bt=Re;var Gt=class{constructor(){this.sceneIsReady=!1,this.inputHandler=new jt,this.inputHandler.RegisterMovementEvent(this.OnMovementEvent.bind(this)),this.inputHandler.RegisterButtonEvent(this.OnMouseClickEvent.bind(this)),this.sceneLoader=new Bt}async SetUp(t,r){this.katachi=t;let i=await t.SetUp(this.UpdateLoop.bind(this)),n=document.querySelector("#webgl_canvas");i&&(this.inputHandler.RegisterMouseMovement(n,this.OnMouseEvent.bind(this)),await this.sceneLoader.LoadGLTFContent(t,r),this.mainCube=t.shapeBuilder.BuildCube(),this.mainCubeTwo=t.shapeBuilder.BuildCube(),this.mainCube.transform.SetPosition(0,-.2,-2),this.mainCube.transform.Scale(.3),this.mainCubeTwo.transform.Scale(.1),this.mainCubeTwo.transform.SetPosition(0,-.3,-1),t.scene.SetParent(this.mainCube,this.mainCubeTwo),t.scene.AddShapeObj(this.mainCube),t.scene.AddShapeObj(this.mainCubeTwo),this.katachi.materialManager.LoadTextureToObject(this.mainCube,"u_mainTex","./texture/Personal_01.png"),this.mainCube.SetCustomUniformAttr("u_mainColor",{value:[1,1,1,1],isMatrix:!1,function:this.katachi.webglContext.uniform4fv}),this.sceneIsReady=!0)}OnMovementEvent(t){if(!this.sceneIsReady)return;let i=.02;this.katachi.scene.camera.transform.Translate(-t[0]*i,0,t[1]*i)}OnMouseEvent(t){let r=.3,i=this.katachi.scene.camera.transform.rotation;this.katachi.scene.camera.transform.SetEuler(i[0]+t[0]*we*r,i[1]-t[1]*we*r,i[2]);let n=.5*Math.PI;i[1]>n&&this.katachi.scene.camera.transform.SetEuler(i[0],n,i[2]),this.katachi.scene.camera.transform.rotation[1]<-n&&this.katachi.scene.camera.transform.SetEuler(i[0],-n,i[2])}OnMouseClickEvent(){let t=this.mainCubeTwo.transform.parent==null?this.mainCube.transform:null;console.log(t),this.mainCubeTwo.transform.SetParent(t)}UpdateLoop(t){this.inputHandler.OnUpdate(),!!this.sceneIsReady&&this.mainCube.transform.Rotate(0,.01,0)}},$t=Gt;var qt=class{constructor(t){if(this.maxDrawBufferSize=2048,this._configJson=t,this._canvasDom=document.querySelector(t.canvas_dom_query),this._gl=this._canvasDom.getContext("webgl"),this._gl.enable(this._gl.DEPTH_TEST),this.AutoSetCanvasSize(),!this._gl.getExtension("WEBGL_depth_texture")){console.log("This WebGL program requires the use of the WEBGL_depth_texture extension. This extension is not supported by your browser, so this WEBGL program is terminating.");return}window.addEventListener("resize",()=>{this.AutoSetCanvasSize()})}get webglContext(){return this._gl}AutoSetCanvasSize(){this.SetCanvasToSceenSize(this._canvasDom.clientWidth,this._canvasDom.clientHeight)}SetCanvasToSceenSize(t,r){(t>this.maxDrawBufferSize||r>this.maxDrawBufferSize)&&(r=r>t?this.maxDrawBufferSize:this.maxDrawBufferSize*r/t,t=t>=r?this.maxDrawBufferSize:this.maxDrawBufferSize*t/r),console.log(t+", "+r),this._canvasDom.width=t,this._canvasDom.height=r}},kt=qt;var X=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function V(e,t,r){return r={path:t,exports:{},require:function(i,n){return wa(i,n==null?r.path:n)}},e(r,r.exports),r.exports}function wa(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var _=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;t.has=function(c,u){return r.call(c,u)};function i(c,u){return c<u?-1:c===u?0:1}t.defaultCompare=i;function n(c,u){return c===u}t.defaultEquals=n;function a(c){return c===null?"COLLECTION_NULL":l(c)?"COLLECTION_UNDEFINED":h(c)?"$s"+c:"$o"+c.toString()}t.defaultToString=a;function s(c,u){if(u===void 0&&(u=","),c===null)return"COLLECTION_NULL";if(l(c))return"COLLECTION_UNDEFINED";if(h(c))return c.toString();var p="{",m=!0;for(var v in c)t.has(c,v)&&(m?m=!1:p=p+u,p=p+v+":"+c[v]);return p+"}"}t.makeString=s;function o(c){return typeof c=="function"}t.isFunction=o;function l(c){return typeof c=="undefined"}t.isUndefined=l;function h(c){return Object.prototype.toString.call(c)==="[object String]"}t.isString=h;function f(c){return l(c)||!o(c)?function(u,p){return u<p?1:u===p?0:-1}:function(u,p){return c(u,p)*-1}}t.reverseCompareFunction=f;function d(c){return function(u,p){return c(u,p)===0}}t.compareToEquals=d}),G=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(c,u,p){for(var m=p||_.defaultEquals,v=c.length,x=0;x<v;x++)if(m(c[x],u))return x;return-1}t.indexOf=r;function i(c,u,p){for(var m=p||_.defaultEquals,v=c.length,x=v-1;x>=0;x--)if(m(c[x],u))return x;return-1}t.lastIndexOf=i;function n(c,u,p){return r(c,u,p)>=0}t.contains=n;function a(c,u,p){var m=r(c,u,p);return m<0?!1:(c.splice(m,1),!0)}t.remove=a;function s(c,u,p){for(var m=p||_.defaultEquals,v=c.length,x=0,A=0;A<v;A++)m(c[A],u)&&x++;return x}t.frequency=s;function o(c,u,p){var m=p||_.defaultEquals;if(c.length!==u.length)return!1;for(var v=c.length,x=0;x<v;x++)if(!m(c[x],u[x]))return!1;return!0}t.equals=o;function l(c){return c.concat()}t.copy=l;function h(c,u,p){if(u<0||u>=c.length||p<0||p>=c.length)return!1;var m=c[u];return c[u]=c[p],c[p]=m,!0}t.swap=h;function f(c){return"["+c.toString()+"]"}t.toString=f;function d(c,u){for(var p=0,m=c;p<m.length;p++){var v=m[p];if(u(v)===!1)return}}t.forEach=d}),W=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.table={},this.nElements=0,this.toStr=n||_.defaultToString}return i.prototype.getValue=function(n){var a=this.table["$"+this.toStr(n)];if(!_.isUndefined(a))return a.value},i.prototype.setValue=function(n,a){if(!(_.isUndefined(n)||_.isUndefined(a))){var s,o="$"+this.toStr(n),l=this.table[o];return _.isUndefined(l)?(this.nElements++,s=void 0):s=l.value,this.table[o]={key:n,value:a},s}},i.prototype.remove=function(n){var a="$"+this.toStr(n),s=this.table[a];if(!_.isUndefined(s))return delete this.table[a],this.nElements--,s.value},i.prototype.keys=function(){var n=[];for(var a in this.table)if(_.has(this.table,a)){var s=this.table[a];n.push(s.key)}return n},i.prototype.values=function(){var n=[];for(var a in this.table)if(_.has(this.table,a)){var s=this.table[a];n.push(s.value)}return n},i.prototype.forEach=function(n){for(var a in this.table)if(_.has(this.table,a)){var s=this.table[a],o=n(s.key,s.value);if(o===!1)return}},i.prototype.containsKey=function(n){return!_.isUndefined(this.getValue(n))},i.prototype.clear=function(){this.table={},this.nElements=0},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){var n="{";return this.forEach(function(a,s){n+=`
	`+a+" : "+s}),n+`
}`},i}();t.default=r}),Xt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.dictionary=new W.default(n)}return i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.add=function(n){return this.contains(n)||_.isUndefined(n)?!1:(this.dictionary.setValue(n,n),!0)},i.prototype.intersection=function(n){var a=this;this.forEach(function(s){return n.contains(s)||a.remove(s),!0})},i.prototype.union=function(n){var a=this;n.forEach(function(s){return a.add(s),!0})},i.prototype.difference=function(n){var a=this;n.forEach(function(s){return a.remove(s),!0})},i.prototype.isSubsetOf=function(n){if(this.size()>n.size())return!1;var a=!0;return this.forEach(function(s){return n.contains(s)?!0:(a=!1,!1)}),a},i.prototype.remove=function(n){return this.contains(n)?(this.dictionary.remove(n),!0):!1},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){return n(s)})},i.prototype.toArray=function(){return this.dictionary.values()},i.prototype.isEmpty=function(){return this.dictionary.isEmpty()},i.prototype.size=function(){return this.dictionary.size()},i.prototype.clear=function(){this.dictionary.clear()},i.prototype.toString=function(){return G.toString(this.toArray())},i}();t.default=r}),Ra=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.toStrF=n||_.defaultToString,this.dictionary=new W.default(this.toStrF),this.nElements=0}return i.prototype.add=function(n,a){if(a===void 0&&(a=1),_.isUndefined(n)||a<=0)return!1;if(this.contains(n))this.dictionary.getValue(n).copies+=a;else{var s={value:n,copies:a};this.dictionary.setValue(n,s)}return this.nElements+=a,!0},i.prototype.count=function(n){return this.contains(n)?this.dictionary.getValue(n).copies:0},i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.remove=function(n,a){if(a===void 0&&(a=1),_.isUndefined(n)||a<=0)return!1;if(this.contains(n)){var s=this.dictionary.getValue(n);return a>s.copies?this.nElements-=s.copies:this.nElements-=a,s.copies-=a,s.copies<=0&&this.dictionary.remove(n),!0}else return!1},i.prototype.toArray=function(){for(var n=[],a=this.dictionary.values(),s=0,o=a;s<o.length;s++)for(var l=o[s],h=l.value,f=l.copies,d=0;d<f;d++)n.push(h);return n},i.prototype.toSet=function(){for(var n=new Xt.default(this.toStrF),a=this.dictionary.values(),s=0,o=a;s<o.length;s++){var l=o[s],h=l.value;n.add(h)}return n},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){for(var o=s.value,l=s.copies,h=0;h<l;h++)if(n(o)===!1)return!1;return!0})},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},i}();t.default=r}),Ce=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.firstNode=null,this.lastNode=null,this.nElements=0}return i.prototype.add=function(n,a){if(_.isUndefined(a)&&(a=this.nElements),a<0||a>this.nElements||_.isUndefined(n))return!1;var s=this.createNode(n);if(this.nElements===0||this.lastNode===null)this.firstNode=s,this.lastNode=s;else if(a===this.nElements)this.lastNode.next=s,this.lastNode=s;else if(a===0)s.next=this.firstNode,this.firstNode=s;else{var o=this.nodeAtIndex(a-1);if(o===null)return!1;s.next=o.next,o.next=s}return this.nElements++,!0},i.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},i.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},i.prototype.elementAtIndex=function(n){var a=this.nodeAtIndex(n);if(a!==null)return a.element},i.prototype.indexOf=function(n,a){var s=a||_.defaultEquals;if(_.isUndefined(n))return-1;for(var o=this.firstNode,l=0;o!==null;){if(s(o.element,n))return l;l++,o=o.next}return-1},i.prototype.contains=function(n,a){return this.indexOf(n,a)>=0},i.prototype.remove=function(n,a){var s=a||_.defaultEquals;if(this.nElements<1||_.isUndefined(n))return!1;for(var o=null,l=this.firstNode;l!==null;){if(s(l.element,n))return o===null?(this.firstNode=l.next,l===this.lastNode&&(this.lastNode=null)):l===this.lastNode?(this.lastNode=o,o.next=l.next,l.next=null):(o.next=l.next,l.next=null),this.nElements--,!0;o=l,l=l.next}return!1},i.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},i.prototype.equals=function(n,a){var s=a||_.defaultEquals;return!(n instanceof i)||this.size()!==n.size()?!1:this.equalsAux(this.firstNode,n.firstNode,s)},i.prototype.equalsAux=function(n,a,s){for(;n!==null&&a!==null;){if(!s(n.element,a.element))return!1;n=n.next,a=a.next}return!0},i.prototype.removeElementAtIndex=function(n){if(!(n<0||n>=this.nElements||this.firstNode===null||this.lastNode===null)){var a;if(this.nElements===1)a=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var s=this.nodeAtIndex(n-1);s===null?(a=this.firstNode.element,this.firstNode=this.firstNode.next):s.next===this.lastNode&&(a=this.lastNode.element,this.lastNode=s),s!==null&&s.next!==null&&(a=s.next.element,s.next=s.next.next)}return this.nElements--,a}},i.prototype.forEach=function(n){for(var a=this.firstNode;a!==null&&n(a.element)!==!1;)a=a.next},i.prototype.reverse=function(){for(var n=null,a=this.firstNode,s=null;a!==null;)s=a.next,a.next=n,n=a,a=s;s=this.firstNode,this.firstNode=this.lastNode,this.lastNode=s},i.prototype.toArray=function(){for(var n=[],a=this.firstNode;a!==null;)n.push(a.element),a=a.next;return n},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){return G.toString(this.toArray())},i.prototype.nodeAtIndex=function(n){if(n<0||n>=this.nElements)return null;if(n===this.nElements-1)return this.lastNode;for(var a=this.firstNode,s=0;s<n&&a!==null;s++)a=a.next;return a},i.prototype.createNode=function(n){return{element:n,next:null}},i}();t.default=r}),Wt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new Ce.default}return i.prototype.enqueue=function(n){return this.list.add(n)},i.prototype.add=function(n){return this.list.add(n)},i.prototype.dequeue=function(){if(this.list.size()!==0){var n=this.list.first();return this.list.removeElementAtIndex(0),n}},i.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.size()<=0},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),Qt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.root=null,this.compare=n||_.defaultCompare,this.nElements=0}return i.prototype.add=function(n){return _.isUndefined(n)?!1:this.insertNode(this.createNode(n))!==null?(this.nElements++,!0):!1},i.prototype.clear=function(){this.root=null,this.nElements=0},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.size=function(){return this.nElements},i.prototype.contains=function(n){return _.isUndefined(n)?!1:this.searchNode(this.root,n)!==null},i.prototype.search=function(n){var a=this.searchNode(this.root,n);if(a!==null)return a.element},i.prototype.remove=function(n){var a=this.searchNode(this.root,n);return a===null?!1:(this.removeNode(a),this.nElements--,!0)},i.prototype.inorderTraversal=function(n){this.inorderTraversalAux(this.root,n,{stop:!1})},i.prototype.preorderTraversal=function(n){this.preorderTraversalAux(this.root,n,{stop:!1})},i.prototype.postorderTraversal=function(n){this.postorderTraversalAux(this.root,n,{stop:!1})},i.prototype.levelTraversal=function(n){this.levelTraversalAux(this.root,n)},i.prototype.minimum=function(){if(!(this.isEmpty()||this.root===null))return this.minimumAux(this.root).element},i.prototype.maximum=function(){if(!(this.isEmpty()||this.root===null))return this.maximumAux(this.root).element},i.prototype.forEach=function(n){this.inorderTraversal(n)},i.prototype.toArray=function(){var n=[];return this.inorderTraversal(function(a){return n.push(a),!0}),n},i.prototype.height=function(){return this.heightAux(this.root)},i.prototype.searchNode=function(n,a){for(var s=1;n!==null&&s!==0;)s=this.compare(a,n.element),s<0?n=n.leftCh:s>0&&(n=n.rightCh);return n},i.prototype.transplant=function(n,a){n.parent===null?this.root=a:n===n.parent.leftCh?n.parent.leftCh=a:n.parent.rightCh=a,a!==null&&(a.parent=n.parent)},i.prototype.removeNode=function(n){if(n.leftCh===null)this.transplant(n,n.rightCh);else if(n.rightCh===null)this.transplant(n,n.leftCh);else{var a=this.minimumAux(n.rightCh);a.parent!==n&&(this.transplant(a,a.rightCh),a.rightCh=n.rightCh,a.rightCh.parent=a),this.transplant(n,a),a.leftCh=n.leftCh,a.leftCh.parent=a}},i.prototype.inorderTraversalAux=function(n,a,s){n===null||s.stop||(this.inorderTraversalAux(n.leftCh,a,s),!s.stop&&(s.stop=a(n.element)===!1,!s.stop&&this.inorderTraversalAux(n.rightCh,a,s)))},i.prototype.levelTraversalAux=function(n,a){var s=new Wt.default;for(n!==null&&s.enqueue(n),n=s.dequeue()||null;n!=null;){if(a(n.element)===!1)return;n.leftCh!==null&&s.enqueue(n.leftCh),n.rightCh!==null&&s.enqueue(n.rightCh),n=s.dequeue()||null}},i.prototype.preorderTraversalAux=function(n,a,s){n===null||s.stop||(s.stop=a(n.element)===!1,!s.stop&&(this.preorderTraversalAux(n.leftCh,a,s),!s.stop&&this.preorderTraversalAux(n.rightCh,a,s)))},i.prototype.postorderTraversalAux=function(n,a,s){n===null||s.stop||(this.postorderTraversalAux(n.leftCh,a,s),!s.stop&&(this.postorderTraversalAux(n.rightCh,a,s),!s.stop&&(s.stop=a(n.element)===!1)))},i.prototype.minimumAux=function(n){for(;n!=null&&n.leftCh!==null;)n=n.leftCh;return n},i.prototype.maximumAux=function(n){for(;n!=null&&n.rightCh!==null;)n=n.rightCh;return n},i.prototype.heightAux=function(n){return n===null?-1:Math.max(this.heightAux(n.leftCh),this.heightAux(n.rightCh))+1},i.prototype.insertNode=function(n){for(var a=null,s=this.root;s!==null;){var o=this.compare(n.element,s.element);if(o===0)return null;o<0?(a=s,s=s.leftCh):(a=s,s=s.rightCh)}return n.parent=a,a===null?this.root=n:this.compare(n.element,a.element)<0?a.leftCh=n:a.rightCh=n,n},i.prototype.createNode=function(n){return{element:n,leftCh:null,rightCh:null,parent:null}},i}();t.default=r}),Ca=V(function(e,t){var r=X&&X.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a}(Qt.default);t.default=i}),Yt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.data=[],this.compare=n||_.defaultCompare}return i.prototype.leftChildIndex=function(n){return 2*n+1},i.prototype.rightChildIndex=function(n){return 2*n+2},i.prototype.parentIndex=function(n){return Math.floor((n-1)/2)},i.prototype.minIndex=function(n,a){return a>=this.data.length?n>=this.data.length?-1:n:this.compare(this.data[n],this.data[a])<=0?n:a},i.prototype.siftUp=function(n){for(var a=this.parentIndex(n);n>0&&this.compare(this.data[a],this.data[n])>0;)G.swap(this.data,a,n),n=a,a=this.parentIndex(n)},i.prototype.siftDown=function(n){for(var a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n));a>=0&&this.compare(this.data[n],this.data[a])>0;)G.swap(this.data,a,n),n=a,a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n))},i.prototype.peek=function(){if(this.data.length>0)return this.data[0]},i.prototype.add=function(n){return _.isUndefined(n)?!1:(this.data.push(n),this.siftUp(this.data.length-1),!0)},i.prototype.removeRoot=function(){if(this.data.length>0){var n=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),n}},i.prototype.contains=function(n){var a=_.compareToEquals(this.compare);return G.contains(this.data,n,a)},i.prototype.size=function(){return this.data.length},i.prototype.isEmpty=function(){return this.data.length<=0},i.prototype.clear=function(){this.data.length=0},i.prototype.forEach=function(n){G.forEach(this.data,n)},i}();t.default=r}),Pa=V(function(e,t){var r=X&&X.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])};return function(l,h){o(l,h);function f(){this.constructor=l}l.prototype=h===null?Object.create(h):(f.prototype=h.prototype,new f)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function o(l,h){this.key=l,this.value=h}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}(),n=function(){function o(){this.key=null,this.value=null}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}();function a(o){return!o.next}var s=function(o){r(l,o);function l(h){var f=o.call(this,h)||this;return f.head=new n,f.tail=new n,f.head.next=f.tail,f.tail.prev=f.head,f}return l.prototype.appendToTail=function(h){var f=this.tail.prev;f.next=h,h.prev=f,h.next=this.tail,this.tail.prev=h},l.prototype.getLinkedDictionaryPair=function(h){if(!_.isUndefined(h)){var f="$"+this.toStr(h),d=this.table[f];return d}},l.prototype.getValue=function(h){var f=this.getLinkedDictionaryPair(h);if(!_.isUndefined(f))return f.value},l.prototype.remove=function(h){var f=this.getLinkedDictionaryPair(h);if(!_.isUndefined(f))return o.prototype.remove.call(this,h),f.unlink(),f.value},l.prototype.clear=function(){o.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},l.prototype.replace=function(h,f){var d="$"+this.toStr(f.key);f.next=h.next,f.prev=h.prev,this.remove(h.key),f.prev.next=f,f.next.prev=f,this.table[d]=f,++this.nElements},l.prototype.setValue=function(h,f){if(!(_.isUndefined(h)||_.isUndefined(f))){var d=this.getLinkedDictionaryPair(h),c=new i(h,f),u="$"+this.toStr(h);if(_.isUndefined(d)){this.appendToTail(c),this.table[u]=c,++this.nElements;return}else return this.replace(d,c),d.value}},l.prototype.keys=function(){var h=[];return this.forEach(function(f,d){h.push(f)}),h},l.prototype.values=function(){var h=[];return this.forEach(function(f,d){h.push(d)}),h},l.prototype.forEach=function(h){for(var f=this.head.next;!a(f);){var d=h(f.key,f.value);if(d===!1)return;f=f.next}},l}(W.default);t.default=s}),ba=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n,a,s){s===void 0&&(s=!1),this.dict=new W.default(n),this.equalsF=a||_.defaultEquals,this.allowDuplicate=s}return i.prototype.getValue=function(n){var a=this.dict.getValue(n);return _.isUndefined(a)?[]:G.copy(a)},i.prototype.setValue=function(n,a){if(_.isUndefined(n)||_.isUndefined(a))return!1;var s=this.dict.getValue(n);return _.isUndefined(s)?(this.dict.setValue(n,[a]),!0):!this.allowDuplicate&&G.contains(s,a,this.equalsF)?!1:(s.push(a),!0)},i.prototype.remove=function(n,a){if(_.isUndefined(a)){var s=this.dict.remove(n);return!_.isUndefined(s)}var o=this.dict.getValue(n);return!_.isUndefined(o)&&G.remove(o,a,this.equalsF)?(o.length===0&&this.dict.remove(n),!0):!1},i.prototype.keys=function(){return this.dict.keys()},i.prototype.values=function(){for(var n=this.dict.values(),a=[],s=0,o=n;s<o.length;s++)for(var l=o[s],h=0,f=l;h<f.length;h++){var d=f[h];a.push(d)}return a},i.prototype.containsKey=function(n){return this.dict.containsKey(n)},i.prototype.clear=function(){this.dict.clear()},i.prototype.size=function(){return this.dict.size()},i.prototype.isEmpty=function(){return this.dict.isEmpty()},i}();t.default=r}),Kt=V(function(e,t){var r=X&&X.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(s,o){var l=n.call(this,o)||this;return l.defaultFactoryFunction=s,l}return a.prototype.setDefault=function(s,o){var l=n.prototype.getValue.call(this,s);return _.isUndefined(l)?(this.setValue(s,o),o):l},a.prototype.getValue=function(s){return this.setDefault(s,this.defaultFactoryFunction())},a}(W.default);t.default=i}),Ia=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.heap=new Yt.default(_.reverseCompareFunction(n))}return i.prototype.enqueue=function(n){return this.heap.add(n)},i.prototype.add=function(n){return this.heap.add(n)},i.prototype.dequeue=function(){if(this.heap.size()!==0){var n=this.heap.peek();return this.heap.removeRoot(),n}},i.prototype.peek=function(){return this.heap.peek()},i.prototype.contains=function(n){return this.heap.contains(n)},i.prototype.isEmpty=function(){return this.heap.isEmpty()},i.prototype.size=function(){return this.heap.size()},i.prototype.clear=function(){this.heap.clear()},i.prototype.forEach=function(n){this.heap.forEach(n)},i}();t.default=r}),Da=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new Ce.default}return i.prototype.push=function(n){return this.list.add(n,0)},i.prototype.add=function(n){return this.list.add(n,0)},i.prototype.pop=function(){return this.list.removeElementAtIndex(0)},i.prototype.peek=function(){return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.isEmpty()},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),Ua=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER",n[n.INSIDE_AT_END=2]="INSIDE_AT_END",n[n.INSIDE_AT_START=3]="INSIDE_AT_START"})(r||(r={}));var i=function(){function n(a,s){a===void 0&&(a=[]),s===void 0&&(s={}),this.rootIds=a,this.nodes=s,this.initRootIds(),this.initNodes()}return n.prototype.initRootIds=function(){for(var a=0,s=this.rootIds;a<s.length;a++){var o=s[a];this.createEmptyNodeIfNotExist(o)}},n.prototype.initNodes=function(){for(var a in this.nodes)if(this.nodes.hasOwnProperty(a))for(var s=0,o=this.nodes[a];s<o.length;s++){var l=o[s];this.createEmptyNodeIfNotExist(l)}},n.prototype.createEmptyNodeIfNotExist=function(a){this.nodes[a]||(this.nodes[a]=[])},n.prototype.getRootIds=function(){var a=this.rootIds.slice();return a},n.prototype.getNodes=function(){var a={};for(var s in this.nodes)this.nodes.hasOwnProperty(s)&&(a[s]=this.nodes[s].slice());return a},n.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},n.prototype.toObject=function(){return this.getObject()},n.prototype.flatten=function(){for(var a=this,s=[],o=0;o<this.rootIds.length;o++){var l=this.rootIds[o];s.push({id:l,level:0,hasParent:!1,childrenCount:0}),u(l,this.nodes,s,0)}for(var h=0,f=s;h<f.length;h++){var d=f[h];d.childrenCount=c(d.id)}return s;function c(p){if(a.nodes[p]){var m=a.nodes[p].length;return m}else return 0}function u(p,m,v,x){if(x===void 0&&(x=0),!(!p||!m||!v||!m[p])){x++;for(var A=m[p],y=0;y<A.length;y++){var T=A[y];v.push({id:T,level:x,hasParent:!0}),u(T,m,v,x)}x--}}},n.prototype.moveIdBeforeId=function(a,s){return this.moveId(a,s,r.BEFORE)},n.prototype.moveIdAfterId=function(a,s){return this.moveId(a,s,r.AFTER)},n.prototype.moveIdIntoId=function(a,s,o){return o===void 0&&(o=!0),o?this.moveId(a,s,r.INSIDE_AT_START):this.moveId(a,s,r.INSIDE_AT_END)},n.prototype.swapRootIdWithRootId=function(a,s){var o=this.findRootId(a),l=this.findRootId(s);this.swapRootPositionWithRootPosition(o,l)},n.prototype.swapRootPositionWithRootPosition=function(a,s){var o=this.rootIds[s];this.rootIds[s]=this.rootIds[a],this.rootIds[a]=o},n.prototype.deleteId=function(a){this.rootDeleteId(a),this.nodeAndSubNodesDelete(a),this.nodeRefrencesDelete(a)},n.prototype.insertIdBeforeId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o);for(var l in this.nodes)if(this.nodes.hasOwnProperty(l)){var h=this.findNodeId(l,a);h>-1&&this.insertIdIntoNode(l,s,h)}},n.prototype.insertIdAfterId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o+1);for(var l in this.nodes)if(this.nodes.hasOwnProperty(l)){var h=this.findNodeId(l,a);h>-1&&this.insertIdIntoNode(l,s,h+1)}},n.prototype.insertIdIntoId=function(a,s){this.nodeInsertAtEnd(a,s),this.nodes[s]=[]},n.prototype.insertIdIntoRoot=function(a,s){if(s===void 0)this.rootInsertAtEnd(a);else if(s<0){var o=this.rootIds.length;this.rootIds.splice(s+o+1,0,a)}else this.rootIds.splice(s,0,a);this.nodes[a]=this.nodes[a]||[]},n.prototype.insertIdIntoNode=function(a,s,o){if(this.nodes[a]=this.nodes[a]||[],this.nodes[s]=this.nodes[s]||[],o===void 0)this.nodeInsertAtEnd(a,s);else if(o<0){var l=this.nodes[a].length;this.nodes[a].splice(o+l+1,0,s)}else this.nodes[a].splice(o,0,s)},n.prototype.moveId=function(a,s,o){var l=a,h=this.findRootId(l);this.nodes[s];for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){this.findNodeId(f,s);break}var d=s,c=this.findRootId(d);this.nodes[s];for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){this.findNodeId(f,s);break}if(h>-1)if(c>-1)switch(this.rootDelete(h),c>h&&c--,o){case r.BEFORE:this.insertIdIntoRoot(l,c);break;case r.AFTER:this.insertIdIntoRoot(l,c+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,l);break}else{this.rootDelete(h);for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){var u=this.findNodeId(f,d);if(u>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(f,l,u);break;case r.AFTER:this.insertIdIntoNode(f,l,u+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,l);break}break}}}else if(c>-1){for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){var u=this.findNodeId(f,l);if(u>-1){this.nodeDeleteAtIndex(f,u);break}}switch(o){case r.BEFORE:this.insertIdIntoRoot(l,c);break;case r.AFTER:this.insertIdIntoRoot(l,c+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,l);break}}else{for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){var u=this.findNodeId(f,l);if(u>-1){this.nodeDeleteAtIndex(f,u);break}}for(var f in this.nodes)if(this.nodes.hasOwnProperty(f)){var u=this.findNodeId(f,d);if(u>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(f,l,u);break;case r.AFTER:this.insertIdIntoNode(f,l,u+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,l);break}break}}}},n.prototype.swapArrayElements=function(a,s,o){var l=a[s];return a[s]=a[o],a[o]=l,a},n.prototype.rootDeleteId=function(a){var s=this.findRootId(a);s>-1&&this.rootDelete(s)},n.prototype.nodeAndSubNodesDelete=function(a){for(var s=[],o=0;o<this.nodes[a].length;o++){var l=this.nodes[a][o];this.nodeAndSubNodesDelete(l),s.push(a)}this.nodeDelete(a);for(var o=0;o<s.length;o++)this.nodeDelete(s[o])},n.prototype.nodeRefrencesDelete=function(a){for(var s in this.nodes)if(this.nodes.hasOwnProperty(s))for(var o=0;o<this.nodes[s].length;o++){var l=this.nodes[s][o];l===a&&this.nodeDeleteAtIndex(s,o)}},n.prototype.nodeDelete=function(a){delete this.nodes[a]},n.prototype.findRootId=function(a){return this.rootIds.indexOf(a)},n.prototype.findNodeId=function(a,s){return this.nodes[a].indexOf(s)},n.prototype.findNode=function(a){return this.nodes[a]},n.prototype.nodeInsertAtStart=function(a,s){this.nodes[a].unshift(s)},n.prototype.nodeInsertAtEnd=function(a,s){this.nodes[a].push(s)},n.prototype.rootDelete=function(a){this.rootIds.splice(a,1)},n.prototype.nodeDeleteAtIndex=function(a,s){this.nodes[a].splice(s,1)},n.prototype.rootInsertAtStart=function(a){this.rootIds.unshift(a)},n.prototype.rootInsertAtEnd=function(a){this.rootIds.push(a)},n}();t.default=i}),La=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.arrays=G,t.Bag=Ra.default,t.BSTree=Ca.default,t.BSTreeKV=Qt.default,t.Dictionary=W.default,t.Heap=Yt.default,t.LinkedDictionary=Pa.default,t.LinkedList=Ce.default,t.MultiDictionary=ba.default,t.FactoryDictionary=Kt.default;var r=Kt;t.DefaultDictionary=r.default,t.Queue=Wt.default,t.PriorityQueue=Ia.default,t.Set=Xt.default,t.Stack=Da.default,t.MultiRootTree=Ua.default,t.util=_}),se=La.Dictionary;function Ht(e){return new Promise(t=>{let r=new Image;return r.crossOrigin="anonymous",r.src=e,r.onload=()=>t(Object.assign(r)),r})}function k(e){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.apply(null,Array(e)).map(function(){return t.charAt(Math.floor(Math.random()*t.length))}).join("")}function Zt(e){let t=M.create(),r=2*(e[3]*e[0]+e[1]*e[2]),i=1-2*(e[0]*e[0]+e[1]*e[1]);t[0]=Math.atan2(r,i);let n=2*(e[3]*e[1]-e[2]*e[0]);Math.abs(n)>=1?t[1]=Math.sign(n):t[1]=Math.asin(n);let a=2*(e[3]*e[2]+e[0]*e[1]),s=1-2*(e[1]*e[1]+e[2]*e[2]);return t[2]=Math.atan2(a,s),t}var Jt;(function(e){e[e.Texture=0]="Texture",e[e.Shader=1]="Shader",e[e.GlMaterial=2]="GlMaterial"})(Jt||(Jt={}));var er=class{constructor(){this.textureCache=new se,this.glResourceCache=new se,this.glLocalTextureCache=new se,this.glGlobalTextureCache=new se}async PrepareVFShaders(t,r){let i=fetch(t,{method:"GET",credentials:"include"}),n=fetch(r,{method:"GET",credentials:"include"});return Promise.all([i,n]).then(a=>Promise.all([a[0].text(),a[1].text()])).then(a=>({vertex_shader:a[0],fragment_shader:a[1]}))}async GetImage(t){if(this.textureCache.containsKey(t))return this.textureCache.getValue(t);let r=await Ht(t);return this.textureCache.setValue(t,r),r}GetCacheSource(t){return this.glResourceCache.containsKey(t)?this.glResourceCache.getValue(t):null}SaveCacheSource(t,r){if(this.glResourceCache.containsKey(t))return this.glResourceCache.setValue(t,r)}CreateGLTexture(t,r,i,n,a,s){let o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,r,i,0,n,a,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),o}GetGLTextureSource(t,r){if(!this.glLocalTextureCache.containsKey(t))return null;let i=this.glLocalTextureCache.getValue(t);if(!this.glGlobalTextureCache.containsKey(i.texture_key))return null;let n=this.glGlobalTextureCache.getValue(i.texture_key);return i.localIndex=n.globalIndex-r,{globalType:n,localType:i}}SaveGlobalTextureSource(t,r,i){let n=i+this.glGlobalTextureCache.size(),a={texture:r,globalIndex:n};return this.glGlobalTextureCache.setValue(t,a),a}SaveGLTextureSource(t,r,i){let n={uniformLocation:i,localIndex:-1,texture_key:r};return this.glLocalTextureCache.setValue(t,n),n}},tr=er;var rr=class{constructor(t,r,i){this.id=t,this.glProgram=r,this.glResource=i,this.cacheAttrShaderPosition={},this.cacheUniformShaderPosition={}}PreloadProperties(t,r){t.useProgram(this.glProgram),this.PreloadAttributeProperties(t,r.attributes),this.PreloadUniformProperties(t,r.uniforms),this.PreloadUniformTexture(t,r.texture)}PreloadAttributeProperties(t,r){Object.keys(r).forEach(i=>{var n=t.getAttribLocation(this.glProgram,i);if(Array.isArray(r[i].value)){let a=t.createBuffer(),s=r[i].value;s!=null&&s.length>0&&(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW)),this.cacheAttrShaderPosition[i]={position_id:n,buffer:a,vertexPointer:r[i].vertexPointer}}else this.cacheAttrShaderPosition[i]={position_id:n,buffer:r[i].value,vertexPointer:r[i].vertexPointer}})}PreloadUniformProperties(t,r){let i=r.length;for(let n=0;n<i;n++){let a=t.getUniformLocation(this.glProgram,r[n]);a!=null&&(this.cacheUniformShaderPosition[r[n]]=a)}}PreloadUniformTexture(t,r){let i=r.length;for(let n=0;n<i;n++){let a=r[n],s=t.getUniformLocation(this.glProgram,r[n].id);if(s!=null){this.cacheUniformShaderPosition[r[n].id]=s;let o=this.id+r[n].id,l=r[n].texture===void 0?o:r[n].texture;if(this.glResource.SaveGLTextureSource(o,l,s),!this.glResource.glGlobalTextureCache.containsKey(l)){let h=a.textureBuffer==null?t.createTexture():a.textureBuffer,f=this.glResource.SaveGlobalTextureSource(l,h,t.TEXTURE0);t.activeTexture(f.globalIndex),t.bindTexture(t.TEXTURE_2D,h),a.textureBuffer==null&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),t.uniform1i(s,f.globalIndex-t.TEXTURE0)}}}}ExecuteAttributeProp(t,r,i,n){if(!(r in this.cacheAttrShaderPosition))return;let a=this.cacheAttrShaderPosition[r];if(!(a.position_id<0)){t.enableVertexAttribArray(a.position_id),t.bindBuffer(t.ARRAY_BUFFER,n==null?a.buffer:n),i!=null&&n==null&&t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW);var s=a.vertexPointer.size,o=a.vertexPointer.type,l=a.vertexPointer.normalize,h=0,f=0;t.vertexAttribPointer(a.position_id,s,o,l,h,f)}}ExecuteUniformProp(t,r,i,n=!1){if(!(t in this.cacheUniformShaderPosition))return;let a=this.cacheUniformShaderPosition[t];n?i(a,!1,r):i(a,r)}ExecuteUniformSprite(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}ExecuteUniformTex(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}},Pe=rr;var nr=class{constructor(t,r){this._gl=t,this._webglResource=r,this._shaderCache={}}GetGlShaderSet(t){return t in this._shaderCache?this._shaderCache[t]:null}async LoadTextureToObject(t,r,i){let n=await this._webglResource.GetImage(i);t.SetCustomUniformAttr(r,{isMatrix:!1,value:n,function:this._gl.uniform1i})}async LoadAndPrepareShaders(t){if(t==null)return!1;let r=t.length;for(let i=0;i<r;i++)await this.LoadAndPrepareShader(t[i].id,t[i].vertex,t[i].fragment);return!0}async LoadAndPrepareShader(t,r,i){if(t in this._shaderCache)return this._shaderCache[t];let n=await this._webglResource.PrepareVFShaders(r,i),a=this.CreateShader(this._gl.VERTEX_SHADER,n.vertex_shader),s=this.CreateShader(this._gl.FRAGMENT_SHADER,n.fragment_shader),o={vertShader:a,fragShader:s};return this._shaderCache[t]=o,o}async CreateMaterialFromRawPath(t,r,i){let n=await this.LoadAndPrepareShader(t,r,i),a=this.CreateGLProgram(n.vertShader,n.fragShader);return new Pe(k(6),a,this._webglResource)}CreateMaterial(t,r){let i=this.CreateGLProgram(t,r);return new Pe(k(6),i,this._webglResource)}CreateShader(t,r){let i=this._gl,n=i.createShader(t);i.shaderSource(n,r),i.compileShader(n);var a=i.getShaderParameter(n,i.COMPILE_STATUS);return a?n:(i.deleteShader(n),null)}CreateGLProgram(t,r){let i=this._gl,n=i.createProgram();i.attachShader(n,t),i.attachShader(n,r),i.linkProgram(n);var a=i.getProgramParameter(n,i.LINK_STATUS);return a?n:(i.deleteProgram(n),null)}},ir=nr;var ar=class{get vertCount(){return Math.round(this._meshData.vertexCount/3)}get meshData(){return this._meshData}constructor(t){this._meshData=t}SetVertex(t){this._meshData.vertex=t,this._meshData.nativeVertex=new Float32Array(t)}SetUV(t){this._meshData.uv=t,this._meshData.nativeUV=new Float32Array(t)}SetNormal(t){this._meshData.normal=t,this._meshData.nativeNormal=new Float32Array(t)}},sr=ar;function be(){let e=Na(),t=za(),r=Va(),i=Fa();return{vertex:e,uv:t,normal:r,tangent:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(r),nativeUV:new Float32Array(t),nativeTangent:new Float32Array(i),vertexCount:e.length,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferTangent:null,glBufferUV:null}}function Na(){return[-1,-1,0,-1,1,0,1,-1,0,1,-1,0,-1,1,0,1,1,0]}function za(){return[0,0,0,1,1,0,1,0,0,1,1,1]}function Va(){return[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}function Fa(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function Ie(){let e=Oa(),t=ja(6),r=or([0,0,1],[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,-1]),i=or([0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]);return{vertex:e,uv:t,normal:r,tangent:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(r),nativeUV:new Float32Array(t),nativeTangent:new Float32Array(i),vertexCount:e.length,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferTangent:null,glBufferUV:null}}function Oa(){return[-1,-1,1,-1,1,1,1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]}function ja(e){let t=[];for(let r=0;r<e;r++)t=t.concat([0,0,0,1,1,0,1,0,0,1,1,1]);return t}function or(...e){let t=[];for(let r=0;r<e.length;r++){let i=[];for(let n=0;n<6;n++)i=i.concat(e[r]);t=t.concat(i)}return t}function De(){return{vertex:null,uv:null,normal:null,tangent:null,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:null,nativeNormal:null,nativeUV:null,nativeTangent:null,vertexCount:0,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferUV:null,glBufferTangent:null}}var Q={Standard:"glprogram@standard_material",Unlit:"glprogram@unlit_material",DepthMap:"glprogram@depth_material"};var Ue={Quad:"mesh@quad",Cube:"mesh@cube",Null:"mesh@null"};var lr=class{constructor(){this.meshCache={}}CreateQuad(){return this.CreateAndCacehMeshType(Ue.Quad,be)}CreateCube(){return this.CreateAndCacehMeshType(Ue.Cube,Ie)}CreateNull(t){return this.CreateAndCacehMeshType(t,De)}CreateAndCacehMeshType(t,r){if(t in this.meshCache)return this.meshCache[t];let i=r(),n=new sr(i);return this.meshCache[t]=n,n}},hr=lr;var S={vertex:"a_vertex",color:"a_color",uv:"a_uv",normal:"a_normal",tangent:"a_tangent",time:"u_time",mainColor:"u_mainColor",mainTex:"u_mainTex",normalTex:"u_normalTex",mainTex_Texel:"u_mainTex_Texel",modelMatrix:"u_modelMatrix",viewMatrix:"u_viewMatrix",inverseTransposeModelMatrix:"u_inverseTransposeModelMatrix",modelViewProjectionMatrix:"u_MVPMatrix",directionLightDir:"u_directionLightDir",directionLightColor:"u_directionLightColor",ambientLightColor:"u_ambientLightColor",depthMapTexture:"u_depthTex",depthMapTex_Texel:"u_depthTex_Texel",lightSpaceMVPMatrix:"u_lightSpaceMVPMatrix"};function oe(e){return{attributes:{a_vertex:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:3,type:e.FLOAT,normalize:!1}},a_uv:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:2,type:e.FLOAT,normalize:!1}},a_color:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!0}},a_normal:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:3,type:e.FLOAT,normalize:!0}},a_tangent:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!0}}},uniforms:[S.time,S.mainColor,S.mainTex,S.modelMatrix,S.modelViewProjectionMatrix,S.inverseTransposeModelMatrix,S.directionLightColor,S.directionLightDir,S.ambientLightColor,S.lightSpaceMVPMatrix,S.depthMapTex_Texel,S.mainTex_Texel],texture:[{id:S.mainTex},{id:S.normalTex},{id:S.depthMapTexture,texture:S.depthMapTexture}],count:0}}var fr={up:M.fromValues(0,1,0),right:M.fromValues(1,0,0),forward:M.fromValues(0,0,1)},zs=Object.freeze({Radian2Degree:180/Math.PI,Degree2Radian:Math.PI*180});var Le=class{constructor(){this.cacheTVector={forward:M.create(),right:M.create(),top:M.create()}}UpdateTransformVector(t){return this.CalculateTransformVector(t,this.cacheTVector)}CalculateTransformVector(t,r){return r.forward=this.GetForward(t),r.right=this.GetRight(),r.top=this.GetUp(),r}GetTransformVector(){return this.cacheTVector}GetForward(t){return this.cacheTVector.forward[0]=Math.cos(t[0])*Math.cos(t[1]),this.cacheTVector.forward[1]=Math.sin(t[1]),this.cacheTVector.forward[2]=Math.sin(t[0])*Math.cos(t[1]),this.cacheTVector.forward}GetRight(){return M.cross(this.cacheTVector.right,fr.up,this.cacheTVector.forward),M.normalize(this.cacheTVector.right,this.cacheTVector.right)}GetUp(){return M.cross(this.cacheTVector.top,this.cacheTVector.forward,this.cacheTVector.right)}},cr=Le;var Ne=class{constructor(t,r,i){this.translateVector=M.create(),this.translateVectorX=M.create(),this.translateVectorY=M.create(),this.translateVectorZ=M.create(),this._position=t,this._rotation=r,this._scale=i,this._quaterion=$.create(),$.fromEuler(this._quaterion,r[0],r[1],r[2]),this._relativePosition=M.create(),this._relativeRotation=M.create(),this._relativeScale=M.create(),this._relativeQuaterion=$.create(),this._relativeModelMatrix=C.create(),this._preSaveRelativeModelMatrix=C.create(),this._modelMatrix=C.create(),this._inverseTransposeMatrix=C.create(),this.transformVector=new cr,this._parent=null,this._children=[]}get relativePosition(){return this._relativePosition}get relativeRotation(){return this._relativeRotation}get relativeScale(){return this._relativeScale}get position(){return this._position}get rotation(){return this._rotation}get scale(){return this._scale}get childCount(){return this.children.length}get children(){return this._children}get parent(){return this._parent}get InverseTransposeMatrix(){return C.invert(this._inverseTransposeMatrix,this._modelMatrix),C.transpose(this._inverseTransposeMatrix,this._inverseTransposeMatrix),this._inverseTransposeMatrix}get modelMatrix(){return this._modelMatrix}UpdateModelMatrix(){return this._parent==null?this.GetModelMatrix(this._position,this._scale,this._quaterion,this._modelMatrix):(this.GetModelMatrix(this._relativePosition,this._relativeScale,this._relativeQuaterion,this._relativeModelMatrix),C.mul(this._modelMatrix,this._parent.modelMatrix,this._relativeModelMatrix),this.SetTransformByMatrix(this._position,this._quaterion,this._rotation,this._scale,this._modelMatrix),this._modelMatrix)}GetModelMatrix(t,r,i,n){return C.fromRotationTranslationScale(n,i,t,r)}Scale(t){this.parent==null?M.scale(this._scale,this._scale,t):M.scale(this._relativeScale,this._relativeScale,t)}Translate(t,r,i){this.parent==null?this.ExecuteTranslate(t,r,i,this.rotation,this._position):this.ExecuteTranslate(t,r,i,this._relativeRotation,this._relativePosition)}SetPosition(t,r,i){this.parent==null?M.set(this._position,t,r,i):M.set(this._relativePosition,t,r,i)}ExecuteTranslate(t,r,i,n,a){let s=this.transformVector.UpdateTransformVector(n);M.scale(this.translateVectorX,s.right,t),M.scale(this.translateVectorY,s.top,r),M.scale(this.translateVectorZ,s.forward,i),M.add(this.translateVector,this.translateVectorX,this.translateVectorY),M.add(this.translateVector,this.translateVector,this.translateVectorZ),M.add(a,a,this.translateVector)}Rotate(t,r,i){this.parent==null?this.ExecuteRotate(t,r,i,this._quaterion):this.ExecuteRotate(t,r,i,this._relativeQuaterion)}SetEuler(t,r,i){this.parent==null?this.ExecuteEuler(t,r,i,this._quaterion,this._rotation):this.ExecuteEuler(t,r,i,this._relativeQuaterion,this._relativeRotation)}ExecuteRotate(t,r,i,n){$.rotateX(n,n,t),$.rotateY(n,n,r),$.rotateZ(n,n,i)}ExecuteEuler(t,r,i,n,a){a[0]=t,a[1]=r,a[2]=i,$.fromEuler(n,t,r,i)}UpdateRelativeTransformByParent(t){if(t==null){this.SetTransformByMatrix(this._position,this._quaterion,this._rotation,this._scale,this._modelMatrix);return}let r=this.GetModelMatrix(this._position,this._scale,this._quaterion,this.modelMatrix),i=C.create();C.invert(i,t.UpdateModelMatrix()),C.mul(this._preSaveRelativeModelMatrix,i,r),this.SetTransformByMatrix(this._relativePosition,this._relativeQuaterion,this._relativeRotation,this._relativeScale,this._preSaveRelativeModelMatrix)}SetTransformByMatrix(t,r,i,n,a){t=C.getTranslation(t,a),r=C.getRotation(r,a),i=Zt(r),n=C.getScaling(n,a)}SetParent(t){this._parent=t,t!=null&&(this.parent!=null&&this.parent.RemoveChildren(this),t.AppendChild(this),this.UpdateRelativeTransformByParent(t))}AppendChild(t){this._children.findIndex(i=>i==t)<0&&this._children.push(t)}RemoveChildren(t){let r=this._children.findIndex(i=>i==t);r>=0&&this._children.splice(r,1)}};function ur(){let e=M.create(),t=M.create(),r=M.fromValues(1,1,1);return new Ne(e,t,r)}var ze=Ne;var Ve=class{constructor(){this.id="",this.name="NoName",this.transform=ur()}},Y=Ve;var dr=class extends Y{constructor(t,r,i){super();this.transform=t,this.mesh=r,this.material=i,this.modelViewProjectionMatrix=C.create(),this.matUniformAttributes={}}SetMesh(t){this.mesh=t}SetCustomUniformAttrs(t){this.matUniformAttributes=t}SetCustomUniformAttr(t,r){this.matUniformAttributes[t]=r}GetMVPMatrix(t,r){let i=C.mul(this.modelViewProjectionMatrix,t,this.transform.modelMatrix);return C.mul(this.modelViewProjectionMatrix,r,i)}ProcessMaterialAttr(t,r){r.ExecuteAttributeProp(t,S.vertex,this.mesh.meshData.nativeVertex,this.mesh.meshData.glBufferVertex),r.ExecuteAttributeProp(t,S.uv,this.mesh.meshData.nativeUV,this.mesh.meshData.glBufferUV),r.ExecuteAttributeProp(t,S.normal,this.mesh.meshData.nativeNormal,this.mesh.meshData.glBufferNormal),r.ExecuteAttributeProp(t,S.tangent,this.mesh.meshData.nativeTangent,this.mesh.meshData.glBufferTangent)}ProcessMaterialUniform(t,r,i,n,a,s,o,l,h){r.ExecuteUniformProp(S.time,i,t.uniform1f.bind(t)),r.ExecuteUniformProp(S.modelMatrix,n,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(S.inverseTransposeModelMatrix,a,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(S.modelViewProjectionMatrix,s,t.uniformMatrix4fv.bind(t),!0),o!=null&&(r.ExecuteUniformProp(S.directionLightDir,o.directionLigth.transform.transformVector.GetTransformVector().forward,t.uniform3fv.bind(t)),r.ExecuteUniformProp(S.directionLightColor,o.directionLigth.color,t.uniform4fv.bind(t)),r.ExecuteUniformProp(S.lightSpaceMVPMatrix,o.directionLigth.projection.spaceMatrix,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(S.ambientLightColor,o.ambient_light,t.uniform4fv.bind(t))),l!=null&&(r.ExecuteUniformTex(t,S.depthMapTexture,l),r.ExecuteUniformProp(S.depthMapTex_Texel,h,t.uniform2fv.bind(t)),Object.keys(this.matUniformAttributes).forEach(f=>{if(this.matUniformAttributes[f].value instanceof HTMLImageElement){let d=this.matUniformAttributes[f].value;r.ExecuteUniformSprite(t,f,this.matUniformAttributes[f].value),r.ExecuteUniformProp(S.mainTex_Texel,F.fromValues(1/d.width,1/d.height),t.uniform2fv.bind(t))}else r.ExecuteUniformProp(f,this.matUniformAttributes[f].value,this.matUniformAttributes[f].function.bind(t),this.matUniformAttributes[f].isMatrix)}),this.matUniformAttributes={})}},xe=dr;var Fe=class extends xe{constructor(t,r,i,n){super(t,r,i);this.gltfModel=n}},pr=Fe;var vr=e=>Me(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]),Ba=(e,t)=>{let r=te();_e(r,ve(t[0],t[1],t[2],t[3])),ce(e,r,e)},K=function(e,t,r,i){function n(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(f){try{h(i.next(f))}catch(d){s(d)}}function l(f){try{h(i.throw(f))}catch(d){s(d)}}function h(f){f.done?a(f.value):n(f.value).then(o,l)}h((i=i.apply(e,t||[])).next())})},Ga={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Oe;(function(e){e[e.Float=5126]="Float",e[e.Short=5123]="Short"})(Oe||(Oe={}));var $a=(e,t)=>K(void 0,void 0,void 0,function*(){let r=e.split("/").slice(0,-1).join("/");return yield(yield fetch(`${r}/${t}`)).arrayBuffer()}),le=(e,t)=>K(void 0,void 0,void 0,function*(){return new Promise(r=>{let i=new Image;i.onload=()=>{let n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);let a=e.getExtension("EXT_texture_filter_anisotropic");if(a){let s=e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT);e.texParameterf(e.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,s)}e.generateMipmap(e.TEXTURE_2D),r(n)},i.src=t})}),he=(e,t,r)=>{let i=e.bufferViews[r.bufferView],n=Ga[r.type],a=r.componentType,s=r.type,o=a==Oe.Float?new Float32Array(t[i.buffer],(r.byteOffset||0)+(i.byteOffset||0),r.count*n):new Int16Array(t[i.buffer],(r.byteOffset||0)+(i.byteOffset||0),r.count*n);return{size:n,data:o,type:s,componentType:a}},mr=(e,t,r)=>{let i=t.primitives[0].attributes[r];return e.accessors[i]},H=(e,t,r,i,n)=>{if(i.primitives[0].attributes[n]===void 0)return null;let a=mr(t,i,n),s=he(t,r,a),o=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,s.data,e.STATIC_DRAW),{buffer:o,size:s.size,type:s.componentType}},qa=(e,t)=>{let r=te();return t.translation!==void 0&&ye(r,r,t.translation),t.rotation!==void 0&&Ba(r,t.rotation),t.scale!==void 0&&Te(r,r,t.scale),t.matrix!==void 0&&vr(t.matrix),{id:e,name:t.name,children:t.children||[],localBindTransform:r,animatedTransform:te(),skin:t.skin,mesh:t.mesh}},ka=(e,t,r)=>{let i=t.channels.map(a=>{let s=t.samplers[a.sampler],o=he(e,r,e.accessors[s.input]),l=he(e,r,e.accessors[s.output]);return{node:a.target.node,type:a.target.path,time:o,buffer:l,interpolation:s.interpolation?s.interpolation:"LINEAR"}}),n={};return i.forEach(a=>{n[a.node]===void 0&&(n[a.node]={translation:[],rotation:[],scale:[]});for(let s=0;s<a.time.data.length;s++){let o=a.interpolation==="CUBICSPLINE"?a.buffer.size*3:a.buffer.size,l=a.interpolation==="CUBICSPLINE"?a.buffer.size:0,h=a.type==="rotation"?ve(a.buffer.data[s*o+l],a.buffer.data[s*o+l+1],a.buffer.data[s*o+l+2],a.buffer.data[s*o+l+3]):q(a.buffer.data[s*o+l],a.buffer.data[s*o+l+1],a.buffer.data[s*o+l+2]);n[a.node][a.type].push({time:a.time.data[s],transform:h,type:a.type})}}),n},Xa=(e,t,r,i)=>{let n=null,a=0;if(r.primitives[0].indices!==void 0){let s=t.accessors[r.primitives[0].indices],o=he(t,i,s);n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o.data,e.STATIC_DRAW),a=o.data.length}else a=mr(t,r,"POSITION").count;return{indices:n,elementCount:a,positions:H(e,t,i,r,"POSITION"),normals:H(e,t,i,r,"NORMAL"),tangents:H(e,t,i,r,"TANGENT"),texCoord:H(e,t,i,r,"TEXCOORD_0"),joints:H(e,t,i,r,"JOINTS_0"),weights:H(e,t,i,r,"WEIGHTS_0"),material:r.primitives[0].material}},Wa=(e,t,r,i)=>K(void 0,void 0,void 0,function*(){let n=r.split("/").slice(0,-1).join("/"),a=null,s=null,o=null,l=null,h=null,f=re(1,1,1,1),d=0,c=1,u=q(1,1,1),p=t.pbrMetallicRoughness;if(p){if(p.baseColorTexture){let m=i[p.baseColorTexture.index].uri;a=yield le(e,`${n}/${m}`)}if(p.baseColorFactor&&(f=re(p.baseColorFactor[0],p.baseColorFactor[1],p.baseColorFactor[2],p.baseColorFactor[3])),p.metallicRoughnessTexture){let m=i[p.metallicRoughnessTexture.index].uri;s=yield le(e,`${n}/${m}`)}c=p.metallicFactor!==void 0?p.metallicFactor:1,d=p.roughnessFactor!==void 0?p.roughnessFactor:1}if(t.emissiveTexture){let m=i[t.emissiveTexture.index].uri;o=yield le(e,`${n}/${m}`)}if(t.normalTexture){let m=i[t.normalTexture.index].uri;l=yield le(e,`${n}/${m}`)}if(t.occlusionTexture){let m=i[t.occlusionTexture.index].uri;h=yield le(e,`${n}/${m}`)}return t.emissiveFactor&&(u=q(t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2])),{baseColorTexture:a,baseColorFactor:f,metallicRoughnessTexture:s,metallicFactor:c,roughnessFactor:d,emissiveTexture:o,emissiveFactor:u,normalTexture:l,occlusionTexture:h}}),xr=(e,t)=>K(void 0,void 0,void 0,function*(){var r;let n=yield(yield fetch(t)).json();if(n.accessors===void 0||n.accessors.length===0)throw new Error("GLTF File is missing accessors");let a=yield Promise.all(n.buffers.map(p=>K(void 0,void 0,void 0,function*(){return yield $a(t,p.uri)}))),s=n.scenes[n.scene||0],o=n.meshes.map(p=>Xa(e,n,p,a)),l=n.materials?yield Promise.all(n.materials.map(p=>K(void 0,void 0,void 0,function*(){return yield Wa(e,p,t,n.images)}))):[],h=s.nodes[0],f=n.nodes.map((p,m)=>qa(m,p)),d={};(r=n.animations)===null||r===void 0||r.forEach(p=>d[p.name]=ka(n,p,a));let c=n.skins?n.skins.map(p=>{let m=he(n,a,n.accessors[p.inverseBindMatrices]),v=p.joints.map((x,A)=>vr(m.data.slice(A*16,A*16+16)));return{joints:p.joints,inverseBindTransforms:v}}):[];return{name:t.split("/").slice(-1)[0],meshes:o,nodes:f,rootNode:h,animations:d,skins:c,materials:l}});var je=class{constructor(t){this.gl=t}async LoadAsset(t){return await xr(this.gl,t)}},Mr=je;var yr=class{constructor(t,r,i){this._gl=t,this._materialManager=r,this._meshManager=i,this.gltfImporter=new Mr(t)}Build(t,r,i){let n=new ze(M.create(),M.create(),M.fromValues(1,1,1)),a=new xe(n,r,i);a.name=t,a.id=k(11);let s=oe(this._gl);return s.attributes[S.vertex].value=r.meshData.vertex,s.attributes[S.uv].value=r.meshData.uv,s.attributes[S.normal].value=r.meshData.normal,i.PreloadProperties(this._gl,s),a}BuildQuad(){let t=this._meshManager.CreateQuad(),r=this._materialManager.GetGlShaderSet(Q.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Quad",t,i)}BuildCube(){let t=this._meshManager.CreateCube(),r=this._materialManager.GetGlShaderSet(Q.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Cube",t,i)}async BuildGLTFShape(t,r){let i=await this.gltfImporter.LoadAsset(r);console.log(i);let n=i.meshes[0],a=this._meshManager.CreateNull(t);a.meshData.vertexCount=n.elementCount*3,a.meshData.glBufferIndices=n.indices,a.meshData.glBufferVertex=n.positions.buffer,a.meshData.glBufferNormal=n.normals.buffer,a.meshData.glBufferUV=n.texCoord.buffer;let s=this._materialManager.GetGlShaderSet(Q.Standard),o=this._materialManager.CreateMaterial(s.vertShader,s.fragShader),l=new ze(M.create(),M.create(),M.fromValues(1,1,1)),h=new pr(l,a,o,i);h.name=i.name,h.id=t;let f=oe(this._gl);return f.attributes[S.vertex].value=n.positions.buffer,f.attributes[S.uv].value=n.texCoord.buffer,f.attributes[S.normal].value=n.normals.buffer,f.attributes[S.tangent].value=n.tangents.buffer,i.materials.length>0&&(i.materials[0].baseColorTexture!=null&&(f.texture[0].textureBuffer=i.materials[0].baseColorTexture),i.materials[0].normalTexture!=null&&(f.texture[1].textureBuffer=i.materials[0].normalTexture)),h.SetCustomUniformAttr("u_mainColor",{value:[1,1,1,1],isMatrix:!1,function:this._gl.uniform4fv}),o.PreloadProperties(this._gl,f),h}},Tr=yr;var Z;(function(e){e[e.Orthographic=0]="Orthographic",e[e.Perspective=1]="Perspective"})(Z||(Z={}));var fe=class{constructor(t,r){this.farClipPoint=15,this.nearClipPoint=.3,this._foxyPerspective=60,this._sizeOrtho=3,this.transform=t,this.lookUpPoint=M.create(),this.upDirMatrix=M.fromValues(0,1,0),this._viewMatrix=C.create(),this._projectionMatrix=C.create(),this._spaceMatrix=C.create(),this.projectionType=r}get projectionMatrix(){return this._projectionMatrix}get viewMatrix(){let t=this.transform.transformVector.UpdateTransformVector(this.transform.rotation);return M.add(this.lookUpPoint,this.transform.position,t.forward),C.lookAt(this._viewMatrix,this.transform.position,this.lookUpPoint,this.upDirMatrix)}get spaceMatrix(){return C.mul(this._spaceMatrix,this.projectionMatrix,this.viewMatrix)}set projectionType(t){this._projectionType=t,this.UpdateProjectionMatrix()}set aspectRatio(t){this._aspectRatio=t,this.UpdateProjectionMatrix()}set sizeOrtho(t){this._sizeOrtho=t,this.UpdateProjectionMatrix()}set foxyPerspective(t){this._foxyPerspective=t,this.UpdateProjectionMatrix()}UpdateProjectionMatrix(){return this._projectionType==0?this._projectionMatrix=this.GetOrthographicMatrix(-this._sizeOrtho*this._aspectRatio,this._sizeOrtho*this._aspectRatio,-this._sizeOrtho,this._sizeOrtho,this.nearClipPoint,this.farClipPoint):this._projectionMatrix=this.GetPerspectiveMatrix(this._foxyPerspective,this._aspectRatio,this.nearClipPoint,this.farClipPoint),this._projectionMatrix}GetOrthographicMatrix(t,r,i,n,a,s){return C.ortho(this._projectionMatrix,t,r,i,n,a,s)}GetPerspectiveMatrix(t,r,i,n){return t=t*(Math.PI/180),C.perspective(this._projectionMatrix,t,r,i,n)}};var _r=class extends Y{constructor(){super();this.id=k(8),this.name="MainCamera",this.transform.SetEuler(1.5*Math.PI,0,0),this.projection=new fe(this.transform,Z.Perspective)}},gr=_r;var Be=class extends Y{constructor(){super();this.cachePosition=M.create(),this.color=ne.fromValues(1,1,1,1),this.offsetPostion=M.fromValues(3,9,3),this.transform.SetEuler(Math.PI*.3,Math.PI*1.35,0),this.transform.transformVector.UpdateTransformVector(this.transform.rotation),this.projection=new fe(this.transform,Z.Orthographic),this.projection.sizeOrtho=6}},Er=Be;var Ge=class{constructor(){this.directionLigth=new Er,this.ambient_light=ne.fromValues(.3,.3,.3,1)}SyncLightRelativePosToCamera(t){M.add(this.directionLigth.cachePosition,this.directionLigth.offsetPostion,t.position),this.directionLigth.transform.SetPosition(this.directionLigth.cachePosition[0],this.directionLigth.offsetPostion[1],this.directionLigth.cachePosition[2])}},Sr=Ge;var Ar=class{get shapeArray(){return this._shapeArray}constructor(){this._shapeArray=[],this.camera=new gr,this.lights=new Sr}AddShapeObj(t){this._shapeArray.push(t)}RemoveShapeObj(t){let r=this._shapeArray.findIndex(i=>i.id=t);r>=0&&this._shapeArray.splice(r,1)}SetParent(t,r){if(r.transform.SetParent(t.transform),t==null)return;let i=this._shapeArray.findIndex(n=>n.id==t.id);i>=0&&(this.RemoveShapeObj(r.id),this._shapeArray.splice(i+1,0,r))}},wr=Ar;var Rr=class{get depthMapTex(){return this._depthMapTex}get colorDepthMapTex(){return this._colorDepthMapTex}get depthFrameBuffer(){return this._depthFrameBuffer}get depthMaterial(){return this._depthMaterial}constructor(t,r,i){this.gl=t,this.webglResouceAlloc=r,this.materialManager=i}CacheDepthMaterial(){let t=this.materialManager.GetGlShaderSet(Q.DepthMap);this._depthMaterial=this.materialManager.CreateMaterial(t.vertShader,t.fragShader);let r=oe(this.gl);this._depthMaterial.PreloadProperties(this.gl,r)}PrepareDepthFrameBuffer(t,r){let i=this.gl;this._colorDepthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.RGBA,i.UNSIGNED_BYTE,null),this._depthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),this._depthFrameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._depthFrameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._colorDepthMapTex,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this._depthMapTex,0),this.webglResouceAlloc.SaveGlobalTextureSource(S.depthMapTexture,this._depthMapTex,i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}},Cr=Rr;var Pr=class extends kt{constructor(t){super(t);this.previousTimeStamp=0,this.targetTextureWidth=512,this.targetTextureHeight=512,this.targetTextureTexel=F.fromValues(1/this.targetTextureWidth,1/this.targetTextureHeight),this.configJson=t,this.webglResouceAlloc=new tr,this.materialManager=new ir(this._gl,this.webglResouceAlloc),this.meshManager=new hr,this.shapeBuilder=new Tr(this._gl,this.materialManager,this.meshManager),this.webglDepthBuffer=new Cr(this._gl,this.webglResouceAlloc,this.materialManager),this.scene=new wr}get isKatachiValid(){return this._gl!=null}async SetUp(t){return this.isKatachiValid?(this.UpdateLoopCallback=t,await this.materialManager.LoadAndPrepareShaders(this.configJson.shaders),this.webglDepthBuffer.PrepareDepthFrameBuffer(this.targetTextureWidth,this.targetTextureHeight),this.webglDepthBuffer.CacheDepthMaterial(),window.requestAnimationFrame(this.PerformGameLoop.bind(this)),!0):!1}PerformGameLoop(t){let r=(t-this.previousTimeStamp)/1e3;this.time=t/1e3,this.previousTimeStamp=t,this.UpdateLoopCallback!=null&&this.UpdateLoopCallback(this.time),this.scene.lights!=null&&this.time%.5>.45&&this.scene.lights.SyncLightRelativePosToCamera(this.scene.camera.transform),this.DrawCanvas(this.webglDepthBuffer.depthFrameBuffer,this.webglDepthBuffer.depthMaterial,this.scene.lights.directionLigth.projection,this.targetTextureWidth,this.targetTextureHeight),this.DrawCanvas(null,null,this.scene.camera.projection,this._gl.canvas.width,this._gl.canvas.height),window.requestAnimationFrame(this.PerformGameLoop.bind(this))}DrawCanvas(t,r,i,n,a){let s=this._gl;this.currentFrameBuffer=t,s.bindFramebuffer(s.FRAMEBUFFER,t),s.viewport(0,0,n,a),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),i.aspectRatio=n/a;let o=i.viewMatrix,l=i.projectionMatrix;for(var h in this.scene.shapeArray){let f=this.scene.shapeArray[h];this.ProcessShapeObject(f,o,l,r)}}ProcessShapeObject(t,r,i,n){let a=n==null?t.material:n;this._gl.useProgram(a.glProgram),t.transform.UpdateModelMatrix();let s=t.GetMVPMatrix(r,i);t.ProcessMaterialAttr(this._gl,a),t.ProcessMaterialUniform(this._gl,a,this.time,t.transform.modelMatrix,t.transform.InverseTransposeMatrix,s,this.scene.lights,this.currentFrameBuffer==null?this.webglDepthBuffer.depthMapTex:null,this.targetTextureTexel);var o=this._gl.TRIANGLES,l=0,h=t.mesh.vertCount;t.mesh.meshData.glBufferIndices?(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.mesh.meshData.glBufferIndices),this._gl.drawElements(o,h,this._gl.UNSIGNED_SHORT,0)):t.mesh.meshData.glBufferIndices==null&&this._gl.drawArrays(o,l,h)}},br=Pr;window.onload=()=>{let e=fetch("./Dataset/katachi_basic_layout.json"),t=fetch("./Dataset/sample_scene_layout.json");Promise.all([e,t]).then(r=>Promise.all(r.map(i=>i.json()))).then(function(r){let i=new br(r[0]);new $t().SetUp(i,r[1])})};
//# sourceMappingURL=index.js.map
