var w=1e-6,C=typeof Float32Array!="undefined"?Float32Array:Array,F=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function or(){var e=new C(9);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function hr(){var e=new C(16);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function lr(e){var t=new C(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function cr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fr(e,t,r,i,n,a,s,o,h,l,c,d,f,u,v,m){var p=new C(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=i,p[4]=n,p[5]=a,p[6]=s,p[7]=o,p[8]=h,p[9]=l,p[10]=c,p[11]=d,p[12]=f,p[13]=u,p[14]=v,p[15]=m,p}function ur(e,t,r,i,n,a,s,o,h,l,c,d,f,u,v,m,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=h,e[8]=l,e[9]=c,e[10]=d,e[11]=f,e[12]=u,e[13]=v,e[14]=m,e[15]=p,e}function we(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dr(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function pr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],d=t[9],f=t[10],u=t[11],v=t[12],m=t[13],p=t[14],x=t[15],S=r*o-i*s,M=r*h-n*s,y=r*l-a*s,g=i*h-n*o,_=i*l-a*o,U=n*l-a*h,I=c*m-d*v,D=c*p-f*v,b=c*x-u*v,L=d*p-f*m,z=d*x-u*m,N=f*x-u*p,P=S*N-M*z+y*L+g*b-_*D+U*I;return P?(P=1/P,e[0]=(o*N-h*z+l*L)*P,e[1]=(n*z-i*N-a*L)*P,e[2]=(m*U-p*_+x*g)*P,e[3]=(f*_-d*U-u*g)*P,e[4]=(h*b-s*N-l*D)*P,e[5]=(r*N-n*b+a*D)*P,e[6]=(p*y-v*U-x*M)*P,e[7]=(c*U-f*y+u*M)*P,e[8]=(s*z-o*b+l*I)*P,e[9]=(i*b-r*z-a*I)*P,e[10]=(v*_-m*y+x*S)*P,e[11]=(d*y-c*_-u*S)*P,e[12]=(o*D-s*L-h*I)*P,e[13]=(r*L-i*D+n*I)*P,e[14]=(m*M-v*g-p*S)*P,e[15]=(c*g-d*M+f*S)*P,e):null}function vr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],h=t[6],l=t[7],c=t[8],d=t[9],f=t[10],u=t[11],v=t[12],m=t[13],p=t[14],x=t[15];return e[0]=o*(f*x-u*p)-d*(h*x-l*p)+m*(h*u-l*f),e[1]=-(i*(f*x-u*p)-d*(n*x-a*p)+m*(n*u-a*f)),e[2]=i*(h*x-l*p)-o*(n*x-a*p)+m*(n*l-a*h),e[3]=-(i*(h*u-l*f)-o*(n*u-a*f)+d*(n*l-a*h)),e[4]=-(s*(f*x-u*p)-c*(h*x-l*p)+v*(h*u-l*f)),e[5]=r*(f*x-u*p)-c*(n*x-a*p)+v*(n*u-a*f),e[6]=-(r*(h*x-l*p)-s*(n*x-a*p)+v*(n*l-a*h)),e[7]=r*(h*u-l*f)-s*(n*u-a*f)+c*(n*l-a*h),e[8]=s*(d*x-u*m)-c*(o*x-l*m)+v*(o*u-l*d),e[9]=-(r*(d*x-u*m)-c*(i*x-a*m)+v*(i*u-a*d)),e[10]=r*(o*x-l*m)-s*(i*x-a*m)+v*(i*l-a*o),e[11]=-(r*(o*u-l*d)-s*(i*u-a*d)+c*(i*l-a*o)),e[12]=-(s*(d*p-f*m)-c*(o*p-h*m)+v*(o*f-h*d)),e[13]=r*(d*p-f*m)-c*(i*p-n*m)+v*(i*f-n*d),e[14]=-(r*(o*p-h*m)-s*(i*p-n*m)+v*(i*h-n*o)),e[15]=r*(o*f-h*d)-s*(i*f-n*d)+c*(i*h-n*o),e}function mr(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],h=e[7],l=e[8],c=e[9],d=e[10],f=e[11],u=e[12],v=e[13],m=e[14],p=e[15],x=t*s-r*a,S=t*o-i*a,M=t*h-n*a,y=r*o-i*s,g=r*h-n*s,_=i*h-n*o,U=l*v-c*u,I=l*m-d*u,D=l*p-f*u,b=c*m-d*v,L=c*p-f*v,z=d*p-f*m;return x*z-S*L+M*b+y*D-g*I+_*U}function Pe(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],d=t[8],f=t[9],u=t[10],v=t[11],m=t[12],p=t[13],x=t[14],S=t[15],M=r[0],y=r[1],g=r[2],_=r[3];return e[0]=M*i+y*o+g*d+_*m,e[1]=M*n+y*h+g*f+_*p,e[2]=M*a+y*l+g*u+_*x,e[3]=M*s+y*c+g*v+_*S,M=r[4],y=r[5],g=r[6],_=r[7],e[4]=M*i+y*o+g*d+_*m,e[5]=M*n+y*h+g*f+_*p,e[6]=M*a+y*l+g*u+_*x,e[7]=M*s+y*c+g*v+_*S,M=r[8],y=r[9],g=r[10],_=r[11],e[8]=M*i+y*o+g*d+_*m,e[9]=M*n+y*h+g*f+_*p,e[10]=M*a+y*l+g*u+_*x,e[11]=M*s+y*c+g*v+_*S,M=r[12],y=r[13],g=r[14],_=r[15],e[12]=M*i+y*o+g*d+_*m,e[13]=M*n+y*h+g*f+_*p,e[14]=M*a+y*l+g*u+_*x,e[15]=M*s+y*c+g*v+_*S,e}function xr(e,t,r){var i=r[0],n=r[1],a=r[2],s,o,h,l,c,d,f,u,v,m,p,x;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],h=t[2],l=t[3],c=t[4],d=t[5],f=t[6],u=t[7],v=t[8],m=t[9],p=t[10],x=t[11],e[0]=s,e[1]=o,e[2]=h,e[3]=l,e[4]=c,e[5]=d,e[6]=f,e[7]=u,e[8]=v,e[9]=m,e[10]=p,e[11]=x,e[12]=s*i+c*n+v*a+t[12],e[13]=o*i+d*n+m*a+t[13],e[14]=h*i+f*n+p*a+t[14],e[15]=l*i+u*n+x*a+t[15]),e}function Mr(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yr(e,t,r,i){var n=i[0],a=i[1],s=i[2],o=Math.hypot(n,a,s),h,l,c,d,f,u,v,m,p,x,S,M,y,g,_,U,I,D,b,L,z,N,P,$;return o<w?null:(o=1/o,n*=o,a*=o,s*=o,h=Math.sin(r),l=Math.cos(r),c=1-l,d=t[0],f=t[1],u=t[2],v=t[3],m=t[4],p=t[5],x=t[6],S=t[7],M=t[8],y=t[9],g=t[10],_=t[11],U=n*n*c+l,I=a*n*c+s*h,D=s*n*c-a*h,b=n*a*c-s*h,L=a*a*c+l,z=s*a*c+n*h,N=n*s*c+a*h,P=a*s*c-n*h,$=s*s*c+l,e[0]=d*U+m*I+M*D,e[1]=f*U+p*I+y*D,e[2]=u*U+x*I+g*D,e[3]=v*U+S*I+_*D,e[4]=d*b+m*L+M*z,e[5]=f*b+p*L+y*z,e[6]=u*b+x*L+g*z,e[7]=v*b+S*L+_*z,e[8]=d*N+m*P+M*$,e[9]=f*N+p*P+y*$,e[10]=u*N+x*P+g*$,e[11]=v*N+S*P+_*$,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Tr(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],h=t[7],l=t[8],c=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+l*i,e[5]=s*n+c*i,e[6]=o*n+d*i,e[7]=h*n+f*i,e[8]=l*n-a*i,e[9]=c*n-s*i,e[10]=d*n-o*i,e[11]=f*n-h*i,e}function gr(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],h=t[3],l=t[8],c=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-l*i,e[1]=s*n-c*i,e[2]=o*n-d*i,e[3]=h*n-f*i,e[8]=a*i+l*n,e[9]=s*i+c*n,e[10]=o*i+d*n,e[11]=h*i+f*n,e}function _r(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],h=t[3],l=t[4],c=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+l*i,e[1]=s*n+c*i,e[2]=o*n+d*i,e[3]=h*n+f*i,e[4]=l*n-a*i,e[5]=c*n-s*i,e[6]=d*n-o*i,e[7]=f*n-h*i,e}function Er(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Sr(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ar(e,t,r){var i=r[0],n=r[1],a=r[2],s=Math.hypot(i,n,a),o,h,l;return s<w?null:(s=1/s,i*=s,n*=s,a*=s,o=Math.sin(t),h=Math.cos(t),l=1-h,e[0]=i*i*l+h,e[1]=n*i*l+a*o,e[2]=a*i*l-n*o,e[3]=0,e[4]=i*n*l-a*o,e[5]=n*n*l+h,e[6]=a*n*l+i*o,e[7]=0,e[8]=i*a*l+n*o,e[9]=n*a*l-i*o,e[10]=a*a*l+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function wr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Rr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Re(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=i+i,h=n+n,l=a+a,c=i*o,d=i*h,f=i*l,u=n*h,v=n*l,m=a*l,p=s*o,x=s*h,S=s*l;return e[0]=1-(u+m),e[1]=d+S,e[2]=f-x,e[3]=0,e[4]=d-S,e[5]=1-(c+m),e[6]=v+p,e[7]=0,e[8]=f+x,e[9]=v-p,e[10]=1-(c+u),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Cr(e,t){var r=new C(3),i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],h=t[5],l=t[6],c=t[7],d=i*i+n*n+a*a+s*s;return d>0?(r[0]=(o*s+c*i+h*a-l*n)*2/d,r[1]=(h*s+c*n+l*i-o*a)*2/d,r[2]=(l*s+c*a+o*n-h*i)*2/d):(r[0]=(o*s+c*i+h*a-l*n)*2,r[1]=(h*s+c*n+l*i-o*a)*2,r[2]=(l*s+c*a+o*n-h*i)*2),Re(e,t,r),e}function Ir(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Ce(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],h=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(h,l,c),e}function Dr(e,t){var r=new C(3);Ce(r,t);var i=1/r[0],n=1/r[1],a=1/r[2],s=t[0]*i,o=t[1]*n,h=t[2]*a,l=t[4]*i,c=t[5]*n,d=t[6]*a,f=t[8]*i,u=t[9]*n,v=t[10]*a,m=s+c+v,p=0;return m>0?(p=Math.sqrt(m+1)*2,e[3]=.25*p,e[0]=(d-u)/p,e[1]=(f-h)/p,e[2]=(o-l)/p):s>c&&s>v?(p=Math.sqrt(1+s-c-v)*2,e[3]=(d-u)/p,e[0]=.25*p,e[1]=(o+l)/p,e[2]=(f+h)/p):c>v?(p=Math.sqrt(1+c-s-v)*2,e[3]=(f-h)/p,e[0]=(o+l)/p,e[1]=.25*p,e[2]=(d+u)/p):(p=Math.sqrt(1+v-s-c)*2,e[3]=(o-l)/p,e[0]=(f+h)/p,e[1]=(d+u)/p,e[2]=.25*p),e}function br(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],h=n+n,l=a+a,c=s+s,d=n*h,f=n*l,u=n*c,v=a*l,m=a*c,p=s*c,x=o*h,S=o*l,M=o*c,y=i[0],g=i[1],_=i[2];return e[0]=(1-(v+p))*y,e[1]=(f+M)*y,e[2]=(u-S)*y,e[3]=0,e[4]=(f-M)*g,e[5]=(1-(d+p))*g,e[6]=(m+x)*g,e[7]=0,e[8]=(u+S)*_,e[9]=(m-x)*_,e[10]=(1-(d+v))*_,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ur(e,t,r,i,n){var a=t[0],s=t[1],o=t[2],h=t[3],l=a+a,c=s+s,d=o+o,f=a*l,u=a*c,v=a*d,m=s*c,p=s*d,x=o*d,S=h*l,M=h*c,y=h*d,g=i[0],_=i[1],U=i[2],I=n[0],D=n[1],b=n[2],L=(1-(m+x))*g,z=(u+y)*g,N=(v-M)*g,P=(u-y)*_,$=(1-(f+x))*_,K=(p+S)*_,Y=(v+M)*U,Se=(p-S)*U,Ae=(1-(f+m))*U;return e[0]=L,e[1]=z,e[2]=N,e[3]=0,e[4]=P,e[5]=$,e[6]=K,e[7]=0,e[8]=Y,e[9]=Se,e[10]=Ae,e[11]=0,e[12]=r[0]+I-(L*I+P*D+Y*b),e[13]=r[1]+D-(z*I+$*D+Se*b),e[14]=r[2]+b-(N*I+K*D+Ae*b),e[15]=1,e}function Lr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,h=n+n,l=r*s,c=i*s,d=i*o,f=n*s,u=n*o,v=n*h,m=a*s,p=a*o,x=a*h;return e[0]=1-d-v,e[1]=c+x,e[2]=f-p,e[3]=0,e[4]=c-x,e[5]=1-l-v,e[6]=u+m,e[7]=0,e[8]=f+p,e[9]=u-m,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,t,r,i,n,a,s){var o=1/(r-t),h=1/(n-i),l=1/(a-s);return e[0]=a*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*h,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*h,e[10]=(s+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*l,e[15]=0,e}function Nr(e,t,r,i,n){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==Infinity?(s=1/(i-n),e[10]=(n+i)*s,e[14]=2*n*i*s):(e[10]=-1,e[14]=-2*i),e}function Vr(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),h=2/(s+o),l=2/(n+a);return e[0]=h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((s-o)*h*.5),e[9]=(n-a)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Or(e,t,r,i,n,a,s){var o=1/(t-r),h=1/(i-n),l=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*h,e[14]=(s+a)*l,e[15]=1,e}function jr(e,t,r,i){var n,a,s,o,h,l,c,d,f,u,v=t[0],m=t[1],p=t[2],x=i[0],S=i[1],M=i[2],y=r[0],g=r[1],_=r[2];return Math.abs(v-y)<w&&Math.abs(m-g)<w&&Math.abs(p-_)<w?we(e):(c=v-y,d=m-g,f=p-_,u=1/Math.hypot(c,d,f),c*=u,d*=u,f*=u,n=S*f-M*d,a=M*c-x*f,s=x*d-S*c,u=Math.hypot(n,a,s),u?(u=1/u,n*=u,a*=u,s*=u):(n=0,a=0,s=0),o=d*s-f*a,h=f*n-c*s,l=c*a-d*n,u=Math.hypot(o,h,l),u?(u=1/u,o*=u,h*=u,l*=u):(o=0,h=0,l=0),e[0]=n,e[1]=o,e[2]=c,e[3]=0,e[4]=a,e[5]=h,e[6]=d,e[7]=0,e[8]=s,e[9]=l,e[10]=f,e[11]=0,e[12]=-(n*v+a*m+s*p),e[13]=-(o*v+h*m+l*p),e[14]=-(c*v+d*m+f*p),e[15]=1,e)}function $r(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=i[0],h=i[1],l=i[2],c=n-r[0],d=a-r[1],f=s-r[2],u=c*c+d*d+f*f;u>0&&(u=1/Math.sqrt(u),c*=u,d*=u,f*=u);var v=h*f-l*d,m=l*c-o*f,p=o*d-h*c;return u=v*v+m*m+p*p,u>0&&(u=1/Math.sqrt(u),v*=u,m*=u,p*=u),e[0]=v,e[1]=m,e[2]=p,e[3]=0,e[4]=d*p-f*m,e[5]=f*v-c*p,e[6]=c*m-d*v,e[7]=0,e[8]=c,e[9]=d,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function Fr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Gr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function qr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ie(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function kr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Br(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function Xr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Qr(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],l=e[7],c=e[8],d=e[9],f=e[10],u=e[11],v=e[12],m=e[13],p=e[14],x=e[15],S=t[0],M=t[1],y=t[2],g=t[3],_=t[4],U=t[5],I=t[6],D=t[7],b=t[8],L=t[9],z=t[10],N=t[11],P=t[12],$=t[13],K=t[14],Y=t[15];return Math.abs(r-S)<=w*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(i-M)<=w*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(n-y)<=w*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-g)<=w*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-_)<=w*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-U)<=w*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(h-I)<=w*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(l-D)<=w*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-b)<=w*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(d-L)<=w*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(f-z)<=w*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(u-N)<=w*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(v-P)<=w*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(m-$)<=w*Math.max(1,Math.abs(m),Math.abs($))&&Math.abs(p-K)<=w*Math.max(1,Math.abs(p),Math.abs(K))&&Math.abs(x-Y)<=w*Math.max(1,Math.abs(x),Math.abs(Y))}var Wr=Pe,Kr=Ie,R=Object.freeze({__proto__:null,create:hr,clone:lr,copy:cr,fromValues:fr,set:ur,identity:we,transpose:dr,invert:pr,adjoint:vr,determinant:mr,multiply:Pe,translate:xr,scale:Mr,rotate:yr,rotateX:Tr,rotateY:gr,rotateZ:_r,fromTranslation:Er,fromScaling:Sr,fromRotation:Ar,fromXRotation:wr,fromYRotation:Pr,fromZRotation:Rr,fromRotationTranslation:Re,fromQuat2:Cr,getTranslation:Ir,getScaling:Ce,getRotation:Dr,fromRotationTranslationScale:br,fromRotationTranslationScaleOrigin:Ur,fromQuat:Lr,frustum:zr,perspective:Nr,perspectiveFromFieldOfView:Vr,ortho:Or,lookAt:jr,targetTo:$r,str:Fr,frob:Gr,add:qr,subtract:Ie,multiplyScalar:kr,multiplyScalarAndAdd:Br,exactEquals:Xr,equals:Qr,mul:Wr,sub:Kr});function se(){var e=new C(3);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Yr(e){var t=new C(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function De(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function oe(e,t,r){var i=new C(3);return i[0]=e,i[1]=t,i[2]=r,i}function Hr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zr(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Jr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function be(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Ue(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Le(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function en(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function tn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function rn(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function nn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function an(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function sn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function on(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function ze(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function Ne(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function Ve(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function hn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ln(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Oe(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function he(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function te(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],h=r[2];return e[0]=n*h-a*o,e[1]=a*s-i*h,e[2]=i*o-n*s,e}function cn(e,t,r,i){var n=t[0],a=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e}function fn(e,t,r,i,n,a){var s=a*a,o=s*(2*a-3)+1,h=s*(a-2)+a,l=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*o+r[0]*h+i[0]*l+n[0]*c,e[1]=t[1]*o+r[1]*h+i[1]*l+n[1]*c,e[2]=t[2]*o+r[2]*h+i[2]*l+n[2]*c,e}function un(e,t,r,i,n,a){var s=1-a,o=s*s,h=a*a,l=o*s,c=3*a*o,d=3*h*s,f=h*a;return e[0]=t[0]*l+r[0]*c+i[0]*d+n[0]*f,e[1]=t[1]*l+r[1]*c+i[1]*d+n[1]*f,e[2]=t[2]*l+r[2]*c+i[2]*d+n[2]*f,e}function dn(e,t){t=t||1;var r=F()*2*Math.PI,i=F()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function pn(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,e}function vn(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e}function mn(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],h=t[1],l=t[2],c=n*l-a*h,d=a*o-i*l,f=i*h-n*o,u=n*f-a*d,v=a*c-i*f,m=i*d-n*c,p=s*2;return c*=p,d*=p,f*=p,u*=2,v*=2,m*=2,e[0]=o+c+u,e[1]=h+d+v,e[2]=l+f+m,e}function xn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Mn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function yn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Tn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2],h=Math.sqrt(r*r+i*i+n*n),l=Math.sqrt(a*a+s*s+o*o),c=h*l,d=c&&he(e,t)/c;return Math.acos(Math.min(Math.max(d,-1),1))}function gn(e){return e[0]=0,e[1]=0,e[2]=0,e}function _n(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function En(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Sn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=w*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=w*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=w*Math.max(1,Math.abs(n),Math.abs(o))}var An=be,wn=Ue,Pn=Le,Rn=ze,Cn=Ne,je=De,In=Ve,Dn=function(){var e=se();return function(t,r,i,n,a,s){var o,h;for(r||(r=3),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}(),E=Object.freeze({__proto__:null,create:se,clone:Yr,length:De,fromValues:oe,copy:Hr,set:Zr,add:Jr,subtract:be,multiply:Ue,divide:Le,ceil:en,floor:tn,min:rn,max:nn,round:an,scale:sn,scaleAndAdd:on,distance:ze,squaredDistance:Ne,squaredLength:Ve,negate:hn,inverse:ln,normalize:Oe,dot:he,cross:te,lerp:cn,hermite:fn,bezier:un,random:dn,transformMat4:pn,transformMat3:vn,transformQuat:mn,rotateX:xn,rotateY:Mn,rotateZ:yn,angle:Tn,zero:gn,str:_n,exactEquals:En,equals:Sn,sub:An,mul:wn,div:Pn,dist:Rn,sqrDist:Cn,len:je,sqrLen:In,forEach:Dn});function $e(){var e=new C(4);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Fe(e){var t=new C(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ge(e,t,r,i){var n=new C(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function qe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ke(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function Be(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Xe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Qe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function We(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function bn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Un(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Ln(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function zn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Nn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Ke(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Vn(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Ye(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,i,n,a)}function He(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function le(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function ce(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function On(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function jn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Ze(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=a*s,e}function Je(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function $n(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],l=r[2]*i[3]-r[3]*i[2],c=t[0],d=t[1],f=t[2],u=t[3];return e[0]=d*l-f*h+u*o,e[1]=-(c*l)+f*s-u*a,e[2]=c*h-d*s+u*n,e[3]=-(c*o)+d*a-f*n,e}function et(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e}function Fn(e,t){t=t||1;var r,i,n,a,s,o;do r=F()*2-1,i=F()*2-1,s=r*r+i*i;while(s>=1);do n=F()*2-1,a=F()*2-1,o=n*n+a*a;while(o>=1);var h=Math.sqrt((1-s)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*h,e[3]=t*a*h,e}function Gn(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,e}function qn(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],h=r[2],l=r[3],c=l*i+o*a-h*n,d=l*n+h*i-s*a,f=l*a+s*n-o*i,u=-s*i-o*n-h*a;return e[0]=c*l+u*-s+d*-h-f*-o,e[1]=d*l+u*-o+f*-s-c*-h,e[2]=f*l+u*-h+c*-o-d*-s,e[3]=t[3],e}function kn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Bn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function tt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function rt(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],h=t[2],l=t[3];return Math.abs(r-s)<=w*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=w*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=w*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-l)<=w*Math.max(1,Math.abs(a),Math.abs(l))}var Xn=Xe,Qn=Qe,Wn=We,Kn=Ye,Yn=He,Hn=le,Zn=ce,Jn=function(){var e=$e();return function(t,r,i,n,a,s){var o,h;for(r||(r=4),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}(),re=Object.freeze({__proto__:null,create:$e,clone:Fe,fromValues:Ge,copy:qe,set:ke,add:Be,subtract:Xe,multiply:Qe,divide:We,ceil:bn,floor:Un,min:Ln,max:zn,round:Nn,scale:Ke,scaleAndAdd:Vn,distance:Ye,squaredDistance:He,length:le,squaredLength:ce,negate:On,inverse:jn,normalize:Ze,dot:Je,cross:$n,lerp:et,random:Fn,transformMat4:Gn,transformQuat:qn,zero:kn,str:Bn,exactEquals:tt,equals:rt,sub:Xn,mul:Qn,div:Wn,dist:Kn,sqrDist:Yn,len:Hn,sqrLen:Zn,forEach:Jn});function fe(){var e=new C(4);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ei(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function nt(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function ti(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>w?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function ri(e,t){var r=it(e,t);return Math.acos(2*r*r-1)}function at(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],h=r[1],l=r[2],c=r[3];return e[0]=i*c+s*o+n*l-a*h,e[1]=n*c+s*h+a*o-i*l,e[2]=a*c+s*l+i*h-n*o,e[3]=s*c-i*o-n*h-a*l,e}function ni(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h+s*o,e[1]=n*h+a*o,e[2]=a*h-n*o,e[3]=s*h-i*o,e}function ii(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h-a*o,e[1]=n*h+s*o,e[2]=a*h+i*o,e[3]=s*h-n*o,e}function ai(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=i*h+n*o,e[1]=n*h-i*o,e[2]=a*h+s*o,e[3]=s*h-a*o,e}function si(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function st(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=Math.exp(a),h=s>0?o*Math.sin(s)/s:0;return e[0]=r*h,e[1]=i*h,e[2]=n*h,e[3]=o*Math.cos(s),e}function ot(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=s>0?Math.atan2(s,a)/s:0;return e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=.5*Math.log(r*r+i*i+n*n+a*a),e}function oi(e,t,r){return ot(e,t),ht(e,e,r),st(e,e),e}function ne(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],h=r[0],l=r[1],c=r[2],d=r[3],f,u,v,m,p;return u=n*h+a*l+s*c+o*d,u<0&&(u=-u,h=-h,l=-l,c=-c,d=-d),1-u>w?(f=Math.acos(u),v=Math.sin(f),m=Math.sin((1-i)*f)/v,p=Math.sin(i*f)/v):(m=1-i,p=i),e[0]=m*n+p*h,e[1]=m*a+p*l,e[2]=m*s+p*c,e[3]=m*o+p*d,e}function hi(e){var t=F(),r=F(),i=F(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function li(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e}function ci(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function lt(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[a*3+a]-t[s*3+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[a*3+s]-t[s*3+a])*i,e[a]=(t[a*3+n]+t[n*3+a])*i,e[s]=(t[s*3+n]+t[n*3+s])*i}return e}function fi(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),h=Math.cos(r),l=Math.sin(i),c=Math.cos(i);return e[0]=a*h*c-s*o*l,e[1]=s*o*c+a*h*l,e[2]=s*h*l-a*o*c,e[3]=s*h*c+a*o*l,e}function ui(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var di=Fe,pi=Ge,vi=qe,mi=ke,xi=Be,Mi=at,ht=Ke,it=Je,yi=et,ct=le,Ti=ct,ft=ce,gi=ft,ue=Ze,_i=tt,Ei=rt,Si=function(){var e=se(),t=oe(1,0,0),r=oe(0,1,0);return function(i,n,a){var s=he(n,a);return s<-.999999?(te(e,t,n),je(e)<1e-6&&te(e,r,n),Oe(e,e),nt(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(te(e,n,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,ue(i,i))}}(),Ai=function(){var e=fe(),t=fe();return function(r,i,n,a,s,o){return ne(e,i,s,o),ne(t,n,a,o),ne(r,e,t,2*o*(1-o)),r}}(),wi=function(){var e=or();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],ue(t,lt(t,e))}}(),q=Object.freeze({__proto__:null,create:fe,identity:ei,setAxisAngle:nt,getAxisAngle:ti,getAngle:ri,multiply:at,rotateX:ni,rotateY:ii,rotateZ:ai,calculateW:si,exp:st,ln:ot,pow:oi,slerp:ne,random:hi,invert:li,conjugate:ci,fromMat3:lt,fromEuler:fi,str:ui,clone:di,fromValues:pi,copy:vi,set:mi,add:xi,mul:Mi,scale:ht,dot:it,lerp:yi,length:ct,len:Ti,squaredLength:ft,sqrLen:gi,normalize:ue,exactEquals:_i,equals:Ei,rotationTo:Si,sqlerp:Ai,setAxes:wi});function ut(){var e=new C(2);return C!=Float32Array&&(e[0]=0,e[1]=0),e}function Pi(e){var t=new C(2);return t[0]=e[0],t[1]=e[1],t}function Ri(e,t){var r=new C(2);return r[0]=e,r[1]=t,r}function Ci(e,t){return e[0]=t[0],e[1]=t[1],e}function Ii(e,t,r){return e[0]=t,e[1]=r,e}function Di(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function dt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function pt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function vt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function bi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Ui(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Li(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function zi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Ni(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Vi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Oi(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function mt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function xt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Mt(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function yt(e){var t=e[0],r=e[1];return t*t+r*r}function ji(e,t){return e[0]=-t[0],e[1]=-t[1],e}function $i(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Fi(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function Gi(e,t){return e[0]*t[0]+e[1]*t[1]}function qi(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function ki(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e}function Bi(e,t){t=t||1;var r=F()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Xi(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function Qi(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function Wi(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function Ki(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function Yi(e,t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=n*o-a*s+r[0],e[1]=n*s+a*o+r[1],e}function Hi(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),o=s&&(r*n+i*a)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function Zi(e){return e[0]=0,e[1]=0,e}function Ji(e){return"vec2("+e[0]+", "+e[1]+")"}function ea(e,t){return e[0]===t[0]&&e[1]===t[1]}function ta(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=w*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))}var ra=Mt,na=dt,ia=pt,aa=vt,sa=mt,oa=xt,ha=yt,la=function(){var e=ut();return function(t,r,i,n,a,s){var o,h;for(r||(r=2),i||(i=0),n?h=Math.min(n*r+i,t.length):h=t.length,o=i;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}(),O=Object.freeze({__proto__:null,create:ut,clone:Pi,fromValues:Ri,copy:Ci,set:Ii,add:Di,subtract:dt,multiply:pt,divide:vt,ceil:bi,floor:Ui,min:Li,max:zi,round:Ni,scale:Vi,scaleAndAdd:Oi,distance:mt,squaredDistance:xt,length:Mt,squaredLength:yt,negate:ji,inverse:$i,normalize:Fi,dot:Gi,cross:qi,lerp:ki,random:Bi,transformMat2:Xi,transformMat2d:Qi,transformMat3:Wi,transformMat4:Ki,rotate:Yi,angle:Hi,zero:Zi,str:Ji,exactEquals:ea,equals:ta,len:ra,sub:na,mul:ia,div:aa,dist:sa,sqrDist:oa,sqrLen:ha,forEach:la});var j=Object.freeze({up:"up",down:"down",left:"left",right:"right"}),H=Object.create({w:j.up,s:j.down,d:j.right,a:j.left,ArrowUp:j.up,ArrowDown:j.down,ArrowRight:j.right,ArrowLeft:j.left});var ie=Object.freeze({Up:O.fromValues(0,1),Down:O.fromValues(0,-1),Left:O.fromValues(-1,0),Right:O.fromValues(1,0),Center:O.fromValues(0,0)}),Tt=class{constructor(){this._buttonState=Object.create({}),this._cacheKeyboardDirection=O.create()}GetButtonState(t){return!1}RegisterButtonEvent(t){window.addEventListener("click",r=>{t()})}RegisterMouseMovement(t,r){t.requestPointerLock();let i=[0,0];window.addEventListener("mousemove",n=>{i[0]=n.movementX,i[1]=n.movementY,r(i)})}RegisterMovementEvent(t){let r=this;this._keyboardCallback=t,window.addEventListener("keydown",i=>{i.key in H&&this.SetKeyboardState(H[i.key],!0)}),window.addEventListener("keyup",i=>{i.key in H&&this.SetKeyboardState(H[i.key],!1)})}OnUpdate(){this._cacheKeyboardDirection[0]=0,this._cacheKeyboardDirection[1]=0,this._buttonState.hasOwnProperty(j.left)&&O.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,ie.Left),this._buttonState.hasOwnProperty(j.down)&&O.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,ie.Down),this._buttonState.hasOwnProperty(j.right)&&O.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,ie.Right),this._buttonState.hasOwnProperty(j.up)&&O.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,ie.Up),this._keyboardCallback(this._cacheKeyboardDirection)}SetKeyboardState(t,r){r?this._buttonState[t]=!0:delete this._buttonState[t]}},gt=Tt;var de=.02;var _t=class{constructor(){this.inputHandler=new gt,this.inputHandler.RegisterMovementEvent(this.OnMovementEvent.bind(this)),this.inputHandler.RegisterButtonEvent(this.OnMouseClickEvent.bind(this))}async SetUp(t){this.katachi=t,this.katachiIsReady=await t.SetUp(this.UpdateLoop.bind(this));let r=document.querySelector("#webgl_canvas");this.katachiIsReady&&(this.inputHandler.RegisterMouseMovement(r,this.OnMouseEvent.bind(this)),this.mainQuad=t.shapeBuilder.BuildQuad(),this.mainCube=t.shapeBuilder.BuildCube(),this.mainCubeTwo=t.shapeBuilder.BuildCube(),this.mainFloor=t.shapeBuilder.BuildQuad(),this.mainQuad.transform.Scale(.2),this.mainQuad.transform.SetPosition(-1.2,0,-1),this.mainCube.transform.Scale(.5),this.mainCube.transform.position[2]=-2,this.mainCubeTwo.transform.Scale(.2),t.scene.SetParent(this.mainCube,this.mainCubeTwo),this.mainFloor.transform.Rotate(Math.PI*1.5,0,0),this.mainFloor.transform.position[1]=-.5,this.mainFloor.transform.Scale(5),t.scene.AddShapeObj(this.mainCube),t.scene.AddShapeObj(this.mainQuad),t.scene.AddShapeObj(this.mainFloor),t.scene.AddShapeObj(this.mainCubeTwo),this.katachi.materialManager.LoadTextureToObject(this.mainQuad,"u_mainTex","./texture/BrickTex_256.jpg"),this.katachi.materialManager.LoadTextureToObject(this.mainCube,"u_mainTex","./texture/Personal_01.png"),this.mainCube.SetCustomUniformAttr("u_mainColor",{value:[1,1,1,1],isMatrix:!1,function:this.katachi.webglContext.uniform4fv}),this.mainQuad.SetCustomUniformAttr("u_mainColor",{value:[0,0,1,1],isMatrix:!1,function:this.katachi.webglContext.uniform4fv}),this.mainFloor.SetCustomUniformAttr("u_mainColor",{value:[1,1,1,1],isMatrix:!1,function:this.katachi.webglContext.uniform4fv}))}OnMovementEvent(t){if(!this.katachiIsReady)return;let i=.02;this.katachi.scene.camera.transform.Translate(-t[0]*i,0,t[1]*i)}OnMouseEvent(t){let r=.3;this.katachi.scene.camera.transform.rotation[0]+=t[0]*de*r,this.katachi.scene.camera.transform.rotation[1]+=-t[1]*de*r;let i=.5*Math.PI;this.katachi.scene.camera.transform.rotation[1]>i&&(this.katachi.scene.camera.transform.rotation[1]=i),this.katachi.scene.camera.transform.rotation[1]<-i&&(this.katachi.scene.camera.transform.rotation[1]=-i)}OnMouseClickEvent(){let t=this.mainCubeTwo.transform.parent==null?this.mainCube.transform:null;console.log(t),this.mainCubeTwo.transform.SetParent(t)}UpdateLoop(t){this.inputHandler.OnUpdate(),!(this.katachi==null||this.mainQuad==null)&&this.mainCube.transform.Rotate(0,.01,0)}},Et=_t;var St=class{constructor(t){if(this.maxDrawBufferSize=2048,this._configJson=t,this._canvasDom=document.querySelector(t.canvas_dom_query),this._gl=this._canvasDom.getContext("webgl"),this._gl.enable(this._gl.DEPTH_TEST),this.AutoSetCanvasSize(),!this._gl.getExtension("WEBGL_depth_texture")){console.log("This WebGL program requires the use of the WEBGL_depth_texture extension. This extension is not supported by your browser, so this WEBGL program is terminating.");return}window.addEventListener("resize",()=>{this.AutoSetCanvasSize()})}get webglContext(){return this._gl}AutoSetCanvasSize(){this.SetCanvasToSceenSize(this._canvasDom.clientWidth,this._canvasDom.clientHeight)}SetCanvasToSceenSize(t,r){(t>this.maxDrawBufferSize||r>this.maxDrawBufferSize)&&(r=r>t?this.maxDrawBufferSize:this.maxDrawBufferSize*r/t,t=t>=r?this.maxDrawBufferSize:this.maxDrawBufferSize*t/r),console.log(t+", "+r),this._canvasDom.width=t,this._canvasDom.height=r}},At=St;var B=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function V(e,t,r){return r={path:t,exports:{},require:function(i,n){return ca(i,n==null?r.path:n)}},e(r,r.exports),r.exports}function ca(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var T=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;t.has=function(f,u){return r.call(f,u)};function i(f,u){return f<u?-1:f===u?0:1}t.defaultCompare=i;function n(f,u){return f===u}t.defaultEquals=n;function a(f){return f===null?"COLLECTION_NULL":h(f)?"COLLECTION_UNDEFINED":l(f)?"$s"+f:"$o"+f.toString()}t.defaultToString=a;function s(f,u){if(u===void 0&&(u=","),f===null)return"COLLECTION_NULL";if(h(f))return"COLLECTION_UNDEFINED";if(l(f))return f.toString();var v="{",m=!0;for(var p in f)t.has(f,p)&&(m?m=!1:v=v+u,v=v+p+":"+f[p]);return v+"}"}t.makeString=s;function o(f){return typeof f=="function"}t.isFunction=o;function h(f){return typeof f=="undefined"}t.isUndefined=h;function l(f){return Object.prototype.toString.call(f)==="[object String]"}t.isString=l;function c(f){return h(f)||!o(f)?function(u,v){return u<v?1:u===v?0:-1}:function(u,v){return f(u,v)*-1}}t.reverseCompareFunction=c;function d(f){return function(u,v){return f(u,v)===0}}t.compareToEquals=d}),G=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(f,u,v){for(var m=v||T.defaultEquals,p=f.length,x=0;x<p;x++)if(m(f[x],u))return x;return-1}t.indexOf=r;function i(f,u,v){for(var m=v||T.defaultEquals,p=f.length,x=p-1;x>=0;x--)if(m(f[x],u))return x;return-1}t.lastIndexOf=i;function n(f,u,v){return r(f,u,v)>=0}t.contains=n;function a(f,u,v){var m=r(f,u,v);return m<0?!1:(f.splice(m,1),!0)}t.remove=a;function s(f,u,v){for(var m=v||T.defaultEquals,p=f.length,x=0,S=0;S<p;S++)m(f[S],u)&&x++;return x}t.frequency=s;function o(f,u,v){var m=v||T.defaultEquals;if(f.length!==u.length)return!1;for(var p=f.length,x=0;x<p;x++)if(!m(f[x],u[x]))return!1;return!0}t.equals=o;function h(f){return f.concat()}t.copy=h;function l(f,u,v){if(u<0||u>=f.length||v<0||v>=f.length)return!1;var m=f[u];return f[u]=f[v],f[v]=m,!0}t.swap=l;function c(f){return"["+f.toString()+"]"}t.toString=c;function d(f,u){for(var v=0,m=f;v<m.length;v++){var p=m[v];if(u(p)===!1)return}}t.forEach=d}),X=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.table={},this.nElements=0,this.toStr=n||T.defaultToString}return i.prototype.getValue=function(n){var a=this.table["$"+this.toStr(n)];if(!T.isUndefined(a))return a.value},i.prototype.setValue=function(n,a){if(!(T.isUndefined(n)||T.isUndefined(a))){var s,o="$"+this.toStr(n),h=this.table[o];return T.isUndefined(h)?(this.nElements++,s=void 0):s=h.value,this.table[o]={key:n,value:a},s}},i.prototype.remove=function(n){var a="$"+this.toStr(n),s=this.table[a];if(!T.isUndefined(s))return delete this.table[a],this.nElements--,s.value},i.prototype.keys=function(){var n=[];for(var a in this.table)if(T.has(this.table,a)){var s=this.table[a];n.push(s.key)}return n},i.prototype.values=function(){var n=[];for(var a in this.table)if(T.has(this.table,a)){var s=this.table[a];n.push(s.value)}return n},i.prototype.forEach=function(n){for(var a in this.table)if(T.has(this.table,a)){var s=this.table[a],o=n(s.key,s.value);if(o===!1)return}},i.prototype.containsKey=function(n){return!T.isUndefined(this.getValue(n))},i.prototype.clear=function(){this.table={},this.nElements=0},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){var n="{";return this.forEach(function(a,s){n+=`
	`+a+" : "+s}),n+`
}`},i}();t.default=r}),wt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.dictionary=new X.default(n)}return i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.add=function(n){return this.contains(n)||T.isUndefined(n)?!1:(this.dictionary.setValue(n,n),!0)},i.prototype.intersection=function(n){var a=this;this.forEach(function(s){return n.contains(s)||a.remove(s),!0})},i.prototype.union=function(n){var a=this;n.forEach(function(s){return a.add(s),!0})},i.prototype.difference=function(n){var a=this;n.forEach(function(s){return a.remove(s),!0})},i.prototype.isSubsetOf=function(n){if(this.size()>n.size())return!1;var a=!0;return this.forEach(function(s){return n.contains(s)?!0:(a=!1,!1)}),a},i.prototype.remove=function(n){return this.contains(n)?(this.dictionary.remove(n),!0):!1},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){return n(s)})},i.prototype.toArray=function(){return this.dictionary.values()},i.prototype.isEmpty=function(){return this.dictionary.isEmpty()},i.prototype.size=function(){return this.dictionary.size()},i.prototype.clear=function(){this.dictionary.clear()},i.prototype.toString=function(){return G.toString(this.toArray())},i}();t.default=r}),fa=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.toStrF=n||T.defaultToString,this.dictionary=new X.default(this.toStrF),this.nElements=0}return i.prototype.add=function(n,a){if(a===void 0&&(a=1),T.isUndefined(n)||a<=0)return!1;if(this.contains(n))this.dictionary.getValue(n).copies+=a;else{var s={value:n,copies:a};this.dictionary.setValue(n,s)}return this.nElements+=a,!0},i.prototype.count=function(n){return this.contains(n)?this.dictionary.getValue(n).copies:0},i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.remove=function(n,a){if(a===void 0&&(a=1),T.isUndefined(n)||a<=0)return!1;if(this.contains(n)){var s=this.dictionary.getValue(n);return a>s.copies?this.nElements-=s.copies:this.nElements-=a,s.copies-=a,s.copies<=0&&this.dictionary.remove(n),!0}else return!1},i.prototype.toArray=function(){for(var n=[],a=this.dictionary.values(),s=0,o=a;s<o.length;s++)for(var h=o[s],l=h.value,c=h.copies,d=0;d<c;d++)n.push(l);return n},i.prototype.toSet=function(){for(var n=new wt.default(this.toStrF),a=this.dictionary.values(),s=0,o=a;s<o.length;s++){var h=o[s],l=h.value;n.add(l)}return n},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){for(var o=s.value,h=s.copies,l=0;l<h;l++)if(n(o)===!1)return!1;return!0})},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},i}();t.default=r}),pe=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.firstNode=null,this.lastNode=null,this.nElements=0}return i.prototype.add=function(n,a){if(T.isUndefined(a)&&(a=this.nElements),a<0||a>this.nElements||T.isUndefined(n))return!1;var s=this.createNode(n);if(this.nElements===0||this.lastNode===null)this.firstNode=s,this.lastNode=s;else if(a===this.nElements)this.lastNode.next=s,this.lastNode=s;else if(a===0)s.next=this.firstNode,this.firstNode=s;else{var o=this.nodeAtIndex(a-1);if(o===null)return!1;s.next=o.next,o.next=s}return this.nElements++,!0},i.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},i.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},i.prototype.elementAtIndex=function(n){var a=this.nodeAtIndex(n);if(a!==null)return a.element},i.prototype.indexOf=function(n,a){var s=a||T.defaultEquals;if(T.isUndefined(n))return-1;for(var o=this.firstNode,h=0;o!==null;){if(s(o.element,n))return h;h++,o=o.next}return-1},i.prototype.contains=function(n,a){return this.indexOf(n,a)>=0},i.prototype.remove=function(n,a){var s=a||T.defaultEquals;if(this.nElements<1||T.isUndefined(n))return!1;for(var o=null,h=this.firstNode;h!==null;){if(s(h.element,n))return o===null?(this.firstNode=h.next,h===this.lastNode&&(this.lastNode=null)):h===this.lastNode?(this.lastNode=o,o.next=h.next,h.next=null):(o.next=h.next,h.next=null),this.nElements--,!0;o=h,h=h.next}return!1},i.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},i.prototype.equals=function(n,a){var s=a||T.defaultEquals;return!(n instanceof i)||this.size()!==n.size()?!1:this.equalsAux(this.firstNode,n.firstNode,s)},i.prototype.equalsAux=function(n,a,s){for(;n!==null&&a!==null;){if(!s(n.element,a.element))return!1;n=n.next,a=a.next}return!0},i.prototype.removeElementAtIndex=function(n){if(!(n<0||n>=this.nElements||this.firstNode===null||this.lastNode===null)){var a;if(this.nElements===1)a=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var s=this.nodeAtIndex(n-1);s===null?(a=this.firstNode.element,this.firstNode=this.firstNode.next):s.next===this.lastNode&&(a=this.lastNode.element,this.lastNode=s),s!==null&&s.next!==null&&(a=s.next.element,s.next=s.next.next)}return this.nElements--,a}},i.prototype.forEach=function(n){for(var a=this.firstNode;a!==null&&n(a.element)!==!1;)a=a.next},i.prototype.reverse=function(){for(var n=null,a=this.firstNode,s=null;a!==null;)s=a.next,a.next=n,n=a,a=s;s=this.firstNode,this.firstNode=this.lastNode,this.lastNode=s},i.prototype.toArray=function(){for(var n=[],a=this.firstNode;a!==null;)n.push(a.element),a=a.next;return n},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){return G.toString(this.toArray())},i.prototype.nodeAtIndex=function(n){if(n<0||n>=this.nElements)return null;if(n===this.nElements-1)return this.lastNode;for(var a=this.firstNode,s=0;s<n&&a!==null;s++)a=a.next;return a},i.prototype.createNode=function(n){return{element:n,next:null}},i}();t.default=r}),Pt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new pe.default}return i.prototype.enqueue=function(n){return this.list.add(n)},i.prototype.add=function(n){return this.list.add(n)},i.prototype.dequeue=function(){if(this.list.size()!==0){var n=this.list.first();return this.list.removeElementAtIndex(0),n}},i.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.size()<=0},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),Rt=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.root=null,this.compare=n||T.defaultCompare,this.nElements=0}return i.prototype.add=function(n){return T.isUndefined(n)?!1:this.insertNode(this.createNode(n))!==null?(this.nElements++,!0):!1},i.prototype.clear=function(){this.root=null,this.nElements=0},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.size=function(){return this.nElements},i.prototype.contains=function(n){return T.isUndefined(n)?!1:this.searchNode(this.root,n)!==null},i.prototype.search=function(n){var a=this.searchNode(this.root,n);if(a!==null)return a.element},i.prototype.remove=function(n){var a=this.searchNode(this.root,n);return a===null?!1:(this.removeNode(a),this.nElements--,!0)},i.prototype.inorderTraversal=function(n){this.inorderTraversalAux(this.root,n,{stop:!1})},i.prototype.preorderTraversal=function(n){this.preorderTraversalAux(this.root,n,{stop:!1})},i.prototype.postorderTraversal=function(n){this.postorderTraversalAux(this.root,n,{stop:!1})},i.prototype.levelTraversal=function(n){this.levelTraversalAux(this.root,n)},i.prototype.minimum=function(){if(!(this.isEmpty()||this.root===null))return this.minimumAux(this.root).element},i.prototype.maximum=function(){if(!(this.isEmpty()||this.root===null))return this.maximumAux(this.root).element},i.prototype.forEach=function(n){this.inorderTraversal(n)},i.prototype.toArray=function(){var n=[];return this.inorderTraversal(function(a){return n.push(a),!0}),n},i.prototype.height=function(){return this.heightAux(this.root)},i.prototype.searchNode=function(n,a){for(var s=1;n!==null&&s!==0;)s=this.compare(a,n.element),s<0?n=n.leftCh:s>0&&(n=n.rightCh);return n},i.prototype.transplant=function(n,a){n.parent===null?this.root=a:n===n.parent.leftCh?n.parent.leftCh=a:n.parent.rightCh=a,a!==null&&(a.parent=n.parent)},i.prototype.removeNode=function(n){if(n.leftCh===null)this.transplant(n,n.rightCh);else if(n.rightCh===null)this.transplant(n,n.leftCh);else{var a=this.minimumAux(n.rightCh);a.parent!==n&&(this.transplant(a,a.rightCh),a.rightCh=n.rightCh,a.rightCh.parent=a),this.transplant(n,a),a.leftCh=n.leftCh,a.leftCh.parent=a}},i.prototype.inorderTraversalAux=function(n,a,s){n===null||s.stop||(this.inorderTraversalAux(n.leftCh,a,s),!s.stop&&(s.stop=a(n.element)===!1,!s.stop&&this.inorderTraversalAux(n.rightCh,a,s)))},i.prototype.levelTraversalAux=function(n,a){var s=new Pt.default;for(n!==null&&s.enqueue(n),n=s.dequeue()||null;n!=null;){if(a(n.element)===!1)return;n.leftCh!==null&&s.enqueue(n.leftCh),n.rightCh!==null&&s.enqueue(n.rightCh),n=s.dequeue()||null}},i.prototype.preorderTraversalAux=function(n,a,s){n===null||s.stop||(s.stop=a(n.element)===!1,!s.stop&&(this.preorderTraversalAux(n.leftCh,a,s),!s.stop&&this.preorderTraversalAux(n.rightCh,a,s)))},i.prototype.postorderTraversalAux=function(n,a,s){n===null||s.stop||(this.postorderTraversalAux(n.leftCh,a,s),!s.stop&&(this.postorderTraversalAux(n.rightCh,a,s),!s.stop&&(s.stop=a(n.element)===!1)))},i.prototype.minimumAux=function(n){for(;n!=null&&n.leftCh!==null;)n=n.leftCh;return n},i.prototype.maximumAux=function(n){for(;n!=null&&n.rightCh!==null;)n=n.rightCh;return n},i.prototype.heightAux=function(n){return n===null?-1:Math.max(this.heightAux(n.leftCh),this.heightAux(n.rightCh))+1},i.prototype.insertNode=function(n){for(var a=null,s=this.root;s!==null;){var o=this.compare(n.element,s.element);if(o===0)return null;o<0?(a=s,s=s.leftCh):(a=s,s=s.rightCh)}return n.parent=a,a===null?this.root=n:this.compare(n.element,a.element)<0?a.leftCh=n:a.rightCh=n,n},i.prototype.createNode=function(n){return{element:n,leftCh:null,rightCh:null,parent:null}},i}();t.default=r}),ua=V(function(e,t){var r=B&&B.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a}(Rt.default);t.default=i}),Ct=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.data=[],this.compare=n||T.defaultCompare}return i.prototype.leftChildIndex=function(n){return 2*n+1},i.prototype.rightChildIndex=function(n){return 2*n+2},i.prototype.parentIndex=function(n){return Math.floor((n-1)/2)},i.prototype.minIndex=function(n,a){return a>=this.data.length?n>=this.data.length?-1:n:this.compare(this.data[n],this.data[a])<=0?n:a},i.prototype.siftUp=function(n){for(var a=this.parentIndex(n);n>0&&this.compare(this.data[a],this.data[n])>0;)G.swap(this.data,a,n),n=a,a=this.parentIndex(n)},i.prototype.siftDown=function(n){for(var a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n));a>=0&&this.compare(this.data[n],this.data[a])>0;)G.swap(this.data,a,n),n=a,a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n))},i.prototype.peek=function(){if(this.data.length>0)return this.data[0]},i.prototype.add=function(n){return T.isUndefined(n)?!1:(this.data.push(n),this.siftUp(this.data.length-1),!0)},i.prototype.removeRoot=function(){if(this.data.length>0){var n=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),n}},i.prototype.contains=function(n){var a=T.compareToEquals(this.compare);return G.contains(this.data,n,a)},i.prototype.size=function(){return this.data.length},i.prototype.isEmpty=function(){return this.data.length<=0},i.prototype.clear=function(){this.data.length=0},i.prototype.forEach=function(n){G.forEach(this.data,n)},i}();t.default=r}),da=V(function(e,t){var r=B&&B.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,l){h.__proto__=l}||function(h,l){for(var c in l)l.hasOwnProperty(c)&&(h[c]=l[c])};return function(h,l){o(h,l);function c(){this.constructor=h}h.prototype=l===null?Object.create(l):(c.prototype=l.prototype,new c)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function o(h,l){this.key=h,this.value=l}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}(),n=function(){function o(){this.key=null,this.value=null}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}();function a(o){return!o.next}var s=function(o){r(h,o);function h(l){var c=o.call(this,l)||this;return c.head=new n,c.tail=new n,c.head.next=c.tail,c.tail.prev=c.head,c}return h.prototype.appendToTail=function(l){var c=this.tail.prev;c.next=l,l.prev=c,l.next=this.tail,this.tail.prev=l},h.prototype.getLinkedDictionaryPair=function(l){if(!T.isUndefined(l)){var c="$"+this.toStr(l),d=this.table[c];return d}},h.prototype.getValue=function(l){var c=this.getLinkedDictionaryPair(l);if(!T.isUndefined(c))return c.value},h.prototype.remove=function(l){var c=this.getLinkedDictionaryPair(l);if(!T.isUndefined(c))return o.prototype.remove.call(this,l),c.unlink(),c.value},h.prototype.clear=function(){o.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},h.prototype.replace=function(l,c){var d="$"+this.toStr(c.key);c.next=l.next,c.prev=l.prev,this.remove(l.key),c.prev.next=c,c.next.prev=c,this.table[d]=c,++this.nElements},h.prototype.setValue=function(l,c){if(!(T.isUndefined(l)||T.isUndefined(c))){var d=this.getLinkedDictionaryPair(l),f=new i(l,c),u="$"+this.toStr(l);if(T.isUndefined(d)){this.appendToTail(f),this.table[u]=f,++this.nElements;return}else return this.replace(d,f),d.value}},h.prototype.keys=function(){var l=[];return this.forEach(function(c,d){l.push(c)}),l},h.prototype.values=function(){var l=[];return this.forEach(function(c,d){l.push(d)}),l},h.prototype.forEach=function(l){for(var c=this.head.next;!a(c);){var d=l(c.key,c.value);if(d===!1)return;c=c.next}},h}(X.default);t.default=s}),pa=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n,a,s){s===void 0&&(s=!1),this.dict=new X.default(n),this.equalsF=a||T.defaultEquals,this.allowDuplicate=s}return i.prototype.getValue=function(n){var a=this.dict.getValue(n);return T.isUndefined(a)?[]:G.copy(a)},i.prototype.setValue=function(n,a){if(T.isUndefined(n)||T.isUndefined(a))return!1;var s=this.dict.getValue(n);return T.isUndefined(s)?(this.dict.setValue(n,[a]),!0):!this.allowDuplicate&&G.contains(s,a,this.equalsF)?!1:(s.push(a),!0)},i.prototype.remove=function(n,a){if(T.isUndefined(a)){var s=this.dict.remove(n);return!T.isUndefined(s)}var o=this.dict.getValue(n);return!T.isUndefined(o)&&G.remove(o,a,this.equalsF)?(o.length===0&&this.dict.remove(n),!0):!1},i.prototype.keys=function(){return this.dict.keys()},i.prototype.values=function(){for(var n=this.dict.values(),a=[],s=0,o=n;s<o.length;s++)for(var h=o[s],l=0,c=h;l<c.length;l++){var d=c[l];a.push(d)}return a},i.prototype.containsKey=function(n){return this.dict.containsKey(n)},i.prototype.clear=function(){this.dict.clear()},i.prototype.size=function(){return this.dict.size()},i.prototype.isEmpty=function(){return this.dict.isEmpty()},i}();t.default=r}),It=V(function(e,t){var r=B&&B.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(s,o){var h=n.call(this,o)||this;return h.defaultFactoryFunction=s,h}return a.prototype.setDefault=function(s,o){var h=n.prototype.getValue.call(this,s);return T.isUndefined(h)?(this.setValue(s,o),o):h},a.prototype.getValue=function(s){return this.setDefault(s,this.defaultFactoryFunction())},a}(X.default);t.default=i}),va=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.heap=new Ct.default(T.reverseCompareFunction(n))}return i.prototype.enqueue=function(n){return this.heap.add(n)},i.prototype.add=function(n){return this.heap.add(n)},i.prototype.dequeue=function(){if(this.heap.size()!==0){var n=this.heap.peek();return this.heap.removeRoot(),n}},i.prototype.peek=function(){return this.heap.peek()},i.prototype.contains=function(n){return this.heap.contains(n)},i.prototype.isEmpty=function(){return this.heap.isEmpty()},i.prototype.size=function(){return this.heap.size()},i.prototype.clear=function(){this.heap.clear()},i.prototype.forEach=function(n){this.heap.forEach(n)},i}();t.default=r}),ma=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new pe.default}return i.prototype.push=function(n){return this.list.add(n,0)},i.prototype.add=function(n){return this.list.add(n,0)},i.prototype.pop=function(){return this.list.removeElementAtIndex(0)},i.prototype.peek=function(){return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.isEmpty()},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),xa=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER",n[n.INSIDE_AT_END=2]="INSIDE_AT_END",n[n.INSIDE_AT_START=3]="INSIDE_AT_START"})(r||(r={}));var i=function(){function n(a,s){a===void 0&&(a=[]),s===void 0&&(s={}),this.rootIds=a,this.nodes=s,this.initRootIds(),this.initNodes()}return n.prototype.initRootIds=function(){for(var a=0,s=this.rootIds;a<s.length;a++){var o=s[a];this.createEmptyNodeIfNotExist(o)}},n.prototype.initNodes=function(){for(var a in this.nodes)if(this.nodes.hasOwnProperty(a))for(var s=0,o=this.nodes[a];s<o.length;s++){var h=o[s];this.createEmptyNodeIfNotExist(h)}},n.prototype.createEmptyNodeIfNotExist=function(a){this.nodes[a]||(this.nodes[a]=[])},n.prototype.getRootIds=function(){var a=this.rootIds.slice();return a},n.prototype.getNodes=function(){var a={};for(var s in this.nodes)this.nodes.hasOwnProperty(s)&&(a[s]=this.nodes[s].slice());return a},n.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},n.prototype.toObject=function(){return this.getObject()},n.prototype.flatten=function(){for(var a=this,s=[],o=0;o<this.rootIds.length;o++){var h=this.rootIds[o];s.push({id:h,level:0,hasParent:!1,childrenCount:0}),u(h,this.nodes,s,0)}for(var l=0,c=s;l<c.length;l++){var d=c[l];d.childrenCount=f(d.id)}return s;function f(v){if(a.nodes[v]){var m=a.nodes[v].length;return m}else return 0}function u(v,m,p,x){if(x===void 0&&(x=0),!(!v||!m||!p||!m[v])){x++;for(var S=m[v],M=0;M<S.length;M++){var y=S[M];p.push({id:y,level:x,hasParent:!0}),u(y,m,p,x)}x--}}},n.prototype.moveIdBeforeId=function(a,s){return this.moveId(a,s,r.BEFORE)},n.prototype.moveIdAfterId=function(a,s){return this.moveId(a,s,r.AFTER)},n.prototype.moveIdIntoId=function(a,s,o){return o===void 0&&(o=!0),o?this.moveId(a,s,r.INSIDE_AT_START):this.moveId(a,s,r.INSIDE_AT_END)},n.prototype.swapRootIdWithRootId=function(a,s){var o=this.findRootId(a),h=this.findRootId(s);this.swapRootPositionWithRootPosition(o,h)},n.prototype.swapRootPositionWithRootPosition=function(a,s){var o=this.rootIds[s];this.rootIds[s]=this.rootIds[a],this.rootIds[a]=o},n.prototype.deleteId=function(a){this.rootDeleteId(a),this.nodeAndSubNodesDelete(a),this.nodeRefrencesDelete(a)},n.prototype.insertIdBeforeId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o);for(var h in this.nodes)if(this.nodes.hasOwnProperty(h)){var l=this.findNodeId(h,a);l>-1&&this.insertIdIntoNode(h,s,l)}},n.prototype.insertIdAfterId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o+1);for(var h in this.nodes)if(this.nodes.hasOwnProperty(h)){var l=this.findNodeId(h,a);l>-1&&this.insertIdIntoNode(h,s,l+1)}},n.prototype.insertIdIntoId=function(a,s){this.nodeInsertAtEnd(a,s),this.nodes[s]=[]},n.prototype.insertIdIntoRoot=function(a,s){if(s===void 0)this.rootInsertAtEnd(a);else if(s<0){var o=this.rootIds.length;this.rootIds.splice(s+o+1,0,a)}else this.rootIds.splice(s,0,a);this.nodes[a]=this.nodes[a]||[]},n.prototype.insertIdIntoNode=function(a,s,o){if(this.nodes[a]=this.nodes[a]||[],this.nodes[s]=this.nodes[s]||[],o===void 0)this.nodeInsertAtEnd(a,s);else if(o<0){var h=this.nodes[a].length;this.nodes[a].splice(o+h+1,0,s)}else this.nodes[a].splice(o,0,s)},n.prototype.moveId=function(a,s,o){var h=a,l=this.findRootId(h);this.nodes[s];for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){this.findNodeId(c,s);break}var d=s,f=this.findRootId(d);this.nodes[s];for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){this.findNodeId(c,s);break}if(l>-1)if(f>-1)switch(this.rootDelete(l),f>l&&f--,o){case r.BEFORE:this.insertIdIntoRoot(h,f);break;case r.AFTER:this.insertIdIntoRoot(h,f+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,h);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,h);break}else{this.rootDelete(l);for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var u=this.findNodeId(c,d);if(u>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(c,h,u);break;case r.AFTER:this.insertIdIntoNode(c,h,u+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,h);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,h);break}break}}}else if(f>-1){for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var u=this.findNodeId(c,h);if(u>-1){this.nodeDeleteAtIndex(c,u);break}}switch(o){case r.BEFORE:this.insertIdIntoRoot(h,f);break;case r.AFTER:this.insertIdIntoRoot(h,f+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,h);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,h);break}}else{for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var u=this.findNodeId(c,h);if(u>-1){this.nodeDeleteAtIndex(c,u);break}}for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var u=this.findNodeId(c,d);if(u>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(c,h,u);break;case r.AFTER:this.insertIdIntoNode(c,h,u+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(d,h);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(d,h);break}break}}}},n.prototype.swapArrayElements=function(a,s,o){var h=a[s];return a[s]=a[o],a[o]=h,a},n.prototype.rootDeleteId=function(a){var s=this.findRootId(a);s>-1&&this.rootDelete(s)},n.prototype.nodeAndSubNodesDelete=function(a){for(var s=[],o=0;o<this.nodes[a].length;o++){var h=this.nodes[a][o];this.nodeAndSubNodesDelete(h),s.push(a)}this.nodeDelete(a);for(var o=0;o<s.length;o++)this.nodeDelete(s[o])},n.prototype.nodeRefrencesDelete=function(a){for(var s in this.nodes)if(this.nodes.hasOwnProperty(s))for(var o=0;o<this.nodes[s].length;o++){var h=this.nodes[s][o];h===a&&this.nodeDeleteAtIndex(s,o)}},n.prototype.nodeDelete=function(a){delete this.nodes[a]},n.prototype.findRootId=function(a){return this.rootIds.indexOf(a)},n.prototype.findNodeId=function(a,s){return this.nodes[a].indexOf(s)},n.prototype.findNode=function(a){return this.nodes[a]},n.prototype.nodeInsertAtStart=function(a,s){this.nodes[a].unshift(s)},n.prototype.nodeInsertAtEnd=function(a,s){this.nodes[a].push(s)},n.prototype.rootDelete=function(a){this.rootIds.splice(a,1)},n.prototype.nodeDeleteAtIndex=function(a,s){this.nodes[a].splice(s,1)},n.prototype.rootInsertAtStart=function(a){this.rootIds.unshift(a)},n.prototype.rootInsertAtEnd=function(a){this.rootIds.push(a)},n}();t.default=i}),Ma=V(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.arrays=G,t.Bag=fa.default,t.BSTree=ua.default,t.BSTreeKV=Rt.default,t.Dictionary=X.default,t.Heap=Ct.default,t.LinkedDictionary=da.default,t.LinkedList=pe.default,t.MultiDictionary=pa.default,t.FactoryDictionary=It.default;var r=It;t.DefaultDictionary=r.default,t.Queue=Pt.default,t.PriorityQueue=va.default,t.Set=wt.default,t.Stack=ma.default,t.MultiRootTree=xa.default,t.util=T}),Z=Ma.Dictionary;function Dt(e){return new Promise(t=>{let r=new Image;return r.crossOrigin="anonymous",r.src=e,r.onload=()=>t(Object.assign(r)),r})}function k(e){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.apply(null,Array(e)).map(function(){return t.charAt(Math.floor(Math.random()*t.length))}).join("")}function bt(e){let t=E.create(),r=2*(e[3]*e[0]+e[1]*e[2]),i=1-2*(e[0]*e[0]+e[1]*e[1]);t[0]=Math.atan2(r,i);let n=2*(e[3]*e[1]-e[2]*e[0]);Math.abs(n)>=1?t[1]=Math.sign(n):t[1]=Math.asin(n);let a=2*(e[3]*e[2]+e[0]*e[1]),s=1-2*(e[1]*e[1]+e[2]*e[2]);return t[2]=Math.atan2(a,s),t}var Ut;(function(e){e[e.Texture=0]="Texture",e[e.Shader=1]="Shader",e[e.GlMaterial=2]="GlMaterial"})(Ut||(Ut={}));var Lt=class{constructor(){this.textureCache=new Z,this.glResourceCache=new Z,this.glLocalTextureCache=new Z,this.glGlobalTextureCache=new Z}async PrepareVFShaders(t,r){let i=fetch(t,{method:"GET",credentials:"include"}),n=fetch(r,{method:"GET",credentials:"include"});return Promise.all([i,n]).then(a=>Promise.all([a[0].text(),a[1].text()])).then(a=>({vertex_shader:a[0],fragment_shader:a[1]}))}async GetImage(t){if(this.textureCache.containsKey(t))return this.textureCache.getValue(t);let r=await Dt(t);return this.textureCache.setValue(t,r),r}GetCacheSource(t){return this.glResourceCache.containsKey(t)?this.glResourceCache.getValue(t):null}SaveCacheSource(t,r){if(this.glResourceCache.containsKey(t))return this.glResourceCache.setValue(t,r)}CreateGLTexture(t,r,i,n,a,s){let o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,r,i,0,n,a,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),o}GetGLTextureSource(t,r){if(!this.glLocalTextureCache.containsKey(t))return null;let i=this.glLocalTextureCache.getValue(t);if(!this.glGlobalTextureCache.containsKey(i.texture_key))return null;let n=this.glGlobalTextureCache.getValue(i.texture_key);return i.localIndex=n.globalIndex-r,{globalType:n,localType:i}}SaveGlobalTextureSource(t,r,i){let n=i+this.glGlobalTextureCache.size(),a={texture:r,globalIndex:n};return this.glGlobalTextureCache.setValue(t,a),a}SaveGLTextureSource(t,r,i){let n={uniformLocation:i,localIndex:-1,texture_key:r};return this.glLocalTextureCache.setValue(t,n),n}},zt=Lt;var Nt=class{constructor(t,r,i){this.id=t,this.glProgram=r,this.glResource=i,this.cacheAttrShaderPosition={},this.cacheUniformShaderPosition={}}PreloadProperties(t,r){t.useProgram(this.glProgram),this.PreloadAttributeProperties(t,r.attributes),this.PreloadUniformProperties(t,r.uniforms),this.PreloadUniformTexture(t,r.texture)}PreloadAttributeProperties(t,r){Object.keys(r).forEach(i=>{var n=t.getAttribLocation(this.glProgram,i);let a=t.createBuffer();r[i].value!=null&&r[i].value.length>0&&(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r[i].value),t.STATIC_DRAW)),this.cacheAttrShaderPosition[i]={position_id:n,buffer:a,vertexPointer:r[i].vertexPointer}})}PreloadUniformProperties(t,r){let i=r.length;for(let n=0;n<i;n++){let a=t.getUniformLocation(this.glProgram,r[n]);a!=null&&(this.cacheUniformShaderPosition[r[n]]=a)}}PreloadUniformTexture(t,r){let i=r.length;for(let n=0;n<i;n++){let a=t.getUniformLocation(this.glProgram,r[n].id);if(a!=null){this.cacheUniformShaderPosition[r[n].id]=a;let s=this.id+r[n].id,o=r[n].texture===void 0?s:r[n].texture;if(this.glResource.SaveGLTextureSource(s,o,a),!this.glResource.glGlobalTextureCache.containsKey(o)){let h=t.createTexture(),l=this.glResource.SaveGlobalTextureSource(o,h,t.TEXTURE0);t.activeTexture(l.globalIndex),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),t.uniform1i(a,l.globalIndex-t.TEXTURE0)}}}}ExecuteAttributeProp(t,r,i){if(!(r in this.cacheAttrShaderPosition))return;let n=this.cacheAttrShaderPosition[r];if(!(n.position_id<0)){t.enableVertexAttribArray(n.position_id),t.bindBuffer(t.ARRAY_BUFFER,n.buffer),i!=null&&t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW);var a=n.vertexPointer.size,s=n.vertexPointer.type,o=n.vertexPointer.normalize,h=0,l=0;t.vertexAttribPointer(n.position_id,a,s,o,h,l)}}ExecuteUniformProp(t,r,i,n=!1){if(!(t in this.cacheUniformShaderPosition))return;let a=this.cacheUniformShaderPosition[t];n?i(a,!1,r):i(a,r)}ExecuteUniformSprite(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),console.log(r+", "+i.src+", "+n.globalType.globalIndex+", "+n.localType.localIndex),t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}ExecuteUniformTex(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}},ve=Nt;var Vt=class{constructor(t,r){this._gl=t,this._webglResource=r,this._shaderCache={}}GetGlShaderSet(t){return t in this._shaderCache?this._shaderCache[t]:null}async LoadTextureToObject(t,r,i){let n=await this._webglResource.GetImage(i);t.SetCustomUniformAttr(r,{isMatrix:!1,value:n,function:this._gl.uniform1i})}async LoadAndPrepareShaders(t){if(t==null)return!1;let r=t.length;for(let i=0;i<r;i++)await this.LoadAndPrepareShader(t[i].id,t[i].vertex,t[i].fragment);return!0}async LoadAndPrepareShader(t,r,i){if(t in this._shaderCache)return this._shaderCache[t];let n=await this._webglResource.PrepareVFShaders(r,i),a=this.CreateShader(this._gl.VERTEX_SHADER,n.vertex_shader),s=this.CreateShader(this._gl.FRAGMENT_SHADER,n.fragment_shader),o={vertShader:a,fragShader:s};return this._shaderCache[t]=o,o}async CreateMaterialFromRawPath(t,r,i){let n=await this.LoadAndPrepareShader(t,r,i),a=this.CreateGLProgram(n.vertShader,n.fragShader);return new ve(k(6),a,this._webglResource)}CreateMaterial(t,r){let i=this.CreateGLProgram(t,r);return new ve(k(6),i,this._webglResource)}CreateShader(t,r){let i=this._gl,n=i.createShader(t);i.shaderSource(n,r),i.compileShader(n);var a=i.getShaderParameter(n,i.COMPILE_STATUS);return a?n:(console.log(i.getShaderInfoLog(n)),i.deleteShader(n),null)}CreateGLProgram(t,r){let i=this._gl,n=i.createProgram();i.attachShader(n,t),i.attachShader(n,r),i.linkProgram(n);var a=i.getProgramParameter(n,i.LINK_STATUS);return a?n:(console.log(i.getProgramInfoLog(n)),i.deleteProgram(n),null)}},Ot=Vt;var jt=class{get vertCount(){return Math.round(this._meshData.vertex.length/4)}get meshData(){return this._meshData}constructor(t){this._meshData=t}SetVertex(t){this._meshData.vertex=t,this._meshData.nativeVertex=new Float32Array(t)}SetColor(t){this._meshData.color=t,this._meshData.nativecolor=new Float32Array(t)}SetUV(t){this._meshData.uv=t,this._meshData.nativeUV=new Float32Array(t)}SetNormal(t){this._meshData.normal=t,this._meshData.nativeNormal=new Float32Array(t)}},$t=jt;function me(){let e=ya(),t=_a([1,1,1,1],6),r=Ta(),i=ga();return{vertex:e,color:t,uv:r,normal:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(i),nativeUV:new Float32Array(r),nativecolor:new Float32Array(t)}}function ya(){return[-1,-1,0,1,-1,1,-0,1,1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]}function Ta(){return[0,0,0,1,1,0,1,0,0,1,1,1]}function ga(){return[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}function _a(e,t){let r=[];for(let i=0;i<t;i++)r=r.concat(e);return r}function xe(){let e=Ea(),t=Aa([1,1,1,1],36),r=Sa(6),i=wa([0,0,1],[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,-1]);return{vertex:e,color:t,uv:r,normal:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(i),nativeUV:new Float32Array(r),nativecolor:new Float32Array(t)}}function Ea(){return[-1,-1,1,1,-1,1,1,1,1,-1,1,1,1,-1,1,1,-1,1,1,1,1,1,1,1,1,-1,1,1,1,1,1,1,1,-1,-1,1,1,-1,-1,1,1,1,1,1,1,1,-1,1,-1,-1,1,1,-1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,1,-1,1,-1,1,-1,1,1,1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,1,1,1,-1,1,-1,-1,1,1,-1,-1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,-1,1,1,1,-1,1]}function Sa(e){let t=[];for(let r=0;r<e;r++)t=t.concat([0,0,0,1,1,0,1,0,0,1,1,1]);return t}function Aa(e,t){let r=[];for(let i=0;i<t;i++)r=r.concat(e);return r}function wa(...e){let t=[];for(let r=0;r<e.length;r++){let i=[];for(let n=0;n<6;n++)i=i.concat(e[r]);t=t.concat(i)}return t}var J={Standard:"glprogram@standard_material",Unlit:"glprogram@unlit_material",DepthMap:"glprogram@depth_material"};var Me={Quad:"mesh@quad",Cube:"mesh@cube"};var Ft=class{constructor(){this.meshCache={}}CreateQuad(){return this.CreateAndCacehMeshType(Me.Quad,me)}CreateCube(){return this.CreateAndCacehMeshType(Me.Cube,xe)}CreateAndCacehMeshType(t,r){if(t in this.meshCache)return this.meshCache[t];let i=r(),n=new $t(i);return this.meshCache[t]=n,n}},Gt=Ft;var A={vertex:"a_vertex",color:"a_color",uv:"a_uv",normal:"a_normal",time:"u_time",mainColor:"u_mainColor",mainTex:"u_mainTex",mainTex_Texel:"u_mainTex_Texel",modelMatrix:"u_modelMatrix",inverseTransposeModelMatrix:"u_inverseTransposeModelMatrix",modelViewProjectionMatrix:"u_MVPMatrix",directionLightDir:"u_directionLightDir",directionLightColor:"u_directionLightColor",ambientLightColor:"u_ambientLightColor",depthMapTexture:"u_depthTex",depthMapTex_Texel:"u_depthTex_Texel",lightSpaceMVPMatrix:"u_lightSpaceMVPMatrix"};function ae(e){return{attributes:{a_vertex:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!1}},a_uv:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:2,type:e.FLOAT,normalize:!1}},a_color:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!0}},a_normal:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:3,type:e.FLOAT,normalize:!0}}},uniforms:[A.time,A.mainColor,A.mainTex,A.modelMatrix,A.modelViewProjectionMatrix,A.inverseTransposeModelMatrix,A.directionLightColor,A.directionLightDir,A.ambientLightColor,A.lightSpaceMVPMatrix,A.depthMapTex_Texel,A.mainTex_Texel],texture:[{id:A.mainTex},{id:A.depthMapTexture,texture:A.depthMapTexture}],count:0}}var qt={up:E.fromValues(0,1,0),right:E.fromValues(1,0,0),forward:E.fromValues(0,0,1)},hs=Object.freeze({Radian2Degree:180/Math.PI,Degree2Radian:Math.PI*180});var ye=class{constructor(){this.cacheTVector={forward:E.create(),right:E.create(),top:E.create()}}UpdateTransformVector(t){return this.CalculateTransformVector(t,this.cacheTVector)}CalculateTransformVector(t,r){return r.forward=this.GetForward(t),r.right=this.GetRight(),r.top=this.GetUp(),r}GetTransformVector(){return this.cacheTVector}GetForward(t){return this.cacheTVector.forward[0]=Math.cos(t[0])*Math.cos(t[1]),this.cacheTVector.forward[1]=Math.sin(t[1]),this.cacheTVector.forward[2]=Math.sin(t[0])*Math.cos(t[1]),this.cacheTVector.forward}GetRight(){return E.cross(this.cacheTVector.right,qt.up,this.cacheTVector.forward),E.normalize(this.cacheTVector.right,this.cacheTVector.right)}GetUp(){return E.cross(this.cacheTVector.top,this.cacheTVector.forward,this.cacheTVector.right)}},kt=ye;var Te=class{constructor(t,r,i){this.translateVector=E.create(),this.translateVectorX=E.create(),this.translateVectorY=E.create(),this.translateVectorZ=E.create(),this.position=t,this._rotation=r,this.scale=i,this.quaterion=q.create(),q.fromEuler(this.quaterion,r[0],r[1],r[2]),this.relativePosition=E.create(),this.relativeRotation=E.create(),this.relativeScale=E.create(),this.relativeQuaterion=q.create(),this._relativeModelMatrix=R.create(),this._preSaveRelativeModelMatrix=R.create(),this._modelMatrix=R.create(),this._inverseTransposeMatrix=R.create(),this.transformVector=new kt,this._parent=null,this._children=[]}get rotation(){return this._rotation}get childCount(){return this.children.length}get children(){return this._children}get parent(){return this._parent}get InverseTransposeMatrix(){return R.invert(this._inverseTransposeMatrix,this._modelMatrix),R.transpose(this._inverseTransposeMatrix,this._inverseTransposeMatrix),this._inverseTransposeMatrix}get modelMatrix(){return this._modelMatrix}UpdateModelMatrix(){return this._parent==null?this.GetModelMatrix(this.position,this.scale,this.quaterion,this._modelMatrix):(this.GetModelMatrix(this.relativePosition,this.relativeScale,this.relativeQuaterion,this._relativeModelMatrix),R.mul(this._modelMatrix,this._parent.modelMatrix,this._relativeModelMatrix),this.SetTransformByMatrix(this.position,this.quaterion,this.rotation,this.scale,this._modelMatrix),this._modelMatrix)}GetModelMatrix(t,r,i,n){return R.fromRotationTranslationScale(n,i,t,r)}Scale(t){this.parent==null?E.scale(this.scale,this.scale,t):E.scale(this.relativeScale,this.relativeScale,t)}Translate(t,r,i){this.parent==null?this.ExecuteTranslate(t,r,i,this.rotation,this.position):this.ExecuteTranslate(t,r,i,this.relativeRotation,this.relativePosition)}SetPosition(t,r,i){this.parent==null?E.set(this.position,t,r,i):E.set(this.relativePosition,t,r,i)}ExecuteTranslate(t,r,i,n,a){let s=this.transformVector.UpdateTransformVector(n);E.scale(this.translateVectorX,s.right,t),E.scale(this.translateVectorY,s.top,r),E.scale(this.translateVectorZ,s.forward,i),E.add(this.translateVector,this.translateVectorX,this.translateVectorY),E.add(this.translateVector,this.translateVector,this.translateVectorZ),E.add(a,a,this.translateVector)}Rotate(t,r,i){this.parent==null?this.ExecuteRotate(t,r,i,this.quaterion):this.ExecuteRotate(t,r,i,this.relativeQuaterion)}SetEuler(t,r,i){this.parent==null?this.ExecuteEuler(t,r,i,this.quaterion,this._rotation):this.ExecuteEuler(t,r,i,this.relativeQuaterion,this.relativeRotation)}ExecuteRotate(t,r,i,n){q.rotateX(n,n,t),q.rotateY(n,n,r),q.rotateZ(n,n,i)}ExecuteEuler(t,r,i,n,a){a[0]=t,a[1]=r,a[2]=i,q.fromEuler(n,t,r,i)}UpdateRelativeTransformByParent(t){if(t==null){this.SetTransformByMatrix(this.position,this.quaterion,this.rotation,this.scale,this._modelMatrix);return}let r=this.GetModelMatrix(this.position,this.scale,this.quaterion,this.modelMatrix),i=R.create();R.invert(i,t.UpdateModelMatrix()),R.mul(this._preSaveRelativeModelMatrix,i,r),this.SetTransformByMatrix(this.relativePosition,this.relativeQuaterion,this.relativeRotation,this.relativeScale,this._preSaveRelativeModelMatrix)}SetTransformByMatrix(t,r,i,n,a){t=R.getTranslation(t,a),r=R.getRotation(r,a),i=bt(r),n=R.getScaling(n,a)}SetParent(t){this._parent=t,t!=null&&(this.parent!=null&&this.parent.RemoveChildren(this),t.AppendChild(this),this.UpdateRelativeTransformByParent(t))}AppendChild(t){this._children.findIndex(i=>i==t)<0&&this._children.push(t)}RemoveChildren(t){let r=this._children.findIndex(i=>i==t);r>=0&&this._children.splice(r,1)}};function Bt(){let e=E.create(),t=E.create(),r=E.fromValues(1,1,1);return new Te(e,t,r)}var Xt=Te;var ge=class{constructor(){this.id="",this.name="NoName",this.transform=Bt()}},Q=ge;var Qt=class extends Q{constructor(t,r,i){super();this.transform=t,this.mesh=r,this.material=i,this.modelViewProjectionMatrix=R.create(),this.matUniformAttributes={}}SetMesh(t){this.mesh=t}SetCustomUniformAttrs(t){this.matUniformAttributes=t}SetCustomUniformAttr(t,r){this.matUniformAttributes[t]=r}GetMVPMatrix(t,r){let i=R.mul(this.modelViewProjectionMatrix,t,this.transform.modelMatrix);return R.mul(this.modelViewProjectionMatrix,r,i)}ProcessMaterialAttr(t,r){r.ExecuteAttributeProp(t,A.vertex,this.mesh.meshData.nativeVertex),r.ExecuteAttributeProp(t,A.color,this.mesh.meshData.nativecolor),r.ExecuteAttributeProp(t,A.uv,this.mesh.meshData.nativeUV),r.ExecuteAttributeProp(t,A.normal,this.mesh.meshData.nativeNormal)}ProcessMaterialUniform(t,r,i,n,a,s,o,h,l){r.ExecuteUniformProp(A.time,i,t.uniform1f.bind(t)),r.ExecuteUniformProp(A.modelMatrix,n,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(A.inverseTransposeModelMatrix,a,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(A.modelViewProjectionMatrix,s,t.uniformMatrix4fv.bind(t),!0),o!=null&&(r.ExecuteUniformProp(A.directionLightDir,o.directionLigth.transform.transformVector.GetTransformVector().forward,t.uniform3fv.bind(t)),r.ExecuteUniformProp(A.directionLightColor,o.directionLigth.color,t.uniform4fv.bind(t)),r.ExecuteUniformProp(A.lightSpaceMVPMatrix,o.directionLigth.projection.spaceMatrix,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(A.ambientLightColor,o.ambient_light,t.uniform4fv.bind(t))),h!=null&&(r.ExecuteUniformTex(t,A.depthMapTexture,h),r.ExecuteUniformProp(A.depthMapTex_Texel,l,t.uniform2fv.bind(t)),Object.keys(this.matUniformAttributes).forEach(c=>{if(this.matUniformAttributes[c].value instanceof HTMLImageElement){let d=this.matUniformAttributes[c].value;r.ExecuteUniformSprite(t,c,this.matUniformAttributes[c].value),r.ExecuteUniformProp(A.mainTex_Texel,O.fromValues(1/d.width,1/d.height),t.uniform2fv.bind(t))}else r.ExecuteUniformProp(c,this.matUniformAttributes[c].value,this.matUniformAttributes[c].function.bind(t),this.matUniformAttributes[c].isMatrix)}),this.matUniformAttributes={})}},Wt=Qt;var Kt=class{constructor(t,r,i){this._gl=t,this._materialManager=r,this._meshManager=i}Build(t,r,i){let n=new Xt(E.create(),E.create(),E.fromValues(1,1,1)),a=new Wt(n,r,i);a.name=t,a.id=k(11);let s=ae(this._gl);return s.attributes[A.vertex].value=r.meshData.vertex,s.attributes[A.uv].value=r.meshData.uv,s.attributes[A.color].value=r.meshData.color,s.attributes[A.normal].value=r.meshData.normal,i.PreloadProperties(this._gl,s),a}BuildQuad(){let t=this._meshManager.CreateQuad(),r=this._materialManager.GetGlShaderSet(J.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Quad",t,i)}BuildCube(){let t=this._meshManager.CreateCube(),r=this._materialManager.GetGlShaderSet(J.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Cube",t,i)}},Yt=Kt;var W;(function(e){e[e.Orthographic=0]="Orthographic",e[e.Perspective=1]="Perspective"})(W||(W={}));var ee=class{constructor(t,r){this.farClipPoint=15,this.nearClipPoint=.3,this._foxyPerspective=60,this._sizeOrtho=3,this.transform=t,this.lookUpPoint=E.create(),this.upDirMatrix=E.fromValues(0,1,0),this._viewMatrix=R.create(),this._projectionMatrix=R.create(),this._spaceMatrix=R.create(),this.projectionType=r}get projectionMatrix(){return this._projectionMatrix}get viewMatrix(){let t=this.transform.transformVector.UpdateTransformVector(this.transform.rotation);return E.add(this.lookUpPoint,this.transform.position,t.forward),R.lookAt(this._viewMatrix,this.transform.position,this.lookUpPoint,this.upDirMatrix)}get spaceMatrix(){return R.mul(this._spaceMatrix,this.projectionMatrix,this.viewMatrix)}set projectionType(t){this._projectionType=t,this.UpdateProjectionMatrix()}set aspectRatio(t){this._aspectRatio=t,this.UpdateProjectionMatrix()}set sizeOrtho(t){this._sizeOrtho=t,this.UpdateProjectionMatrix()}set foxyPerspective(t){this._foxyPerspective=t,this.UpdateProjectionMatrix()}UpdateProjectionMatrix(){return this._projectionType==0?this._projectionMatrix=this.GetOrthographicMatrix(-this._sizeOrtho*this._aspectRatio,this._sizeOrtho*this._aspectRatio,-this._sizeOrtho,this._sizeOrtho,this.nearClipPoint,this.farClipPoint):this._projectionMatrix=this.GetPerspectiveMatrix(this._foxyPerspective,this._aspectRatio,this.nearClipPoint,this.farClipPoint),this._projectionMatrix}GetOrthographicMatrix(t,r,i,n,a,s){return R.ortho(this._projectionMatrix,t,r,i,n,a,s)}GetPerspectiveMatrix(t,r,i,n){return t=t*(Math.PI/180),R.perspective(this._projectionMatrix,t,r,i,n)}};var Ht=class extends Q{constructor(){super();this.id=k(8),this.name="MainCamera",this.transform.rotation[0]=1.5*Math.PI,this.projection=new ee(this.transform,W.Perspective)}},Zt=Ht;var _e=class extends Q{constructor(){super();this.color=re.fromValues(1,1,1,1),this.offsetPostion=E.fromValues(3,9,3),this.transform.SetEuler(Math.PI*.3,Math.PI*1.35,0),this.transform.transformVector.UpdateTransformVector(this.transform.rotation),this.projection=new ee(this.transform,W.Orthographic),this.projection.sizeOrtho=6}},Jt=_e;var Ee=class{constructor(){this.directionLigth=new Jt,this.ambient_light=re.fromValues(.2,.2,.2,1)}SyncLightRelativePosToCamera(t){E.add(this.directionLigth.transform.position,this.directionLigth.offsetPostion,t.position),this.directionLigth.transform.position[1]=this.directionLigth.offsetPostion[1]}},er=Ee;var tr=class{get shapeArray(){return this._shapeArray}constructor(){this._shapeArray=[],this.camera=new Zt,this.lights=new er}AddShapeObj(t){this._shapeArray.push(t)}RemoveShapeObj(t){let r=this._shapeArray.findIndex(i=>i.id=t);r>=0&&this._shapeArray.splice(r,1)}SetParent(t,r){if(r.transform.SetParent(t.transform),t==null)return;let i=this._shapeArray.findIndex(n=>n.id=t.id);i>=0&&(this.RemoveShapeObj(r.id),this._shapeArray.splice(i+1,0,r))}},rr=tr;var nr=class{get depthMapTex(){return this._depthMapTex}get colorDepthMapTex(){return this._colorDepthMapTex}get depthFrameBuffer(){return this._depthFrameBuffer}get depthMaterial(){return this._depthMaterial}constructor(t,r,i){this.gl=t,this.webglResouceAlloc=r,this.materialManager=i}CacheDepthMaterial(){let t=this.materialManager.GetGlShaderSet(J.DepthMap);this._depthMaterial=this.materialManager.CreateMaterial(t.vertShader,t.fragShader);let r=ae(this.gl);this._depthMaterial.PreloadProperties(this.gl,r)}PrepareDepthFrameBuffer(t,r){let i=this.gl;this._colorDepthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.RGBA,i.UNSIGNED_BYTE,null),this._depthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),this._depthFrameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._depthFrameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._colorDepthMapTex,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this._depthMapTex,0),this.webglResouceAlloc.SaveGlobalTextureSource(A.depthMapTexture,this._depthMapTex,i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}},ir=nr;var ar=class extends At{constructor(t){super(t);this.previousTimeStamp=0,this.targetTextureWidth=512,this.targetTextureHeight=512,this.targetTextureTexel=O.fromValues(1/this.targetTextureWidth,1/this.targetTextureHeight),this.configJson=t,this.webglResouceAlloc=new zt,this.materialManager=new Ot(this._gl,this.webglResouceAlloc),this.meshManager=new Gt,this.shapeBuilder=new Yt(this._gl,this.materialManager,this.meshManager),this.webglDepthBuffer=new ir(this._gl,this.webglResouceAlloc,this.materialManager),this.scene=new rr}get isKatachiValid(){return this._gl!=null}async SetUp(t){return this.isKatachiValid?(this.UpdateLoopCallback=t,await this.materialManager.LoadAndPrepareShaders(this.configJson.shaders),this.webglDepthBuffer.PrepareDepthFrameBuffer(this.targetTextureWidth,this.targetTextureHeight),this.webglDepthBuffer.CacheDepthMaterial(),window.requestAnimationFrame(this.PerformGameLoop.bind(this)),!0):!1}PerformGameLoop(t){let r=(t-this.previousTimeStamp)/1e3;this.time=t/1e3,this.previousTimeStamp=t,this.UpdateLoopCallback!=null&&this.UpdateLoopCallback(this.time),this.scene.lights!=null&&this.time%.5>.45&&this.scene.lights.SyncLightRelativePosToCamera(this.scene.camera.transform),this.DrawCanvas(this.webglDepthBuffer.depthFrameBuffer,this.webglDepthBuffer.depthMaterial,this.scene.lights.directionLigth.projection,this.targetTextureWidth,this.targetTextureHeight),this.DrawCanvas(null,null,this.scene.camera.projection,this._gl.canvas.width,this._gl.canvas.height),window.requestAnimationFrame(this.PerformGameLoop.bind(this))}DrawCanvas(t,r,i,n,a){let s=this._gl;this.currentFrameBuffer=t,s.bindFramebuffer(s.FRAMEBUFFER,t),s.viewport(0,0,n,a),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),i.aspectRatio=n/a;let o=i.viewMatrix,h=i.projectionMatrix;for(var l in this.scene.shapeArray){let c=this.scene.shapeArray[l];this.ProcessShapeObject(c,o,h,r)}}ProcessShapeObject(t,r,i,n){let a=n==null?t.material:n;this._gl.useProgram(a.glProgram),t.transform.UpdateModelMatrix();let s=t.GetMVPMatrix(r,i);t.ProcessMaterialAttr(this._gl,a),t.ProcessMaterialUniform(this._gl,a,this.time,t.transform.modelMatrix,t.transform.InverseTransposeMatrix,s,this.scene.lights,this.currentFrameBuffer==null?this.webglDepthBuffer.depthMapTex:null,this.targetTextureTexel);var o=this._gl.TRIANGLES,h=0,l=t.mesh.vertCount;this._gl.drawArrays(o,h,l)}},sr=ar;window.onload=()=>{fetch("./Dataset/katachi_basic_layout.json").then(function(e){return e.json()}).then(function(e){let t=new sr(e);new Et().SetUp(t)})};
//# sourceMappingURL=index.js.map
