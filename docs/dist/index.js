var w=1e-6,C=typeof Float32Array!="undefined"?Float32Array:Array,B=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Nr(){var e=new C(9);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function re(){var e=new C(16);return C!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new C(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Or(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Me(e,t,r,i,n,a,s,o,l,h,c,u,f,d,p,m){var v=new C(16);return v[0]=e,v[1]=t,v[2]=r,v[3]=i,v[4]=n,v[5]=a,v[6]=s,v[7]=o,v[8]=l,v[9]=h,v[10]=c,v[11]=u,v[12]=f,v[13]=d,v[14]=p,v[15]=m,v}function jr(e,t,r,i,n,a,s,o,l,h,c,u,f,d,p,m,v){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=f,e[12]=d,e[13]=p,e[14]=m,e[15]=v,e}function Qe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Vr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],x=t[15],A=r*o-i*s,T=r*l-n*s,_=r*h-a*s,E=i*l-n*o,S=i*h-a*o,U=n*h-a*l,I=c*m-u*p,b=c*v-f*p,D=c*x-d*p,L=u*v-f*m,N=u*x-d*m,O=f*x-d*v,R=A*O-T*N+_*L+E*D-S*b+U*I;return R?(R=1/R,e[0]=(o*O-l*N+h*L)*R,e[1]=(n*N-i*O-a*L)*R,e[2]=(m*U-v*S+x*E)*R,e[3]=(f*S-u*U-d*E)*R,e[4]=(l*D-s*O-h*b)*R,e[5]=(r*O-n*D+a*b)*R,e[6]=(v*_-p*U-x*T)*R,e[7]=(c*U-f*_+d*T)*R,e[8]=(s*N-o*D+h*I)*R,e[9]=(i*D-r*N-a*I)*R,e[10]=(p*S-m*_+x*A)*R,e[11]=(u*_-c*S-d*A)*R,e[12]=(o*b-s*L-l*I)*R,e[13]=(r*L-i*b+n*I)*R,e[14]=(m*T-p*E-v*A)*R,e[15]=(c*E-u*T+f*A)*R,e):null}function Fr(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],x=t[15];return e[0]=o*(f*x-d*v)-u*(l*x-h*v)+m*(l*d-h*f),e[1]=-(i*(f*x-d*v)-u*(n*x-a*v)+m*(n*d-a*f)),e[2]=i*(l*x-h*v)-o*(n*x-a*v)+m*(n*h-a*l),e[3]=-(i*(l*d-h*f)-o*(n*d-a*f)+u*(n*h-a*l)),e[4]=-(s*(f*x-d*v)-c*(l*x-h*v)+p*(l*d-h*f)),e[5]=r*(f*x-d*v)-c*(n*x-a*v)+p*(n*d-a*f),e[6]=-(r*(l*x-h*v)-s*(n*x-a*v)+p*(n*h-a*l)),e[7]=r*(l*d-h*f)-s*(n*d-a*f)+c*(n*h-a*l),e[8]=s*(u*x-d*m)-c*(o*x-h*m)+p*(o*d-h*u),e[9]=-(r*(u*x-d*m)-c*(i*x-a*m)+p*(i*d-a*u)),e[10]=r*(o*x-h*m)-s*(i*x-a*m)+p*(i*h-a*o),e[11]=-(r*(o*d-h*u)-s*(i*d-a*u)+c*(i*h-a*o)),e[12]=-(s*(u*v-f*m)-c*(o*v-l*m)+p*(o*f-l*u)),e[13]=r*(u*v-f*m)-c*(i*v-n*m)+p*(i*f-n*u),e[14]=-(r*(o*v-l*m)-s*(i*v-n*m)+p*(i*l-n*o)),e[15]=r*(o*f-l*u)-s*(i*f-n*u)+c*(i*l-n*o),e}function Br(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15],x=t*s-r*a,A=t*o-i*a,T=t*l-n*a,_=r*o-i*s,E=r*l-n*s,S=i*l-n*o,U=h*p-c*d,I=h*m-u*d,b=h*v-f*d,D=c*m-u*p,L=c*v-f*p,N=u*v-f*m;return x*N-A*L+T*D+_*b-E*I+S*U}function fe(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],x=t[14],A=t[15],T=r[0],_=r[1],E=r[2],S=r[3];return e[0]=T*i+_*o+E*u+S*m,e[1]=T*n+_*l+E*f+S*v,e[2]=T*a+_*h+E*d+S*x,e[3]=T*s+_*c+E*p+S*A,T=r[4],_=r[5],E=r[6],S=r[7],e[4]=T*i+_*o+E*u+S*m,e[5]=T*n+_*l+E*f+S*v,e[6]=T*a+_*h+E*d+S*x,e[7]=T*s+_*c+E*p+S*A,T=r[8],_=r[9],E=r[10],S=r[11],e[8]=T*i+_*o+E*u+S*m,e[9]=T*n+_*l+E*f+S*v,e[10]=T*a+_*h+E*d+S*x,e[11]=T*s+_*c+E*p+S*A,T=r[12],_=r[13],E=r[14],S=r[15],e[12]=T*i+_*o+E*u+S*m,e[13]=T*n+_*l+E*f+S*v,e[14]=T*a+_*h+E*d+S*x,e[15]=T*s+_*c+E*p+S*A,e}function ye(e,t,r){var i=r[0],n=r[1],a=r[2],s,o,l,h,c,u,f,d,p,m,v,x;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],l=t[2],h=t[3],c=t[4],u=t[5],f=t[6],d=t[7],p=t[8],m=t[9],v=t[10],x=t[11],e[0]=s,e[1]=o,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=f,e[7]=d,e[8]=p,e[9]=m,e[10]=v,e[11]=x,e[12]=s*i+c*n+p*a+t[12],e[13]=o*i+u*n+m*a+t[13],e[14]=l*i+f*n+v*a+t[14],e[15]=h*i+d*n+x*a+t[15]),e}function Te(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Gr(e,t,r,i){var n=i[0],a=i[1],s=i[2],o=Math.hypot(n,a,s),l,h,c,u,f,d,p,m,v,x,A,T,_,E,S,U,I,b,D,L,N,O,R,F;return o<w?null:(o=1/o,n*=o,a*=o,s*=o,l=Math.sin(r),h=Math.cos(r),c=1-h,u=t[0],f=t[1],d=t[2],p=t[3],m=t[4],v=t[5],x=t[6],A=t[7],T=t[8],_=t[9],E=t[10],S=t[11],U=n*n*c+h,I=a*n*c+s*l,b=s*n*c-a*l,D=n*a*c-s*l,L=a*a*c+h,N=s*a*c+n*l,O=n*s*c+a*l,R=a*s*c-n*l,F=s*s*c+h,e[0]=u*U+m*I+T*b,e[1]=f*U+v*I+_*b,e[2]=d*U+x*I+E*b,e[3]=p*U+A*I+S*b,e[4]=u*D+m*L+T*N,e[5]=f*D+v*L+_*N,e[6]=d*D+x*L+E*N,e[7]=p*D+A*L+S*N,e[8]=u*O+m*R+T*F,e[9]=f*O+v*R+_*F,e[10]=d*O+x*R+E*F,e[11]=p*O+A*R+S*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function $r(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+h*i,e[5]=s*n+c*i,e[6]=o*n+u*i,e[7]=l*n+f*i,e[8]=h*n-a*i,e[9]=c*n-s*i,e[10]=u*n-o*i,e[11]=f*n-l*i,e}function qr(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-h*i,e[1]=s*n-c*i,e[2]=o*n-u*i,e[3]=l*n-f*i,e[8]=a*i+h*n,e[9]=s*i+c*n,e[10]=o*i+u*n,e[11]=l*i+f*n,e}function kr(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],h=t[4],c=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+h*i,e[1]=s*n+c*i,e[2]=o*n+u*i,e[3]=l*n+f*i,e[4]=h*n-a*i,e[5]=c*n-s*i,e[6]=u*n-o*i,e[7]=f*n-l*i,e}function Xr(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Wr(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kr(e,t,r){var i=r[0],n=r[1],a=r[2],s=Math.hypot(i,n,a),o,l,h;return s<w?null:(s=1/s,i*=s,n*=s,a*=s,o=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=i*i*h+l,e[1]=n*i*h+a*o,e[2]=a*i*h-n*o,e[3]=0,e[4]=i*n*h-a*o,e[5]=n*n*h+l,e[6]=a*n*h+i*o,e[7]=0,e[8]=i*a*h+n*o,e[9]=n*a*h-i*o,e[10]=a*a*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Qr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ye(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=i+i,l=n+n,h=a+a,c=i*o,u=i*l,f=i*h,d=n*l,p=n*h,m=a*h,v=s*o,x=s*l,A=s*h;return e[0]=1-(d+m),e[1]=u+A,e[2]=f-x,e[3]=0,e[4]=u-A,e[5]=1-(c+m),e[6]=p+v,e[7]=0,e[8]=f+x,e[9]=p-v,e[10]=1-(c+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Zr(e,t){var r=new C(3),i=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=i*i+n*n+a*a+s*s;return u>0?(r[0]=(o*s+c*i+l*a-h*n)*2/u,r[1]=(l*s+c*n+h*i-o*a)*2/u,r[2]=(h*s+c*a+o*n-l*i)*2/u):(r[0]=(o*s+c*i+l*a-h*n)*2,r[1]=(l*s+c*n+h*i-o*a)*2,r[2]=(h*s+c*a+o*n-l*i)*2),Ye(e,t,r),e}function Jr(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function He(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(l,h,c),e}function en(e,t){var r=new C(3);He(r,t);var i=1/r[0],n=1/r[1],a=1/r[2],s=t[0]*i,o=t[1]*n,l=t[2]*a,h=t[4]*i,c=t[5]*n,u=t[6]*a,f=t[8]*i,d=t[9]*n,p=t[10]*a,m=s+c+p,v=0;return m>0?(v=Math.sqrt(m+1)*2,e[3]=.25*v,e[0]=(u-d)/v,e[1]=(f-l)/v,e[2]=(o-h)/v):s>c&&s>p?(v=Math.sqrt(1+s-c-p)*2,e[3]=(u-d)/v,e[0]=.25*v,e[1]=(o+h)/v,e[2]=(f+l)/v):c>p?(v=Math.sqrt(1+c-s-p)*2,e[3]=(f-l)/v,e[0]=(o+h)/v,e[1]=.25*v,e[2]=(u+d)/v):(v=Math.sqrt(1+p-s-c)*2,e[3]=(o-h)/v,e[0]=(f+l)/v,e[1]=(u+d)/v,e[2]=.25*v),e}function tn(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,h=a+a,c=s+s,u=n*l,f=n*h,d=n*c,p=a*h,m=a*c,v=s*c,x=o*l,A=o*h,T=o*c,_=i[0],E=i[1],S=i[2];return e[0]=(1-(p+v))*_,e[1]=(f+T)*_,e[2]=(d-A)*_,e[3]=0,e[4]=(f-T)*E,e[5]=(1-(u+v))*E,e[6]=(m+x)*E,e[7]=0,e[8]=(d+A)*S,e[9]=(m-x)*S,e[10]=(1-(u+p))*S,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rn(e,t,r,i,n){var a=t[0],s=t[1],o=t[2],l=t[3],h=a+a,c=s+s,u=o+o,f=a*h,d=a*c,p=a*u,m=s*c,v=s*u,x=o*u,A=l*h,T=l*c,_=l*u,E=i[0],S=i[1],U=i[2],I=n[0],b=n[1],D=n[2],L=(1-(m+x))*E,N=(d+_)*E,O=(p-T)*E,R=(d-_)*S,F=(1-(f+x))*S,ee=(v+A)*S,te=(p+T)*U,Xe=(v-A)*U,We=(1-(f+m))*U;return e[0]=L,e[1]=N,e[2]=O,e[3]=0,e[4]=R,e[5]=F,e[6]=ee,e[7]=0,e[8]=te,e[9]=Xe,e[10]=We,e[11]=0,e[12]=r[0]+I-(L*I+R*b+te*D),e[13]=r[1]+b-(N*I+F*b+Xe*D),e[14]=r[2]+D-(O*I+ee*b+We*D),e[15]=1,e}function _e(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,h=r*s,c=i*s,u=i*o,f=n*s,d=n*o,p=n*l,m=a*s,v=a*o,x=a*l;return e[0]=1-u-p,e[1]=c+x,e[2]=f-v,e[3]=0,e[4]=c-x,e[5]=1-h-p,e[6]=d+m,e[7]=0,e[8]=f+v,e[9]=d-m,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nn(e,t,r,i,n,a,s){var o=1/(r-t),l=1/(n-i),h=1/(a-s);return e[0]=a*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(s+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*h,e[15]=0,e}function an(e,t,r,i,n){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==Infinity?(s=1/(i-n),e[10]=(n+i)*s,e[14]=2*n*i*s):(e[10]=-1,e[14]=-2*i),e}function sn(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),h=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((s-o)*l*.5),e[9]=(n-a)*h*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function on(e,t,r,i,n,a,s){var o=1/(t-r),l=1/(i-n),h=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*h,e[15]=1,e}function ln(e,t,r,i){var n,a,s,o,l,h,c,u,f,d,p=t[0],m=t[1],v=t[2],x=i[0],A=i[1],T=i[2],_=r[0],E=r[1],S=r[2];return Math.abs(p-_)<w&&Math.abs(m-E)<w&&Math.abs(v-S)<w?Qe(e):(c=p-_,u=m-E,f=v-S,d=1/Math.hypot(c,u,f),c*=d,u*=d,f*=d,n=A*f-T*u,a=T*c-x*f,s=x*u-A*c,d=Math.hypot(n,a,s),d?(d=1/d,n*=d,a*=d,s*=d):(n=0,a=0,s=0),o=u*s-f*a,l=f*n-c*s,h=c*a-u*n,d=Math.hypot(o,l,h),d?(d=1/d,o*=d,l*=d,h*=d):(o=0,l=0,h=0),e[0]=n,e[1]=o,e[2]=c,e[3]=0,e[4]=a,e[5]=l,e[6]=u,e[7]=0,e[8]=s,e[9]=h,e[10]=f,e[11]=0,e[12]=-(n*p+a*m+s*v),e[13]=-(o*p+l*m+h*v),e[14]=-(c*p+u*m+f*v),e[15]=1,e)}function hn(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=i[0],l=i[1],h=i[2],c=n-r[0],u=a-r[1],f=s-r[2],d=c*c+u*u+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,u*=d,f*=d);var p=l*f-h*u,m=h*c-o*f,v=o*u-l*c;return d=p*p+m*m+v*v,d>0&&(d=1/Math.sqrt(d),p*=d,m*=d,v*=d),e[0]=p,e[1]=m,e[2]=v,e[3]=0,e[4]=u*v-f*m,e[5]=f*p-c*v,e[6]=c*m-u*p,e[7]=0,e[8]=c,e[9]=u,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function cn(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function fn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function un(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ze(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function dn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function pn(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function vn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function mn(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],x=e[15],A=t[0],T=t[1],_=t[2],E=t[3],S=t[4],U=t[5],I=t[6],b=t[7],D=t[8],L=t[9],N=t[10],O=t[11],R=t[12],F=t[13],ee=t[14],te=t[15];return Math.abs(r-A)<=w*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(i-T)<=w*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-_)<=w*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-E)<=w*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-S)<=w*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(o-U)<=w*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(l-I)<=w*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-b)<=w*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(c-D)<=w*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(u-L)<=w*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(f-N)<=w*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(d-O)<=w*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-R)<=w*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-F)<=w*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(v-ee)<=w*Math.max(1,Math.abs(v),Math.abs(ee))&&Math.abs(x-te)<=w*Math.max(1,Math.abs(x),Math.abs(te))}var xn=fe,Mn=Ze,P=Object.freeze({__proto__:null,create:re,clone:Ke,copy:Or,fromValues:Me,set:jr,identity:Qe,transpose:zr,invert:Vr,adjoint:Fr,determinant:Br,multiply:fe,translate:ye,scale:Te,rotate:Gr,rotateX:$r,rotateY:qr,rotateZ:kr,fromTranslation:Xr,fromScaling:Wr,fromRotation:Kr,fromXRotation:Qr,fromYRotation:Yr,fromZRotation:Hr,fromRotationTranslation:Ye,fromQuat2:Zr,getTranslation:Jr,getScaling:He,getRotation:en,fromRotationTranslationScale:tn,fromRotationTranslationScaleOrigin:rn,fromQuat:_e,frustum:nn,perspective:an,perspectiveFromFieldOfView:sn,ortho:on,lookAt:ln,targetTo:hn,str:cn,frob:fn,add:un,subtract:Ze,multiplyScalar:dn,multiplyScalarAndAdd:pn,exactEquals:vn,equals:mn,mul:xn,sub:Mn});function ue(){var e=new C(3);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function yn(e){var t=new C(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Je(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function q(e,t,r){var i=new C(3);return i[0]=e,i[1]=t,i[2]=r,i}function Tn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _n(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function gn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function et(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function tt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function rt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function En(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Sn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function An(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function wn(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Rn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Pn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Cn(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function nt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function it(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function at(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function In(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function bn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function st(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function ge(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function de(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=n*l-a*o,e[1]=a*s-i*l,e[2]=i*o-n*s,e}function ot(e,t,r,i){var n=t[0],a=t[1],s=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e}function Dn(e,t,r,i,n,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,h=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*o+r[0]*l+i[0]*h+n[0]*c,e[1]=t[1]*o+r[1]*l+i[1]*h+n[1]*c,e[2]=t[2]*o+r[2]*l+i[2]*h+n[2]*c,e}function Un(e,t,r,i,n,a){var s=1-a,o=s*s,l=a*a,h=o*s,c=3*a*o,u=3*l*s,f=l*a;return e[0]=t[0]*h+r[0]*c+i[0]*u+n[0]*f,e[1]=t[1]*h+r[1]*c+i[1]*u+n[1]*f,e[2]=t[2]*h+r[2]*c+i[2]*u+n[2]*f,e}function Ln(e,t){t=t||1;var r=B()*2*Math.PI,i=B()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function Nn(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,e}function On(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e}function jn(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],l=t[1],h=t[2],c=n*h-a*l,u=a*o-i*h,f=i*l-n*o,d=n*f-a*u,p=a*c-i*f,m=i*u-n*c,v=s*2;return c*=v,u*=v,f*=v,d*=2,p*=2,m*=2,e[0]=o+c+d,e[1]=l+u+p,e[2]=h+f+m,e}function zn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Vn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Fn(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Bn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt(r*r+i*i+n*n),h=Math.sqrt(a*a+s*s+o*o),c=l*h,u=c&&ge(e,t)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function Gn(e){return e[0]=0,e[1]=0,e[2]=0,e}function $n(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function qn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function kn(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=w*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=w*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=w*Math.max(1,Math.abs(n),Math.abs(o))}var Xn=et,Wn=tt,Kn=rt,Qn=nt,Yn=it,lt=Je,Hn=at,Zn=function(){var e=ue();return function(t,r,i,n,a,s){var o,l;for(r||(r=3),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}(),M=Object.freeze({__proto__:null,create:ue,clone:yn,length:Je,fromValues:q,copy:Tn,set:_n,add:gn,subtract:et,multiply:tt,divide:rt,ceil:En,floor:Sn,min:An,max:wn,round:Rn,scale:Pn,scaleAndAdd:Cn,distance:nt,squaredDistance:it,squaredLength:at,negate:In,inverse:bn,normalize:st,dot:ge,cross:de,lerp:ot,hermite:Dn,bezier:Un,random:Ln,transformMat4:Nn,transformMat3:On,transformQuat:jn,rotateX:zn,rotateY:Vn,rotateZ:Fn,angle:Bn,zero:Gn,str:$n,exactEquals:qn,equals:kn,sub:Xn,mul:Wn,div:Kn,dist:Qn,sqrDist:Yn,len:lt,sqrLen:Hn,forEach:Zn});function ht(){var e=new C(4);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ct(e){var t=new C(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ne(e,t,r,i){var n=new C(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function ft(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ut(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function dt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function pt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function vt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function mt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Jn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function ei(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ti(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function ri(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function ni(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function xt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ii(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Mt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,i,n,a)}function yt(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function Ee(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function Se(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function ai(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function si(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Tt(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=a*s,e}function _t(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function oi(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],o=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],c=t[0],u=t[1],f=t[2],d=t[3];return e[0]=u*h-f*l+d*o,e[1]=-(c*h)+f*s-d*a,e[2]=c*l-u*s+d*n,e[3]=-(c*o)+u*a-f*n,e}function gt(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=s+i*(r[2]-s),e[3]=o+i*(r[3]-o),e}function li(e,t){t=t||1;var r,i,n,a,s,o;do r=B()*2-1,i=B()*2-1,s=r*r+i*i;while(s>=1);do n=B()*2-1,a=B()*2-1,o=n*n+a*a;while(o>=1);var l=Math.sqrt((1-s)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*a*l,e}function hi(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,e}function ci(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2],h=r[3],c=h*i+o*a-l*n,u=h*n+l*i-s*a,f=h*a+s*n-o*i,d=-s*i-o*n-l*a;return e[0]=c*h+d*-s+u*-l-f*-o,e[1]=u*h+d*-o+f*-s-c*-l,e[2]=f*h+d*-l+c*-o-u*-s,e[3]=t[3],e}function fi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ui(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function St(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(r-s)<=w*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=w*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-h)<=w*Math.max(1,Math.abs(a),Math.abs(h))}var di=pt,pi=vt,vi=mt,mi=Mt,xi=yt,Mi=Ee,yi=Se,Ti=function(){var e=ht();return function(t,r,i,n,a,s){var o,l;for(r||(r=4),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}(),ie=Object.freeze({__proto__:null,create:ht,clone:ct,fromValues:ne,copy:ft,set:ut,add:dt,subtract:pt,multiply:vt,divide:mt,ceil:Jn,floor:ei,min:ti,max:ri,round:ni,scale:xt,scaleAndAdd:ii,distance:Mt,squaredDistance:yt,length:Ee,squaredLength:Se,negate:ai,inverse:si,normalize:Tt,dot:_t,cross:oi,lerp:gt,random:li,transformMat4:hi,transformQuat:ci,zero:fi,str:ui,exactEquals:Et,equals:St,sub:di,mul:pi,div:vi,dist:mi,sqrDist:xi,len:Mi,sqrLen:yi,forEach:Ti});function pe(){var e=new C(4);return C!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function _i(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function At(e,t,r){r=r*.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function gi(e,t){var r=Math.acos(t[3])*2,i=Math.sin(r/2);return i>w?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function Ei(e,t){var r=wt(e,t);return Math.acos(2*r*r-1)}function Rt(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],l=r[1],h=r[2],c=r[3];return e[0]=i*c+s*o+n*h-a*l,e[1]=n*c+s*l+a*o-i*h,e[2]=a*c+s*h+i*l-n*o,e[3]=s*c-i*o-n*l-a*h,e}function Si(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=s*l-i*o,e}function Ai(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*o,e[1]=n*l+s*o,e[2]=a*l+i*o,e[3]=s*l-n*o,e}function wi(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e}function Ri(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function Pt(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=Math.exp(a),l=s>0?o*Math.sin(s)/s:0;return e[0]=r*l,e[1]=i*l,e[2]=n*l,e[3]=o*Math.cos(s),e}function Ct(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=Math.sqrt(r*r+i*i+n*n),o=s>0?Math.atan2(s,a)/s:0;return e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=.5*Math.log(r*r+i*i+n*n+a*a),e}function Pi(e,t,r){return Ct(e,t),It(e,e,r),Pt(e,e),e}function ae(e,t,r,i){var n=t[0],a=t[1],s=t[2],o=t[3],l=r[0],h=r[1],c=r[2],u=r[3],f,d,p,m,v;return d=n*l+a*h+s*c+o*u,d<0&&(d=-d,l=-l,h=-h,c=-c,u=-u),1-d>w?(f=Math.acos(d),p=Math.sin(f),m=Math.sin((1-i)*f)/p,v=Math.sin(i*f)/p):(m=1-i,v=i),e[0]=m*n+v*l,e[1]=m*a+v*h,e[2]=m*s+v*c,e[3]=m*o+v*u,e}function Ci(e){var t=B(),r=B(),i=B(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function Ii(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=a*o,e}function bi(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function bt(e,t){var r=t[0]+t[4]+t[8],i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[a*3+a]-t[s*3+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[a*3+s]-t[s*3+a])*i,e[a]=(t[a*3+n]+t[n*3+a])*i,e[s]=(t[s*3+n]+t[n*3+s])*i}return e}function Di(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),l=Math.cos(r),h=Math.sin(i),c=Math.cos(i);return e[0]=a*l*c-s*o*h,e[1]=s*o*c+a*l*h,e[2]=s*l*h-a*o*c,e[3]=s*l*c+a*o*h,e}function Ui(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Li=ct,ve=ne,Ni=ft,Oi=ut,ji=dt,zi=Rt,It=xt,wt=_t,Vi=gt,Dt=Ee,Fi=Dt,Ut=Se,Bi=Ut,Ae=Tt,Gi=Et,$i=St,qi=function(){var e=ue(),t=q(1,0,0),r=q(0,1,0);return function(i,n,a){var s=ge(n,a);return s<-.999999?(de(e,t,n),lt(e)<1e-6&&de(e,r,n),st(e,e),At(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(de(e,n,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Ae(i,i))}}(),ki=function(){var e=pe(),t=pe();return function(r,i,n,a,s,o){return ae(e,i,s,o),ae(t,n,a,o),ae(r,e,t,2*o*(1-o)),r}}(),Xi=function(){var e=Nr();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Ae(t,bt(t,e))}}(),$=Object.freeze({__proto__:null,create:pe,identity:_i,setAxisAngle:At,getAxisAngle:gi,getAngle:Ei,multiply:Rt,rotateX:Si,rotateY:Ai,rotateZ:wi,calculateW:Ri,exp:Pt,ln:Ct,pow:Pi,slerp:ae,random:Ci,invert:Ii,conjugate:bi,fromMat3:bt,fromEuler:Di,str:Ui,clone:Li,fromValues:ve,copy:Ni,set:Oi,add:ji,mul:zi,scale:It,dot:wt,lerp:Vi,length:Dt,len:Fi,squaredLength:Ut,sqrLen:Bi,normalize:Ae,exactEquals:Gi,equals:$i,rotationTo:qi,sqlerp:ki,setAxes:Xi});function Lt(){var e=new C(2);return C!=Float32Array&&(e[0]=0,e[1]=0),e}function Wi(e){var t=new C(2);return t[0]=e[0],t[1]=e[1],t}function Ki(e,t){var r=new C(2);return r[0]=e,r[1]=t,r}function Qi(e,t){return e[0]=t[0],e[1]=t[1],e}function Yi(e,t,r){return e[0]=t,e[1]=r,e}function Hi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Nt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ot(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function jt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Zi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Ji(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ea(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function ta(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function ra(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function na(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function ia(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function zt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function Vt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Ft(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Bt(e){var t=e[0],r=e[1];return t*t+r*r}function aa(e,t){return e[0]=-t[0],e[1]=-t[1],e}function sa(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function oa(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function la(e,t){return e[0]*t[0]+e[1]*t[1]}function ha(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function ca(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e}function fa(e,t){t=t||1;var r=B()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function ua(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function da(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function pa(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function va(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function ma(e,t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=Math.sin(i),o=Math.cos(i);return e[0]=n*o-a*s+r[0],e[1]=n*s+a*o+r[1],e}function xa(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),o=s&&(r*n+i*a)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function Ma(e){return e[0]=0,e[1]=0,e}function ya(e){return"vec2("+e[0]+", "+e[1]+")"}function Ta(e,t){return e[0]===t[0]&&e[1]===t[1]}function _a(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=w*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))}var ga=Ft,Ea=Nt,Sa=Ot,Aa=jt,wa=zt,Ra=Vt,Pa=Bt,Ca=function(){var e=Lt();return function(t,r,i,n,a,s){var o,l;for(r||(r=2),i||(i=0),n?l=Math.min(n*r+i,t.length):l=t.length,o=i;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}(),z=Object.freeze({__proto__:null,create:Lt,clone:Wi,fromValues:Ki,copy:Qi,set:Yi,add:Hi,subtract:Nt,multiply:Ot,divide:jt,ceil:Zi,floor:Ji,min:ea,max:ta,round:ra,scale:na,scaleAndAdd:ia,distance:zt,squaredDistance:Vt,length:Ft,squaredLength:Bt,negate:aa,inverse:sa,normalize:oa,dot:la,cross:ha,lerp:ca,random:fa,transformMat2:ua,transformMat2d:da,transformMat3:pa,transformMat4:va,rotate:ma,angle:xa,zero:Ma,str:ya,exactEquals:Ta,equals:_a,len:ga,sub:Ea,mul:Sa,div:Aa,dist:wa,sqrDist:Ra,sqrLen:Pa,forEach:Ca});var V=Object.freeze({up:"up",down:"down",left:"left",right:"right"}),se=Object.create({w:V.up,s:V.down,d:V.right,a:V.left,ArrowUp:V.up,ArrowDown:V.down,ArrowRight:V.right,ArrowLeft:V.left});var me=Object.freeze({Up:z.fromValues(0,1),Down:z.fromValues(0,-1),Left:z.fromValues(-1,0),Right:z.fromValues(1,0),Center:z.fromValues(0,0)}),Gt=class{constructor(){this._buttonState=Object.create({}),this._cacheKeyboardDirection=z.create()}GetButtonState(t){return!1}RegisterButtonEvent(t){window.addEventListener("click",r=>{t()})}RegisterMouseMovement(t,r){t.requestPointerLock();let i=[0,0];window.addEventListener("mousemove",n=>{i[0]=n.movementX,i[1]=n.movementY,r(i)})}RegisterMovementEvent(t){let r=this;this._keyboardCallback=t,window.addEventListener("keydown",i=>{i.key.toLowerCase()in se&&this.SetKeyboardState(se[i.key],!0)}),window.addEventListener("keyup",i=>{i.key.toLowerCase()in se&&this.SetKeyboardState(se[i.key],!1)})}OnUpdate(){this._cacheKeyboardDirection[0]=0,this._cacheKeyboardDirection[1]=0,this._buttonState.hasOwnProperty(V.left)&&z.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Left),this._buttonState.hasOwnProperty(V.down)&&z.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Down),this._buttonState.hasOwnProperty(V.right)&&z.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Right),this._buttonState.hasOwnProperty(V.up)&&z.add(this._cacheKeyboardDirection,this._cacheKeyboardDirection,me.Up),this._keyboardCallback(this._cacheKeyboardDirection)}SetKeyboardState(t,r){r?this._buttonState[t]=!0:delete this._buttonState[t]}},$t=Gt;var we=.02;var y={vertex:"a_vertex",color:"a_color",uv:"a_uv",normal:"a_normal",tangent:"a_tangent",time:"u_time",mainColor:"u_mainColor",mainTex:"u_mainTex",normalTex:"u_normalTex",mainTex_Texel:"u_mainTex_Texel",modelMatrix:"u_modelMatrix",viewMatrix:"u_viewMatrix",inverseTransposeModelMatrix:"u_inverseTransposeModelMatrix",modelViewProjectionMatrix:"u_MVPMatrix",cameraPos:"u_cameraPos",specularLightStrength:"u_specularLightStrength",directionLightDir:"u_directionLightDir",directionLightColor:"u_directionLightColor",ambientLightColor:"u_ambientLightColor",depthMapTexture:"u_depthTex",depthMapTex_Texel:"u_depthTex_Texel",lightSpaceMVPMatrix:"u_lightSpaceMVPMatrix"};var Re=class{constructor(){this.gltfCache={}}async LoadGLTFContent(t,r){let i=r.gltf.map(s=>t.shapeBuilder.BuildGLTFShape(s.id,s.path)),n=this,a=r.gltf.length;for(let s=0;s<a;s++){let o=await i[s];n.SetGLTFToConfigLayout(t,r.gltf[s],o)}}GetGLTFShapeObject(t){return this.gltfCache.hasOwnProperty(t)?this.gltfCache[t]:null}ClearUp(){this.gltfCache={}}SetGLTFToConfigLayout(t,r,i){this.gltfCache[r.id]=i;let n=this.GetGLTFShapeObject(r.parent_id);i.transform.Scale(r.scale),i.transform.SetPosition(r.position[0],r.position[1],r.position[2]),i.transform.SetEuler(r.orientation[0],r.orientation[1],r.orientation[2]),i.SetCustomUniformAttr(y.specularLightStrength,{value:r.specular,isMatrix:!1,function:t.webglContext.uniform1f}),t.scene.AddShapeObj(i),n!=null&&t.scene.SetParent(n,i)}},qt=Re;function Pe(e,t,r){return(1-r)*e+r*t}function kt(e){return new Promise(t=>{let r=new Image;return r.crossOrigin="anonymous",r.src=e,r.onload=()=>t(Object.assign(r)),r})}function k(e){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.apply(null,Array(e)).map(function(){return t.charAt(Math.floor(Math.random()*t.length))}).join("")}function Xt(e){let t=M.create(),r=2*(e[3]*e[0]+e[1]*e[2]),i=1-2*(e[0]*e[0]+e[1]*e[1]);t[0]=Math.atan2(r,i);let n=2*(e[3]*e[1]-e[2]*e[0]);Math.abs(n)>=1?t[1]=Math.sign(n):t[1]=Math.asin(n);let a=2*(e[3]*e[2]+e[0]*e[1]),s=1-2*(e[1]*e[1]+e[2]*e[2]);return t[2]=Math.atan2(a,s),t}var Ce=Object.freeze({poly_pillar:"gltf@low_poly_pillar_1",temple_stick:"gltf@low_holy_stick_1",child_sphere:"gltf@low_sphere_1"}),Ie=class{constructor(t,r,i){this.sphereOriginPosition=M.create(),this.sphereTargetPosition=M.create(),this.sphereOriginColor=Object.freeze([1,1,1,1]),this.forceAnimation=!1,this.gl=t,this.sceneLoader=r,this.cameraTransform=i,this.objChildSphere=this.sceneLoader.GetGLTFShapeObject(Ce.child_sphere),this.objTempleStick=this.sceneLoader.GetGLTFShapeObject(Ce.temple_stick),M.copy(this.sphereOriginPosition,this.objChildSphere.transform.relativePosition)}OnUpdate(t){if(this.cameraTransform==null)return;!this.IsWithinTriggerRange(1.5,this.cameraTransform.position)&&!this.forceAnimation?(this.sphereTargetPosition[1]=Pe(this.objChildSphere.transform.relativePosition[1],this.sphereOriginPosition[1],.1),this.objChildSphere.SetCustomUniformAttr(y.mainColor,{value:this.sphereOriginColor,isMatrix:!1,function:this.gl.uniform4fv})):this.ExecuteAnimationSet(t);let i=this.objChildSphere.transform.relativePosition;this.objChildSphere.transform.SetPosition(i[0],this.sphereTargetPosition[1],i[2])}ExecuteAnimationSet(t){let r=Math.sin(t);this.objTempleStick.transform.Rotate(0,.02,0);let i=3;this.sphereTargetPosition[1]=Pe(this.objChildSphere.transform.relativePosition[1],r*2+this.sphereOriginPosition[1]+i,.1),this.objChildSphere.SetCustomUniformAttr(y.mainColor,{value:[1-r,r,Math.cos(t),1],isMatrix:!1,function:this.gl.uniform4fv})}IsWithinTriggerRange(t,r){let i=this.sceneLoader.GetGLTFShapeObject(Ce.poly_pillar);return M.dist(i.transform.position,r)<t}},Wt=Ie;var Kt=class{constructor(){this.sceneIsReady=!1,this.inputHandler=new $t,this.inputHandler.RegisterMovementEvent(this.OnMovementEvent.bind(this)),this.inputHandler.RegisterButtonEvent(this.OnMouseClickEvent.bind(this)),this.sceneLoader=new qt}async SetUp(t,r){this.katachi=t;let i=await t.SetUp(this.UpdateLoop.bind(this)),n=document.querySelector("#webgl_canvas");i&&(this.inputHandler.RegisterMouseMovement(n,this.OnMouseEvent.bind(this)),await this.sceneLoader.LoadGLTFContent(t,r),this.sceneAnimator=new Wt(this.katachi.webglContext,this.sceneLoader,this.katachi.scene.camera.transform),this.sceneIsReady=!0)}OnMovementEvent(t){if(!this.sceneIsReady)return;let i=.02;this.katachi.scene.camera.transform.Translate(-t[0]*i,0,t[1]*i)}OnMouseEvent(t){let r=.3,i=this.katachi.scene.camera.transform.rotation;this.katachi.scene.camera.transform.SetEuler(i[0]+t[0]*we*r,i[1]-t[1]*we*r,i[2]);let n=.5*Math.PI;i[1]>n&&this.katachi.scene.camera.transform.SetEuler(i[0],n,i[2]),this.katachi.scene.camera.transform.rotation[1]<-n&&this.katachi.scene.camera.transform.SetEuler(i[0],-n,i[2])}OnMouseClickEvent(){this.sceneAnimator.forceAnimation=!this.sceneAnimator.forceAnimation}UpdateLoop(t){this.inputHandler.OnUpdate(),!(!this.sceneIsReady||this.sceneAnimator==null)&&this.sceneAnimator.OnUpdate(t)}},Qt=Kt;var Yt=class{constructor(t){if(this.maxDrawBufferSize=2048,this._configJson=t,this._canvasDom=document.querySelector(t.canvas_dom_query),this._gl=this._canvasDom.getContext("webgl",{stencil:!0}),this._gl.enable(this._gl.DEPTH_TEST),this._gl.enable(this._gl.STENCIL_TEST),this.AutoSetCanvasSize(),!this._gl.getExtension("WEBGL_depth_texture")){console.log("This WebGL program requires the use of the WEBGL_depth_texture extension. This extension is not supported by your browser, so this WEBGL program is terminating.");return}window.addEventListener("resize",()=>{this.AutoSetCanvasSize()})}get webglContext(){return this._gl}AutoSetCanvasSize(){this.SetCanvasToSceenSize(this._canvasDom.clientWidth,this._canvasDom.clientHeight)}SetCanvasToSceenSize(t,r){(t>this.maxDrawBufferSize||r>this.maxDrawBufferSize)&&(r=r>t?this.maxDrawBufferSize:this.maxDrawBufferSize*r/t,t=t>=r?this.maxDrawBufferSize:this.maxDrawBufferSize*t/r),console.log(t+", "+r),this._canvasDom.width=t,this._canvasDom.height=r}},Ht=Yt;var W=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function j(e,t,r){return r={path:t,exports:{},require:function(i,n){return Ia(i,n==null?r.path:n)}},e(r,r.exports),r.exports}function Ia(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var g=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;t.has=function(f,d){return r.call(f,d)};function i(f,d){return f<d?-1:f===d?0:1}t.defaultCompare=i;function n(f,d){return f===d}t.defaultEquals=n;function a(f){return f===null?"COLLECTION_NULL":l(f)?"COLLECTION_UNDEFINED":h(f)?"$s"+f:"$o"+f.toString()}t.defaultToString=a;function s(f,d){if(d===void 0&&(d=","),f===null)return"COLLECTION_NULL";if(l(f))return"COLLECTION_UNDEFINED";if(h(f))return f.toString();var p="{",m=!0;for(var v in f)t.has(f,v)&&(m?m=!1:p=p+d,p=p+v+":"+f[v]);return p+"}"}t.makeString=s;function o(f){return typeof f=="function"}t.isFunction=o;function l(f){return typeof f=="undefined"}t.isUndefined=l;function h(f){return Object.prototype.toString.call(f)==="[object String]"}t.isString=h;function c(f){return l(f)||!o(f)?function(d,p){return d<p?1:d===p?0:-1}:function(d,p){return f(d,p)*-1}}t.reverseCompareFunction=c;function u(f){return function(d,p){return f(d,p)===0}}t.compareToEquals=u}),G=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function r(f,d,p){for(var m=p||g.defaultEquals,v=f.length,x=0;x<v;x++)if(m(f[x],d))return x;return-1}t.indexOf=r;function i(f,d,p){for(var m=p||g.defaultEquals,v=f.length,x=v-1;x>=0;x--)if(m(f[x],d))return x;return-1}t.lastIndexOf=i;function n(f,d,p){return r(f,d,p)>=0}t.contains=n;function a(f,d,p){var m=r(f,d,p);return m<0?!1:(f.splice(m,1),!0)}t.remove=a;function s(f,d,p){for(var m=p||g.defaultEquals,v=f.length,x=0,A=0;A<v;A++)m(f[A],d)&&x++;return x}t.frequency=s;function o(f,d,p){var m=p||g.defaultEquals;if(f.length!==d.length)return!1;for(var v=f.length,x=0;x<v;x++)if(!m(f[x],d[x]))return!1;return!0}t.equals=o;function l(f){return f.concat()}t.copy=l;function h(f,d,p){if(d<0||d>=f.length||p<0||p>=f.length)return!1;var m=f[d];return f[d]=f[p],f[p]=m,!0}t.swap=h;function c(f){return"["+f.toString()+"]"}t.toString=c;function u(f,d){for(var p=0,m=f;p<m.length;p++){var v=m[p];if(d(v)===!1)return}}t.forEach=u}),K=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.table={},this.nElements=0,this.toStr=n||g.defaultToString}return i.prototype.getValue=function(n){var a=this.table["$"+this.toStr(n)];if(!g.isUndefined(a))return a.value},i.prototype.setValue=function(n,a){if(!(g.isUndefined(n)||g.isUndefined(a))){var s,o="$"+this.toStr(n),l=this.table[o];return g.isUndefined(l)?(this.nElements++,s=void 0):s=l.value,this.table[o]={key:n,value:a},s}},i.prototype.remove=function(n){var a="$"+this.toStr(n),s=this.table[a];if(!g.isUndefined(s))return delete this.table[a],this.nElements--,s.value},i.prototype.keys=function(){var n=[];for(var a in this.table)if(g.has(this.table,a)){var s=this.table[a];n.push(s.key)}return n},i.prototype.values=function(){var n=[];for(var a in this.table)if(g.has(this.table,a)){var s=this.table[a];n.push(s.value)}return n},i.prototype.forEach=function(n){for(var a in this.table)if(g.has(this.table,a)){var s=this.table[a],o=n(s.key,s.value);if(o===!1)return}},i.prototype.containsKey=function(n){return!g.isUndefined(this.getValue(n))},i.prototype.clear=function(){this.table={},this.nElements=0},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){var n="{";return this.forEach(function(a,s){n+=`
	`+a+" : "+s}),n+`
}`},i}();t.default=r}),Zt=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.dictionary=new K.default(n)}return i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.add=function(n){return this.contains(n)||g.isUndefined(n)?!1:(this.dictionary.setValue(n,n),!0)},i.prototype.intersection=function(n){var a=this;this.forEach(function(s){return n.contains(s)||a.remove(s),!0})},i.prototype.union=function(n){var a=this;n.forEach(function(s){return a.add(s),!0})},i.prototype.difference=function(n){var a=this;n.forEach(function(s){return a.remove(s),!0})},i.prototype.isSubsetOf=function(n){if(this.size()>n.size())return!1;var a=!0;return this.forEach(function(s){return n.contains(s)?!0:(a=!1,!1)}),a},i.prototype.remove=function(n){return this.contains(n)?(this.dictionary.remove(n),!0):!1},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){return n(s)})},i.prototype.toArray=function(){return this.dictionary.values()},i.prototype.isEmpty=function(){return this.dictionary.isEmpty()},i.prototype.size=function(){return this.dictionary.size()},i.prototype.clear=function(){this.dictionary.clear()},i.prototype.toString=function(){return G.toString(this.toArray())},i}();t.default=r}),ba=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.toStrF=n||g.defaultToString,this.dictionary=new K.default(this.toStrF),this.nElements=0}return i.prototype.add=function(n,a){if(a===void 0&&(a=1),g.isUndefined(n)||a<=0)return!1;if(this.contains(n))this.dictionary.getValue(n).copies+=a;else{var s={value:n,copies:a};this.dictionary.setValue(n,s)}return this.nElements+=a,!0},i.prototype.count=function(n){return this.contains(n)?this.dictionary.getValue(n).copies:0},i.prototype.contains=function(n){return this.dictionary.containsKey(n)},i.prototype.remove=function(n,a){if(a===void 0&&(a=1),g.isUndefined(n)||a<=0)return!1;if(this.contains(n)){var s=this.dictionary.getValue(n);return a>s.copies?this.nElements-=s.copies:this.nElements-=a,s.copies-=a,s.copies<=0&&this.dictionary.remove(n),!0}else return!1},i.prototype.toArray=function(){for(var n=[],a=this.dictionary.values(),s=0,o=a;s<o.length;s++)for(var l=o[s],h=l.value,c=l.copies,u=0;u<c;u++)n.push(h);return n},i.prototype.toSet=function(){for(var n=new Zt.default(this.toStrF),a=this.dictionary.values(),s=0,o=a;s<o.length;s++){var l=o[s],h=l.value;n.add(h)}return n},i.prototype.forEach=function(n){this.dictionary.forEach(function(a,s){for(var o=s.value,l=s.copies,h=0;h<l;h++)if(n(o)===!1)return!1;return!0})},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},i}();t.default=r}),be=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.firstNode=null,this.lastNode=null,this.nElements=0}return i.prototype.add=function(n,a){if(g.isUndefined(a)&&(a=this.nElements),a<0||a>this.nElements||g.isUndefined(n))return!1;var s=this.createNode(n);if(this.nElements===0||this.lastNode===null)this.firstNode=s,this.lastNode=s;else if(a===this.nElements)this.lastNode.next=s,this.lastNode=s;else if(a===0)s.next=this.firstNode,this.firstNode=s;else{var o=this.nodeAtIndex(a-1);if(o===null)return!1;s.next=o.next,o.next=s}return this.nElements++,!0},i.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},i.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},i.prototype.elementAtIndex=function(n){var a=this.nodeAtIndex(n);if(a!==null)return a.element},i.prototype.indexOf=function(n,a){var s=a||g.defaultEquals;if(g.isUndefined(n))return-1;for(var o=this.firstNode,l=0;o!==null;){if(s(o.element,n))return l;l++,o=o.next}return-1},i.prototype.contains=function(n,a){return this.indexOf(n,a)>=0},i.prototype.remove=function(n,a){var s=a||g.defaultEquals;if(this.nElements<1||g.isUndefined(n))return!1;for(var o=null,l=this.firstNode;l!==null;){if(s(l.element,n))return o===null?(this.firstNode=l.next,l===this.lastNode&&(this.lastNode=null)):l===this.lastNode?(this.lastNode=o,o.next=l.next,l.next=null):(o.next=l.next,l.next=null),this.nElements--,!0;o=l,l=l.next}return!1},i.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},i.prototype.equals=function(n,a){var s=a||g.defaultEquals;return!(n instanceof i)||this.size()!==n.size()?!1:this.equalsAux(this.firstNode,n.firstNode,s)},i.prototype.equalsAux=function(n,a,s){for(;n!==null&&a!==null;){if(!s(n.element,a.element))return!1;n=n.next,a=a.next}return!0},i.prototype.removeElementAtIndex=function(n){if(!(n<0||n>=this.nElements||this.firstNode===null||this.lastNode===null)){var a;if(this.nElements===1)a=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var s=this.nodeAtIndex(n-1);s===null?(a=this.firstNode.element,this.firstNode=this.firstNode.next):s.next===this.lastNode&&(a=this.lastNode.element,this.lastNode=s),s!==null&&s.next!==null&&(a=s.next.element,s.next=s.next.next)}return this.nElements--,a}},i.prototype.forEach=function(n){for(var a=this.firstNode;a!==null&&n(a.element)!==!1;)a=a.next},i.prototype.reverse=function(){for(var n=null,a=this.firstNode,s=null;a!==null;)s=a.next,a.next=n,n=a,a=s;s=this.firstNode,this.firstNode=this.lastNode,this.lastNode=s},i.prototype.toArray=function(){for(var n=[],a=this.firstNode;a!==null;)n.push(a.element),a=a.next;return n},i.prototype.size=function(){return this.nElements},i.prototype.isEmpty=function(){return this.nElements<=0},i.prototype.toString=function(){return G.toString(this.toArray())},i.prototype.nodeAtIndex=function(n){if(n<0||n>=this.nElements)return null;if(n===this.nElements-1)return this.lastNode;for(var a=this.firstNode,s=0;s<n&&a!==null;s++)a=a.next;return a},i.prototype.createNode=function(n){return{element:n,next:null}},i}();t.default=r}),Jt=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new be.default}return i.prototype.enqueue=function(n){return this.list.add(n)},i.prototype.add=function(n){return this.list.add(n)},i.prototype.dequeue=function(){if(this.list.size()!==0){var n=this.list.first();return this.list.removeElementAtIndex(0),n}},i.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.size()<=0},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),er=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.root=null,this.compare=n||g.defaultCompare,this.nElements=0}return i.prototype.add=function(n){return g.isUndefined(n)?!1:this.insertNode(this.createNode(n))!==null?(this.nElements++,!0):!1},i.prototype.clear=function(){this.root=null,this.nElements=0},i.prototype.isEmpty=function(){return this.nElements===0},i.prototype.size=function(){return this.nElements},i.prototype.contains=function(n){return g.isUndefined(n)?!1:this.searchNode(this.root,n)!==null},i.prototype.search=function(n){var a=this.searchNode(this.root,n);if(a!==null)return a.element},i.prototype.remove=function(n){var a=this.searchNode(this.root,n);return a===null?!1:(this.removeNode(a),this.nElements--,!0)},i.prototype.inorderTraversal=function(n){this.inorderTraversalAux(this.root,n,{stop:!1})},i.prototype.preorderTraversal=function(n){this.preorderTraversalAux(this.root,n,{stop:!1})},i.prototype.postorderTraversal=function(n){this.postorderTraversalAux(this.root,n,{stop:!1})},i.prototype.levelTraversal=function(n){this.levelTraversalAux(this.root,n)},i.prototype.minimum=function(){if(!(this.isEmpty()||this.root===null))return this.minimumAux(this.root).element},i.prototype.maximum=function(){if(!(this.isEmpty()||this.root===null))return this.maximumAux(this.root).element},i.prototype.forEach=function(n){this.inorderTraversal(n)},i.prototype.toArray=function(){var n=[];return this.inorderTraversal(function(a){return n.push(a),!0}),n},i.prototype.height=function(){return this.heightAux(this.root)},i.prototype.searchNode=function(n,a){for(var s=1;n!==null&&s!==0;)s=this.compare(a,n.element),s<0?n=n.leftCh:s>0&&(n=n.rightCh);return n},i.prototype.transplant=function(n,a){n.parent===null?this.root=a:n===n.parent.leftCh?n.parent.leftCh=a:n.parent.rightCh=a,a!==null&&(a.parent=n.parent)},i.prototype.removeNode=function(n){if(n.leftCh===null)this.transplant(n,n.rightCh);else if(n.rightCh===null)this.transplant(n,n.leftCh);else{var a=this.minimumAux(n.rightCh);a.parent!==n&&(this.transplant(a,a.rightCh),a.rightCh=n.rightCh,a.rightCh.parent=a),this.transplant(n,a),a.leftCh=n.leftCh,a.leftCh.parent=a}},i.prototype.inorderTraversalAux=function(n,a,s){n===null||s.stop||(this.inorderTraversalAux(n.leftCh,a,s),!s.stop&&(s.stop=a(n.element)===!1,!s.stop&&this.inorderTraversalAux(n.rightCh,a,s)))},i.prototype.levelTraversalAux=function(n,a){var s=new Jt.default;for(n!==null&&s.enqueue(n),n=s.dequeue()||null;n!=null;){if(a(n.element)===!1)return;n.leftCh!==null&&s.enqueue(n.leftCh),n.rightCh!==null&&s.enqueue(n.rightCh),n=s.dequeue()||null}},i.prototype.preorderTraversalAux=function(n,a,s){n===null||s.stop||(s.stop=a(n.element)===!1,!s.stop&&(this.preorderTraversalAux(n.leftCh,a,s),!s.stop&&this.preorderTraversalAux(n.rightCh,a,s)))},i.prototype.postorderTraversalAux=function(n,a,s){n===null||s.stop||(this.postorderTraversalAux(n.leftCh,a,s),!s.stop&&(this.postorderTraversalAux(n.rightCh,a,s),!s.stop&&(s.stop=a(n.element)===!1)))},i.prototype.minimumAux=function(n){for(;n!=null&&n.leftCh!==null;)n=n.leftCh;return n},i.prototype.maximumAux=function(n){for(;n!=null&&n.rightCh!==null;)n=n.rightCh;return n},i.prototype.heightAux=function(n){return n===null?-1:Math.max(this.heightAux(n.leftCh),this.heightAux(n.rightCh))+1},i.prototype.insertNode=function(n){for(var a=null,s=this.root;s!==null;){var o=this.compare(n.element,s.element);if(o===0)return null;o<0?(a=s,s=s.leftCh):(a=s,s=s.rightCh)}return n.parent=a,a===null?this.root=n:this.compare(n.element,a.element)<0?a.leftCh=n:a.rightCh=n,n},i.prototype.createNode=function(n){return{element:n,leftCh:null,rightCh:null,parent:null}},i}();t.default=r}),Da=j(function(e,t){var r=W&&W.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a}(er.default);t.default=i}),tr=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.data=[],this.compare=n||g.defaultCompare}return i.prototype.leftChildIndex=function(n){return 2*n+1},i.prototype.rightChildIndex=function(n){return 2*n+2},i.prototype.parentIndex=function(n){return Math.floor((n-1)/2)},i.prototype.minIndex=function(n,a){return a>=this.data.length?n>=this.data.length?-1:n:this.compare(this.data[n],this.data[a])<=0?n:a},i.prototype.siftUp=function(n){for(var a=this.parentIndex(n);n>0&&this.compare(this.data[a],this.data[n])>0;)G.swap(this.data,a,n),n=a,a=this.parentIndex(n)},i.prototype.siftDown=function(n){for(var a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n));a>=0&&this.compare(this.data[n],this.data[a])>0;)G.swap(this.data,a,n),n=a,a=this.minIndex(this.leftChildIndex(n),this.rightChildIndex(n))},i.prototype.peek=function(){if(this.data.length>0)return this.data[0]},i.prototype.add=function(n){return g.isUndefined(n)?!1:(this.data.push(n),this.siftUp(this.data.length-1),!0)},i.prototype.removeRoot=function(){if(this.data.length>0){var n=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),n}},i.prototype.contains=function(n){var a=g.compareToEquals(this.compare);return G.contains(this.data,n,a)},i.prototype.size=function(){return this.data.length},i.prototype.isEmpty=function(){return this.data.length<=0},i.prototype.clear=function(){this.data.length=0},i.prototype.forEach=function(n){G.forEach(this.data,n)},i}();t.default=r}),Ua=j(function(e,t){var r=W&&W.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var c in h)h.hasOwnProperty(c)&&(l[c]=h[c])};return function(l,h){o(l,h);function c(){this.constructor=l}l.prototype=h===null?Object.create(h):(c.prototype=h.prototype,new c)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function o(l,h){this.key=l,this.value=h}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}(),n=function(){function o(){this.key=null,this.value=null}return o.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},o}();function a(o){return!o.next}var s=function(o){r(l,o);function l(h){var c=o.call(this,h)||this;return c.head=new n,c.tail=new n,c.head.next=c.tail,c.tail.prev=c.head,c}return l.prototype.appendToTail=function(h){var c=this.tail.prev;c.next=h,h.prev=c,h.next=this.tail,this.tail.prev=h},l.prototype.getLinkedDictionaryPair=function(h){if(!g.isUndefined(h)){var c="$"+this.toStr(h),u=this.table[c];return u}},l.prototype.getValue=function(h){var c=this.getLinkedDictionaryPair(h);if(!g.isUndefined(c))return c.value},l.prototype.remove=function(h){var c=this.getLinkedDictionaryPair(h);if(!g.isUndefined(c))return o.prototype.remove.call(this,h),c.unlink(),c.value},l.prototype.clear=function(){o.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},l.prototype.replace=function(h,c){var u="$"+this.toStr(c.key);c.next=h.next,c.prev=h.prev,this.remove(h.key),c.prev.next=c,c.next.prev=c,this.table[u]=c,++this.nElements},l.prototype.setValue=function(h,c){if(!(g.isUndefined(h)||g.isUndefined(c))){var u=this.getLinkedDictionaryPair(h),f=new i(h,c),d="$"+this.toStr(h);if(g.isUndefined(u)){this.appendToTail(f),this.table[d]=f,++this.nElements;return}else return this.replace(u,f),u.value}},l.prototype.keys=function(){var h=[];return this.forEach(function(c,u){h.push(c)}),h},l.prototype.values=function(){var h=[];return this.forEach(function(c,u){h.push(u)}),h},l.prototype.forEach=function(h){for(var c=this.head.next;!a(c);){var u=h(c.key,c.value);if(u===!1)return;c=c.next}},l}(K.default);t.default=s}),La=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n,a,s){s===void 0&&(s=!1),this.dict=new K.default(n),this.equalsF=a||g.defaultEquals,this.allowDuplicate=s}return i.prototype.getValue=function(n){var a=this.dict.getValue(n);return g.isUndefined(a)?[]:G.copy(a)},i.prototype.setValue=function(n,a){if(g.isUndefined(n)||g.isUndefined(a))return!1;var s=this.dict.getValue(n);return g.isUndefined(s)?(this.dict.setValue(n,[a]),!0):!this.allowDuplicate&&G.contains(s,a,this.equalsF)?!1:(s.push(a),!0)},i.prototype.remove=function(n,a){if(g.isUndefined(a)){var s=this.dict.remove(n);return!g.isUndefined(s)}var o=this.dict.getValue(n);return!g.isUndefined(o)&&G.remove(o,a,this.equalsF)?(o.length===0&&this.dict.remove(n),!0):!1},i.prototype.keys=function(){return this.dict.keys()},i.prototype.values=function(){for(var n=this.dict.values(),a=[],s=0,o=n;s<o.length;s++)for(var l=o[s],h=0,c=l;h<c.length;h++){var u=c[h];a.push(u)}return a},i.prototype.containsKey=function(n){return this.dict.containsKey(n)},i.prototype.clear=function(){this.dict.clear()},i.prototype.size=function(){return this.dict.size()},i.prototype.isEmpty=function(){return this.dict.isEmpty()},i}();t.default=r}),rr=j(function(e,t){var r=W&&W.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var o in s)s.hasOwnProperty(o)&&(a[o]=s[o])};return function(a,s){n(a,s);function o(){this.constructor=a}a.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){r(a,n);function a(s,o){var l=n.call(this,o)||this;return l.defaultFactoryFunction=s,l}return a.prototype.setDefault=function(s,o){var l=n.prototype.getValue.call(this,s);return g.isUndefined(l)?(this.setValue(s,o),o):l},a.prototype.getValue=function(s){return this.setDefault(s,this.defaultFactoryFunction())},a}(K.default);t.default=i}),Na=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(n){this.heap=new tr.default(g.reverseCompareFunction(n))}return i.prototype.enqueue=function(n){return this.heap.add(n)},i.prototype.add=function(n){return this.heap.add(n)},i.prototype.dequeue=function(){if(this.heap.size()!==0){var n=this.heap.peek();return this.heap.removeRoot(),n}},i.prototype.peek=function(){return this.heap.peek()},i.prototype.contains=function(n){return this.heap.contains(n)},i.prototype.isEmpty=function(){return this.heap.isEmpty()},i.prototype.size=function(){return this.heap.size()},i.prototype.clear=function(){this.heap.clear()},i.prototype.forEach=function(n){this.heap.forEach(n)},i}();t.default=r}),Oa=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function i(){this.list=new be.default}return i.prototype.push=function(n){return this.list.add(n,0)},i.prototype.add=function(n){return this.list.add(n,0)},i.prototype.pop=function(){return this.list.removeElementAtIndex(0)},i.prototype.peek=function(){return this.list.first()},i.prototype.size=function(){return this.list.size()},i.prototype.contains=function(n,a){return this.list.contains(n,a)},i.prototype.isEmpty=function(){return this.list.isEmpty()},i.prototype.clear=function(){this.list.clear()},i.prototype.forEach=function(n){this.list.forEach(n)},i}();t.default=r}),ja=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER",n[n.INSIDE_AT_END=2]="INSIDE_AT_END",n[n.INSIDE_AT_START=3]="INSIDE_AT_START"})(r||(r={}));var i=function(){function n(a,s){a===void 0&&(a=[]),s===void 0&&(s={}),this.rootIds=a,this.nodes=s,this.initRootIds(),this.initNodes()}return n.prototype.initRootIds=function(){for(var a=0,s=this.rootIds;a<s.length;a++){var o=s[a];this.createEmptyNodeIfNotExist(o)}},n.prototype.initNodes=function(){for(var a in this.nodes)if(this.nodes.hasOwnProperty(a))for(var s=0,o=this.nodes[a];s<o.length;s++){var l=o[s];this.createEmptyNodeIfNotExist(l)}},n.prototype.createEmptyNodeIfNotExist=function(a){this.nodes[a]||(this.nodes[a]=[])},n.prototype.getRootIds=function(){var a=this.rootIds.slice();return a},n.prototype.getNodes=function(){var a={};for(var s in this.nodes)this.nodes.hasOwnProperty(s)&&(a[s]=this.nodes[s].slice());return a},n.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},n.prototype.toObject=function(){return this.getObject()},n.prototype.flatten=function(){for(var a=this,s=[],o=0;o<this.rootIds.length;o++){var l=this.rootIds[o];s.push({id:l,level:0,hasParent:!1,childrenCount:0}),d(l,this.nodes,s,0)}for(var h=0,c=s;h<c.length;h++){var u=c[h];u.childrenCount=f(u.id)}return s;function f(p){if(a.nodes[p]){var m=a.nodes[p].length;return m}else return 0}function d(p,m,v,x){if(x===void 0&&(x=0),!(!p||!m||!v||!m[p])){x++;for(var A=m[p],T=0;T<A.length;T++){var _=A[T];v.push({id:_,level:x,hasParent:!0}),d(_,m,v,x)}x--}}},n.prototype.moveIdBeforeId=function(a,s){return this.moveId(a,s,r.BEFORE)},n.prototype.moveIdAfterId=function(a,s){return this.moveId(a,s,r.AFTER)},n.prototype.moveIdIntoId=function(a,s,o){return o===void 0&&(o=!0),o?this.moveId(a,s,r.INSIDE_AT_START):this.moveId(a,s,r.INSIDE_AT_END)},n.prototype.swapRootIdWithRootId=function(a,s){var o=this.findRootId(a),l=this.findRootId(s);this.swapRootPositionWithRootPosition(o,l)},n.prototype.swapRootPositionWithRootPosition=function(a,s){var o=this.rootIds[s];this.rootIds[s]=this.rootIds[a],this.rootIds[a]=o},n.prototype.deleteId=function(a){this.rootDeleteId(a),this.nodeAndSubNodesDelete(a),this.nodeRefrencesDelete(a)},n.prototype.insertIdBeforeId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o);for(var l in this.nodes)if(this.nodes.hasOwnProperty(l)){var h=this.findNodeId(l,a);h>-1&&this.insertIdIntoNode(l,s,h)}},n.prototype.insertIdAfterId=function(a,s){var o=this.findRootId(a);o>-1&&this.insertIdIntoRoot(s,o+1);for(var l in this.nodes)if(this.nodes.hasOwnProperty(l)){var h=this.findNodeId(l,a);h>-1&&this.insertIdIntoNode(l,s,h+1)}},n.prototype.insertIdIntoId=function(a,s){this.nodeInsertAtEnd(a,s),this.nodes[s]=[]},n.prototype.insertIdIntoRoot=function(a,s){if(s===void 0)this.rootInsertAtEnd(a);else if(s<0){var o=this.rootIds.length;this.rootIds.splice(s+o+1,0,a)}else this.rootIds.splice(s,0,a);this.nodes[a]=this.nodes[a]||[]},n.prototype.insertIdIntoNode=function(a,s,o){if(this.nodes[a]=this.nodes[a]||[],this.nodes[s]=this.nodes[s]||[],o===void 0)this.nodeInsertAtEnd(a,s);else if(o<0){var l=this.nodes[a].length;this.nodes[a].splice(o+l+1,0,s)}else this.nodes[a].splice(o,0,s)},n.prototype.moveId=function(a,s,o){var l=a,h=this.findRootId(l);this.nodes[s];for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){this.findNodeId(c,s);break}var u=s,f=this.findRootId(u);this.nodes[s];for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){this.findNodeId(c,s);break}if(h>-1)if(f>-1)switch(this.rootDelete(h),f>h&&f--,o){case r.BEFORE:this.insertIdIntoRoot(l,f);break;case r.AFTER:this.insertIdIntoRoot(l,f+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(u,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(u,l);break}else{this.rootDelete(h);for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var d=this.findNodeId(c,u);if(d>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(c,l,d);break;case r.AFTER:this.insertIdIntoNode(c,l,d+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(u,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(u,l);break}break}}}else if(f>-1){for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var d=this.findNodeId(c,l);if(d>-1){this.nodeDeleteAtIndex(c,d);break}}switch(o){case r.BEFORE:this.insertIdIntoRoot(l,f);break;case r.AFTER:this.insertIdIntoRoot(l,f+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(u,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(u,l);break}}else{for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var d=this.findNodeId(c,l);if(d>-1){this.nodeDeleteAtIndex(c,d);break}}for(var c in this.nodes)if(this.nodes.hasOwnProperty(c)){var d=this.findNodeId(c,u);if(d>-1){switch(o){case r.BEFORE:this.insertIdIntoNode(c,l,d);break;case r.AFTER:this.insertIdIntoNode(c,l,d+1);break;case r.INSIDE_AT_START:this.nodeInsertAtStart(u,l);break;case r.INSIDE_AT_END:this.nodeInsertAtEnd(u,l);break}break}}}},n.prototype.swapArrayElements=function(a,s,o){var l=a[s];return a[s]=a[o],a[o]=l,a},n.prototype.rootDeleteId=function(a){var s=this.findRootId(a);s>-1&&this.rootDelete(s)},n.prototype.nodeAndSubNodesDelete=function(a){for(var s=[],o=0;o<this.nodes[a].length;o++){var l=this.nodes[a][o];this.nodeAndSubNodesDelete(l),s.push(a)}this.nodeDelete(a);for(var o=0;o<s.length;o++)this.nodeDelete(s[o])},n.prototype.nodeRefrencesDelete=function(a){for(var s in this.nodes)if(this.nodes.hasOwnProperty(s))for(var o=0;o<this.nodes[s].length;o++){var l=this.nodes[s][o];l===a&&this.nodeDeleteAtIndex(s,o)}},n.prototype.nodeDelete=function(a){delete this.nodes[a]},n.prototype.findRootId=function(a){return this.rootIds.indexOf(a)},n.prototype.findNodeId=function(a,s){return this.nodes[a].indexOf(s)},n.prototype.findNode=function(a){return this.nodes[a]},n.prototype.nodeInsertAtStart=function(a,s){this.nodes[a].unshift(s)},n.prototype.nodeInsertAtEnd=function(a,s){this.nodes[a].push(s)},n.prototype.rootDelete=function(a){this.rootIds.splice(a,1)},n.prototype.nodeDeleteAtIndex=function(a,s){this.nodes[a].splice(s,1)},n.prototype.rootInsertAtStart=function(a){this.rootIds.unshift(a)},n.prototype.rootInsertAtEnd=function(a){this.rootIds.push(a)},n}();t.default=i}),za=j(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.arrays=G,t.Bag=ba.default,t.BSTree=Da.default,t.BSTreeKV=er.default,t.Dictionary=K.default,t.Heap=tr.default,t.LinkedDictionary=Ua.default,t.LinkedList=be.default,t.MultiDictionary=La.default,t.FactoryDictionary=rr.default;var r=rr;t.DefaultDictionary=r.default,t.Queue=Jt.default,t.PriorityQueue=Na.default,t.Set=Zt.default,t.Stack=Oa.default,t.MultiRootTree=ja.default,t.util=g}),oe=za.Dictionary;var nr;(function(e){e[e.Texture=0]="Texture",e[e.Shader=1]="Shader",e[e.GlMaterial=2]="GlMaterial"})(nr||(nr={}));var ir=class{constructor(){this.textureCache=new oe,this.glResourceCache=new oe,this.glLocalTextureCache=new oe,this.glGlobalTextureCache=new oe}async PrepareVFShaders(t,r){let i=fetch(t,{method:"GET",credentials:"include"}),n=fetch(r,{method:"GET",credentials:"include"});return Promise.all([i,n]).then(a=>Promise.all([a[0].text(),a[1].text()])).then(a=>({vertex_shader:a[0],fragment_shader:a[1]}))}async GetImage(t){if(this.textureCache.containsKey(t))return this.textureCache.getValue(t);let r=await kt(t);return this.textureCache.setValue(t,r),r}GetCacheSource(t){return this.glResourceCache.containsKey(t)?this.glResourceCache.getValue(t):null}SaveCacheSource(t,r){if(this.glResourceCache.containsKey(t))return this.glResourceCache.setValue(t,r)}CreateGLTexture(t,r,i,n,a,s){let o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,r,i,0,n,a,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),o}GetGLTextureSource(t,r){if(!this.glLocalTextureCache.containsKey(t))return null;let i=this.glLocalTextureCache.getValue(t);if(!this.glGlobalTextureCache.containsKey(i.texture_key))return null;let n=this.glGlobalTextureCache.getValue(i.texture_key);return i.localIndex=n.globalIndex-r,{globalType:n,localType:i}}SaveGlobalTextureSource(t,r,i){let n=i+this.glGlobalTextureCache.size(),a={texture:r,globalIndex:n};return this.glGlobalTextureCache.setValue(t,a),a}SaveGLTextureSource(t,r,i){let n={uniformLocation:i,localIndex:-1,texture_key:r};return this.glLocalTextureCache.setValue(t,n),n}},ar=ir;var sr=class{constructor(t,r,i){this.id=t,this.glProgram=r,this.glResource=i,this.cacheAttrShaderPosition={},this.cacheUniformShaderPosition={}}PreloadProperties(t,r){t.useProgram(this.glProgram),this.PreloadAttributeProperties(t,r.attributes),this.PreloadUniformProperties(t,r.uniforms),this.PreloadUniformTexture(t,r.texture)}PreloadAttributeProperties(t,r){Object.keys(r).forEach(i=>{var n=t.getAttribLocation(this.glProgram,i);if(Array.isArray(r[i].value)){let a=t.createBuffer(),s=r[i].value;s!=null&&s.length>0&&(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW)),this.cacheAttrShaderPosition[i]={position_id:n,buffer:a,vertexPointer:r[i].vertexPointer}}else this.cacheAttrShaderPosition[i]={position_id:n,buffer:r[i].value,vertexPointer:r[i].vertexPointer}})}PreloadUniformProperties(t,r){let i=r.length;for(let n=0;n<i;n++){let a=t.getUniformLocation(this.glProgram,r[n]);a!=null&&(this.cacheUniformShaderPosition[r[n]]=a)}}PreloadUniformTexture(t,r){let i=r.length;for(let n=0;n<i;n++){let a=r[n],s=t.getUniformLocation(this.glProgram,r[n].id);if(s!=null){this.cacheUniformShaderPosition[r[n].id]=s;let o=this.id+r[n].id,l=r[n].texture===void 0?o:r[n].texture;if(this.glResource.SaveGLTextureSource(o,l,s),!this.glResource.glGlobalTextureCache.containsKey(l)){let h=a.textureBuffer==null?t.createTexture():a.textureBuffer,c=this.glResource.SaveGlobalTextureSource(l,h,t.TEXTURE0);t.activeTexture(c.globalIndex),t.bindTexture(t.TEXTURE_2D,h),a.textureBuffer==null&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),t.uniform1i(s,c.globalIndex-t.TEXTURE0),t.activeTexture(t.TEXTURE0)}}}}ExecuteAttributeProp(t,r,i,n){if(!(r in this.cacheAttrShaderPosition))return;let a=this.cacheAttrShaderPosition[r];if(!(a.position_id<0)){t.enableVertexAttribArray(a.position_id),t.bindBuffer(t.ARRAY_BUFFER,n==null?a.buffer:n),i!=null&&n==null&&t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW);var s=a.vertexPointer.size,o=a.vertexPointer.type,l=a.vertexPointer.normalize,h=0,c=0;t.vertexAttribPointer(a.position_id,s,o,l,h,c)}}ExecuteUniformProp(t,r,i,n=!1){if(!(t in this.cacheUniformShaderPosition))return;let a=this.cacheUniformShaderPosition[t];n?i(a,!1,r):i(a,r)}ExecuteUniformSprite(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}ExecuteUniformTex(t,r,i){let n=this.glResource.GetGLTextureSource(this.id+r,t.TEXTURE0);n!=null&&(t.activeTexture(n.globalType.globalIndex),t.bindTexture(t.TEXTURE_2D,n.globalType.texture),t.uniform1i(n.localType.uniformLocation,n.localType.localIndex))}},De=sr;var or=class{constructor(t,r){this._gl=t,this._webglResource=r,this._shaderCache={}}GetGlShaderSet(t){return t in this._shaderCache?this._shaderCache[t]:null}async LoadTextureToObject(t,r,i){let n=await this._webglResource.GetImage(i);t.SetCustomUniformAttr(r,{isMatrix:!1,value:n,function:this._gl.uniform1i})}async LoadAndPrepareShaders(t){if(t==null)return!1;let r=t.length;for(let i=0;i<r;i++)await this.LoadAndPrepareShader(t[i].id,t[i].vertex,t[i].fragment);return!0}async LoadAndPrepareShader(t,r,i){if(t in this._shaderCache)return this._shaderCache[t];let n=await this._webglResource.PrepareVFShaders(r,i),a=this.CreateShader(this._gl.VERTEX_SHADER,n.vertex_shader),s=this.CreateShader(this._gl.FRAGMENT_SHADER,n.fragment_shader),o={vertShader:a,fragShader:s};return this._shaderCache[t]=o,o}async CreateMaterialFromRawPath(t,r,i){let n=await this.LoadAndPrepareShader(t,r,i),a=this.CreateGLProgram(n.vertShader,n.fragShader);return new De(k(6),a,this._webglResource)}CreateMaterial(t,r){let i=this.CreateGLProgram(t,r);return new De(k(6),i,this._webglResource)}CreateShader(t,r){let i=this._gl,n=i.createShader(t);i.shaderSource(n,r),i.compileShader(n);var a=i.getShaderParameter(n,i.COMPILE_STATUS);return a?n:(i.deleteShader(n),null)}CreateGLProgram(t,r){let i=this._gl,n=i.createProgram();i.attachShader(n,t),i.attachShader(n,r),i.linkProgram(n);var a=i.getProgramParameter(n,i.LINK_STATUS);return a?n:(i.deleteProgram(n),null)}},lr=or;var hr=class{get vertCount(){return Math.round(this._meshData.vertexCount/3)}get meshData(){return this._meshData}constructor(t){this._meshData=t}SetVertex(t){this._meshData.vertex=t,this._meshData.nativeVertex=new Float32Array(t)}SetUV(t){this._meshData.uv=t,this._meshData.nativeUV=new Float32Array(t)}SetNormal(t){this._meshData.normal=t,this._meshData.nativeNormal=new Float32Array(t)}},cr=hr;function Ue(){let e=Va(),t=Fa(),r=Ba(),i=Ga();return{vertex:e,uv:t,normal:r,tangent:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(r),nativeUV:new Float32Array(t),nativeTangent:new Float32Array(i),vertexCount:e.length,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferTangent:null,glBufferUV:null}}function Va(){return[-1,-1,0,-1,1,0,1,-1,0,1,-1,0,-1,1,0,1,1,0]}function Fa(){return[0,0,0,1,1,0,1,0,0,1,1,1]}function Ba(){return[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}function Ga(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function Le(){let e=$a(),t=qa(6),r=fr([0,0,1],[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,-1]),i=fr([0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]);return{vertex:e,uv:t,normal:r,tangent:i,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:new Float32Array(e),nativeNormal:new Float32Array(r),nativeUV:new Float32Array(t),nativeTangent:new Float32Array(i),vertexCount:e.length,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferTangent:null,glBufferUV:null}}function $a(){return[-1,-1,1,-1,1,1,1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]}function qa(e){let t=[];for(let r=0;r<e;r++)t=t.concat([0,0,0,1,1,0,1,0,0,1,1,1]);return t}function fr(...e){let t=[];for(let r=0;r<e.length;r++){let i=[];for(let n=0;n<6;n++)i=i.concat(e[r]);t=t.concat(i)}return t}function Ne(){return{vertex:null,uv:null,normal:null,tangent:null,glUsageType:WebGLRenderingContext.STATIC_DRAW,nativeVertex:null,nativeNormal:null,nativeUV:null,nativeTangent:null,vertexCount:0,glBufferIndices:null,glBufferVertex:null,glBufferNormal:null,glBufferUV:null,glBufferTangent:null}}var X={Standard:"glprogram@standard_material",Unlit:"glprogram@unlit_material",StencilOutline:"glprogram@stencil_outline_material",DepthMap:"glprogram@depth_material"};var Oe={Quad:"mesh@quad",Cube:"mesh@cube",Null:"mesh@null"};var ur=class{constructor(){this.meshCache={}}CreateQuad(){return this.CreateAndCacehMeshType(Oe.Quad,Ue)}CreateCube(){return this.CreateAndCacehMeshType(Oe.Cube,Le)}CreateNull(t){return this.CreateAndCacehMeshType(t,Ne)}CreateAndCacehMeshType(t,r){if(t in this.meshCache)return this.meshCache[t];let i=r(),n=new cr(i);return this.meshCache[t]=n,n}},dr=ur;function Q(e){return{attributes:{a_vertex:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:3,type:e.FLOAT,normalize:!1}},a_uv:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:2,type:e.FLOAT,normalize:!1}},a_color:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!0}},a_normal:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:3,type:e.FLOAT,normalize:!0}},a_tangent:{value:[],drawType:WebGLRenderingContext.STATIC_DRAW,vertexPointer:{size:4,type:e.FLOAT,normalize:!0}}},uniforms:[y.time,y.mainColor,y.mainTex,y.modelMatrix,y.modelViewProjectionMatrix,y.inverseTransposeModelMatrix,y.directionLightColor,y.directionLightDir,y.ambientLightColor,y.lightSpaceMVPMatrix,y.depthMapTex_Texel,y.mainTex_Texel,y.cameraPos,y.specularLightStrength],texture:[{id:y.mainTex},{id:y.normalTex},{id:y.depthMapTexture,texture:y.depthMapTexture}],count:0}}var pr={up:M.fromValues(0,1,0),right:M.fromValues(1,0,0),forward:M.fromValues(0,0,1)},Xs=Object.freeze({Radian2Degree:180/Math.PI,Degree2Radian:Math.PI*180});var je=class{constructor(){this.cacheTVector={forward:M.create(),right:M.create(),top:M.create()}}UpdateTransformVector(t){return this.CalculateTransformVector(t,this.cacheTVector)}CalculateTransformVector(t,r){return r.forward=this.GetForward(t),r.right=this.GetRight(),r.top=this.GetUp(),r}GetTransformVector(){return this.cacheTVector}GetForward(t){return this.cacheTVector.forward[0]=Math.cos(t[0])*Math.cos(t[1]),this.cacheTVector.forward[1]=Math.sin(t[1]),this.cacheTVector.forward[2]=Math.sin(t[0])*Math.cos(t[1]),this.cacheTVector.forward}GetRight(){return M.cross(this.cacheTVector.right,pr.up,this.cacheTVector.forward),M.normalize(this.cacheTVector.right,this.cacheTVector.right)}GetUp(){return M.cross(this.cacheTVector.top,this.cacheTVector.forward,this.cacheTVector.right)}},vr=je;var ze=class{constructor(t,r,i){this.translateVector=M.create(),this.translateVectorX=M.create(),this.translateVectorY=M.create(),this.translateVectorZ=M.create(),this._position=t,this._rotation=r,this._scale=i,this._quaterion=$.create(),$.fromEuler(this._quaterion,r[0],r[1],r[2]),this._relativePosition=M.create(),this._relativeRotation=M.create(),this._relativeScale=M.create(),this._relativeQuaterion=$.create(),this._relativeModelMatrix=P.create(),this._preSaveRelativeModelMatrix=P.create(),this._modelMatrix=P.create(),this._inverseTransposeMatrix=P.create(),this.transformVector=new vr,this._parent=null,this._children=[]}get relativePosition(){return this._relativePosition}get relativeRotation(){return this._relativeRotation}get relativeScale(){return this._relativeScale}get position(){return this._position}get rotation(){return this._rotation}get scale(){return this._scale}get childCount(){return this.children.length}get children(){return this._children}get parent(){return this._parent}get InverseTransposeMatrix(){return P.invert(this._inverseTransposeMatrix,this._modelMatrix),P.transpose(this._inverseTransposeMatrix,this._inverseTransposeMatrix),this._inverseTransposeMatrix}get modelMatrix(){return this._modelMatrix}UpdateModelMatrix(){return this._parent==null?this.GetModelMatrix(this._position,this._scale,this._quaterion,this._modelMatrix):(this.GetModelMatrix(this._relativePosition,this._relativeScale,this._relativeQuaterion,this._relativeModelMatrix),P.mul(this._modelMatrix,this._parent.modelMatrix,this._relativeModelMatrix),this.SetTransformByMatrix(this._position,this._quaterion,this._rotation,this._scale,this._modelMatrix),this._modelMatrix)}GetModelMatrix(t,r,i,n){return P.fromRotationTranslationScale(n,i,t,r)}Scale(t){this.parent==null?M.scale(this._scale,this._scale,t):M.scale(this._relativeScale,this._relativeScale,t)}Translate(t,r,i){this.parent==null?this.ExecuteTranslate(t,r,i,this.rotation,this._position):this.ExecuteTranslate(t,r,i,this._relativeRotation,this._relativePosition)}SetPosition(t,r,i){this.parent==null?M.set(this._position,t,r,i):M.set(this._relativePosition,t,r,i)}ExecuteTranslate(t,r,i,n,a){let s=this.transformVector.UpdateTransformVector(n);M.scale(this.translateVectorX,s.right,t),M.scale(this.translateVectorY,s.top,r),M.scale(this.translateVectorZ,s.forward,i),M.add(this.translateVector,this.translateVectorX,this.translateVectorY),M.add(this.translateVector,this.translateVector,this.translateVectorZ),M.add(a,a,this.translateVector)}Rotate(t,r,i){this.parent==null?this.ExecuteRotate(t,r,i,this._quaterion):this.ExecuteRotate(t,r,i,this._relativeQuaterion)}SetEuler(t,r,i){this.parent==null?this.ExecuteEuler(t,r,i,this._quaterion,this._rotation):this.ExecuteEuler(t,r,i,this._relativeQuaterion,this._relativeRotation)}ExecuteRotate(t,r,i,n){$.rotateX(n,n,t),$.rotateY(n,n,r),$.rotateZ(n,n,i)}ExecuteEuler(t,r,i,n,a){a[0]=t,a[1]=r,a[2]=i,$.fromEuler(n,t,r,i)}UpdateRelativeTransformByParent(t){if(t==null){this.SetTransformByMatrix(this._position,this._quaterion,this._rotation,this._scale,this._modelMatrix);return}let r=this.GetModelMatrix(this._position,this._scale,this._quaterion,this.modelMatrix),i=P.create();P.invert(i,t.UpdateModelMatrix()),P.mul(this._preSaveRelativeModelMatrix,i,r),this.SetTransformByMatrix(this._relativePosition,this._relativeQuaterion,this._relativeRotation,this._relativeScale,this._preSaveRelativeModelMatrix)}SetTransformByMatrix(t,r,i,n,a){t=P.getTranslation(t,a),r=P.getRotation(r,a),i=Xt(r),n=P.getScaling(n,a)}SetParent(t){this._parent=t,t!=null&&(this.parent!=null&&this.parent.RemoveChildren(this),t.AppendChild(this),this.UpdateRelativeTransformByParent(t))}AppendChild(t){this._children.findIndex(i=>i==t)<0&&this._children.push(t)}RemoveChildren(t){let r=this._children.findIndex(i=>i==t);r>=0&&this._children.splice(r,1)}};function mr(){let e=M.create(),t=M.create(),r=M.fromValues(1,1,1);return new ze(e,t,r)}var Ve=ze;var Fe=class{constructor(){this.id="",this.name="NoName",this.transform=mr()}},Y=Fe;var xr=class extends Y{constructor(t,r,i){super();this.transform=t,this.mesh=r,this.material=i,this.modelViewProjectionMatrix=P.create(),this.matUniformAttributes={}}SetMesh(t){this.mesh=t}SetCustomUniformAttrs(t){this.matUniformAttributes=t}SetCustomUniformAttr(t,r){this.matUniformAttributes[t]=r}GetMVPMatrix(t,r){let i=P.mul(this.modelViewProjectionMatrix,t,this.transform.modelMatrix);return P.mul(this.modelViewProjectionMatrix,r,i)}ProcessMaterialAttr(t,r){r.ExecuteAttributeProp(t,y.vertex,this.mesh.meshData.nativeVertex,this.mesh.meshData.glBufferVertex),r.ExecuteAttributeProp(t,y.uv,this.mesh.meshData.nativeUV,this.mesh.meshData.glBufferUV),r.ExecuteAttributeProp(t,y.normal,this.mesh.meshData.nativeNormal,this.mesh.meshData.glBufferNormal),r.ExecuteAttributeProp(t,y.tangent,this.mesh.meshData.nativeTangent,this.mesh.meshData.glBufferTangent)}ProcessMaterialUniform(t,r,i,n,a,s,o,l,h,c){r.ExecuteUniformProp(y.time,i,t.uniform1f.bind(t)),r.ExecuteUniformProp(y.modelMatrix,n,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(y.inverseTransposeModelMatrix,a,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(y.modelViewProjectionMatrix,s,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(y.cameraPos,o,t.uniform3fv.bind(t)),l!=null&&(r.ExecuteUniformProp(y.directionLightDir,l.directionLigth.transform.transformVector.GetTransformVector().forward,t.uniform3fv.bind(t)),r.ExecuteUniformProp(y.directionLightColor,l.directionLigth.color,t.uniform4fv.bind(t)),r.ExecuteUniformProp(y.lightSpaceMVPMatrix,l.directionLigth.projection.spaceMatrix,t.uniformMatrix4fv.bind(t),!0),r.ExecuteUniformProp(y.ambientLightColor,l.ambient_light,t.uniform4fv.bind(t))),h!=null&&(r.ExecuteUniformTex(t,y.depthMapTexture,h),r.ExecuteUniformProp(y.depthMapTex_Texel,c,t.uniform2fv.bind(t)),Object.keys(this.matUniformAttributes).forEach(u=>{if(this.matUniformAttributes[u].value instanceof HTMLImageElement){let f=this.matUniformAttributes[u].value;r.ExecuteUniformSprite(t,u,this.matUniformAttributes[u].value),r.ExecuteUniformProp(y.mainTex_Texel,z.fromValues(1/f.width,1/f.height),t.uniform2fv.bind(t))}else r.ExecuteUniformProp(u,this.matUniformAttributes[u].value,this.matUniformAttributes[u].function.bind(t),this.matUniformAttributes[u].isMatrix)}),this.matUniformAttributes={})}},xe=xr;var Be=class extends xe{constructor(t,r,i,n){super(t,r,i);this.gltfModel=n}},Mr=Be;var yr=e=>Me(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]),ka=(e,t)=>{let r=re();_e(r,ve(t[0],t[1],t[2],t[3])),fe(e,r,e)},H=function(e,t,r,i){function n(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function o(c){try{h(i.next(c))}catch(u){s(u)}}function l(c){try{h(i.throw(c))}catch(u){s(u)}}function h(c){c.done?a(c.value):n(c.value).then(o,l)}h((i=i.apply(e,t||[])).next())})},Xa={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ge;(function(e){e[e.Float=5126]="Float",e[e.Short=5123]="Short"})(Ge||(Ge={}));var Wa=(e,t)=>H(void 0,void 0,void 0,function*(){let r=e.split("/").slice(0,-1).join("/");return yield(yield fetch(`${r}/${t}`)).arrayBuffer()}),le=(e,t)=>H(void 0,void 0,void 0,function*(){return new Promise(r=>{let i=new Image;i.onload=()=>{let n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);let a=e.getExtension("EXT_texture_filter_anisotropic");if(a){let s=e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT);e.texParameterf(e.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,s)}e.generateMipmap(e.TEXTURE_2D),r(n)},i.src=t})}),he=(e,t,r)=>{let i=e.bufferViews[r.bufferView],n=Xa[r.type],a=r.componentType,s=r.type,o=a==Ge.Float?new Float32Array(t[i.buffer],(r.byteOffset||0)+(i.byteOffset||0),r.count*n):new Int16Array(t[i.buffer],(r.byteOffset||0)+(i.byteOffset||0),r.count*n);return{size:n,data:o,type:s,componentType:a}},Tr=(e,t,r)=>{let i=t.primitives[0].attributes[r];return e.accessors[i]},Z=(e,t,r,i,n)=>{if(i.primitives[0].attributes[n]===void 0)return null;let a=Tr(t,i,n),s=he(t,r,a),o=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,s.data,e.STATIC_DRAW),{buffer:o,size:s.size,type:s.componentType}},Ka=(e,t)=>{let r=re();return t.translation!==void 0&&ye(r,r,t.translation),t.rotation!==void 0&&ka(r,t.rotation),t.scale!==void 0&&Te(r,r,t.scale),t.matrix!==void 0&&yr(t.matrix),{id:e,name:t.name,children:t.children||[],localBindTransform:r,animatedTransform:re(),skin:t.skin,mesh:t.mesh}},Qa=(e,t,r)=>{let i=t.channels.map(a=>{let s=t.samplers[a.sampler],o=he(e,r,e.accessors[s.input]),l=he(e,r,e.accessors[s.output]);return{node:a.target.node,type:a.target.path,time:o,buffer:l,interpolation:s.interpolation?s.interpolation:"LINEAR"}}),n={};return i.forEach(a=>{n[a.node]===void 0&&(n[a.node]={translation:[],rotation:[],scale:[]});for(let s=0;s<a.time.data.length;s++){let o=a.interpolation==="CUBICSPLINE"?a.buffer.size*3:a.buffer.size,l=a.interpolation==="CUBICSPLINE"?a.buffer.size:0,h=a.type==="rotation"?ve(a.buffer.data[s*o+l],a.buffer.data[s*o+l+1],a.buffer.data[s*o+l+2],a.buffer.data[s*o+l+3]):q(a.buffer.data[s*o+l],a.buffer.data[s*o+l+1],a.buffer.data[s*o+l+2]);n[a.node][a.type].push({time:a.time.data[s],transform:h,type:a.type})}}),n},Ya=(e,t,r,i)=>{let n=null,a=0;if(r.primitives[0].indices!==void 0){let s=t.accessors[r.primitives[0].indices],o=he(t,i,s);n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o.data,e.STATIC_DRAW),a=o.data.length}else a=Tr(t,r,"POSITION").count;return{indices:n,elementCount:a,positions:Z(e,t,i,r,"POSITION"),normals:Z(e,t,i,r,"NORMAL"),tangents:Z(e,t,i,r,"TANGENT"),texCoord:Z(e,t,i,r,"TEXCOORD_0"),joints:Z(e,t,i,r,"JOINTS_0"),weights:Z(e,t,i,r,"WEIGHTS_0"),material:r.primitives[0].material}},Ha=(e,t,r,i)=>H(void 0,void 0,void 0,function*(){let n=r.split("/").slice(0,-1).join("/"),a=null,s=null,o=null,l=null,h=null,c=ne(1,1,1,1),u=0,f=1,d=q(1,1,1),p=t.pbrMetallicRoughness;if(p){if(p.baseColorTexture){let m=i[p.baseColorTexture.index].uri;a=yield le(e,`${n}/${m}`)}if(p.baseColorFactor&&(c=ne(p.baseColorFactor[0],p.baseColorFactor[1],p.baseColorFactor[2],p.baseColorFactor[3])),p.metallicRoughnessTexture){let m=i[p.metallicRoughnessTexture.index].uri;s=yield le(e,`${n}/${m}`)}f=p.metallicFactor!==void 0?p.metallicFactor:1,u=p.roughnessFactor!==void 0?p.roughnessFactor:1}if(t.emissiveTexture){let m=i[t.emissiveTexture.index].uri;o=yield le(e,`${n}/${m}`)}if(t.normalTexture){let m=i[t.normalTexture.index].uri;l=yield le(e,`${n}/${m}`)}if(t.occlusionTexture){let m=i[t.occlusionTexture.index].uri;h=yield le(e,`${n}/${m}`)}return t.emissiveFactor&&(d=q(t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2])),{baseColorTexture:a,baseColorFactor:c,metallicRoughnessTexture:s,metallicFactor:f,roughnessFactor:u,emissiveTexture:o,emissiveFactor:d,normalTexture:l,occlusionTexture:h}}),_r=(e,t)=>H(void 0,void 0,void 0,function*(){var r;let n=yield(yield fetch(t)).json();if(n.accessors===void 0||n.accessors.length===0)throw new Error("GLTF File is missing accessors");let a=yield Promise.all(n.buffers.map(p=>H(void 0,void 0,void 0,function*(){return yield Wa(t,p.uri)}))),s=n.scenes[n.scene||0],o=n.meshes.map(p=>Ya(e,n,p,a)),l=n.materials?yield Promise.all(n.materials.map(p=>H(void 0,void 0,void 0,function*(){return yield Ha(e,p,t,n.images)}))):[],h=s.nodes[0],c=n.nodes.map((p,m)=>Ka(m,p)),u={};(r=n.animations)===null||r===void 0||r.forEach(p=>u[p.name]=Qa(n,p,a));let f=n.skins?n.skins.map(p=>{let m=he(n,a,n.accessors[p.inverseBindMatrices]),v=p.joints.map((x,A)=>yr(m.data.slice(A*16,A*16+16)));return{joints:p.joints,inverseBindTransforms:v}}):[];return{name:t.split("/").slice(-1)[0],meshes:o,nodes:c,rootNode:h,animations:u,skins:f,materials:l}});var $e=class{constructor(t){this.gl=t}async LoadAsset(t){return await _r(this.gl,t)}},gr=$e;var Er=class{constructor(t,r,i){this._gl=t,this._materialManager=r,this._meshManager=i,this.gltfImporter=new gr(t)}Build(t,r,i){let n=new Ve(M.create(),M.create(),M.fromValues(1,1,1)),a=new xe(n,r,i);a.name=t,a.id=k(11);let s=Q(this._gl);return s.attributes[y.vertex].value=r.meshData.vertex,s.attributes[y.uv].value=r.meshData.uv,s.attributes[y.normal].value=r.meshData.normal,i.PreloadProperties(this._gl,s),a}BuildQuad(){let t=this._meshManager.CreateQuad(),r=this._materialManager.GetGlShaderSet(X.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Quad",t,i)}BuildCube(){let t=this._meshManager.CreateCube(),r=this._materialManager.GetGlShaderSet(X.Standard),i=this._materialManager.CreateMaterial(r.vertShader,r.fragShader);return this.Build("Cube",t,i)}async BuildGLTFShape(t,r){let i=await this.gltfImporter.LoadAsset(r);console.log(i);let n=i.meshes[0],a=this._meshManager.CreateNull(t);a.meshData.vertexCount=n.elementCount*3,a.meshData.glBufferIndices=n.indices,a.meshData.glBufferVertex=n.positions.buffer,a.meshData.glBufferNormal=n.normals.buffer,a.meshData.glBufferUV=n.texCoord.buffer;let s=this._materialManager.GetGlShaderSet(X.Standard),o=this._materialManager.CreateMaterial(s.vertShader,s.fragShader),l=new Ve(M.create(),M.create(),M.fromValues(1,1,1)),h=new Mr(l,a,o,i);h.name=i.name,h.id=t;let c=Q(this._gl);return c.attributes[y.vertex].value=n.positions.buffer,c.attributes[y.uv].value=n.texCoord.buffer,c.attributes[y.normal].value=n.normals.buffer,c.attributes[y.tangent].value=n.tangents.buffer,i.materials.length>0&&(i.materials[0].baseColorTexture!=null&&(c.texture[0].textureBuffer=i.materials[0].baseColorTexture),i.materials[0].normalTexture!=null&&(c.texture[1].textureBuffer=i.materials[0].normalTexture)),h.SetCustomUniformAttr("u_mainColor",{value:[1,1,1,1],isMatrix:!1,function:this._gl.uniform4fv}),o.PreloadProperties(this._gl,c),h}},Sr=Er;var J;(function(e){e[e.Orthographic=0]="Orthographic",e[e.Perspective=1]="Perspective"})(J||(J={}));var ce=class{constructor(t,r){this.farClipPoint=15,this.nearClipPoint=.3,this._foxyPerspective=60,this._sizeOrtho=3,this.transform=t,this.lookUpPoint=M.create(),this.upDirMatrix=M.fromValues(0,1,0),this._viewMatrix=P.create(),this._projectionMatrix=P.create(),this._spaceMatrix=P.create(),this.projectionType=r}get projectionMatrix(){return this._projectionMatrix}get viewMatrix(){let t=this.transform.transformVector.UpdateTransformVector(this.transform.rotation);return M.add(this.lookUpPoint,this.transform.position,t.forward),P.lookAt(this._viewMatrix,this.transform.position,this.lookUpPoint,this.upDirMatrix)}get spaceMatrix(){return P.mul(this._spaceMatrix,this.projectionMatrix,this.viewMatrix)}set projectionType(t){this._projectionType=t,this.UpdateProjectionMatrix()}set aspectRatio(t){this._aspectRatio=t,this.UpdateProjectionMatrix()}set sizeOrtho(t){this._sizeOrtho=t,this.UpdateProjectionMatrix()}set foxyPerspective(t){this._foxyPerspective=t,this.UpdateProjectionMatrix()}UpdateProjectionMatrix(){return this._projectionType==0?this._projectionMatrix=this.GetOrthographicMatrix(-this._sizeOrtho*this._aspectRatio,this._sizeOrtho*this._aspectRatio,-this._sizeOrtho,this._sizeOrtho,this.nearClipPoint,this.farClipPoint):this._projectionMatrix=this.GetPerspectiveMatrix(this._foxyPerspective,this._aspectRatio,this.nearClipPoint,this.farClipPoint),this._projectionMatrix}GetOrthographicMatrix(t,r,i,n,a,s){return P.ortho(this._projectionMatrix,t,r,i,n,a,s)}GetPerspectiveMatrix(t,r,i,n){return t=t*(Math.PI/180),P.perspective(this._projectionMatrix,t,r,i,n)}};var Ar=class extends Y{constructor(){super();this.id=k(8),this.name="MainCamera",this.transform.SetEuler(1.5*Math.PI,0,0),this.projection=new ce(this.transform,J.Perspective)}},wr=Ar;var qe=class extends Y{constructor(){super();this.cachePosition=M.create(),this.color=ie.fromValues(1,1,1,1),this.offsetPostion=M.fromValues(3,9,3),this.transform.SetEuler(Math.PI*.3,Math.PI*1.35,0),this.transform.transformVector.UpdateTransformVector(this.transform.rotation),this.projection=new ce(this.transform,J.Orthographic),this.projection.sizeOrtho=6}},Rr=qe;var ke=class{constructor(){this.directionLigth=new Rr,this.ambient_light=ie.fromValues(.3,.3,.3,1)}SyncLightRelativePosToCamera(t){M.add(this.directionLigth.cachePosition,this.directionLigth.offsetPostion,t.position),this.directionLigth.transform.SetPosition(this.directionLigth.cachePosition[0],this.directionLigth.offsetPostion[1],this.directionLigth.cachePosition[2])}},Pr=ke;var Cr=class{get shapeArray(){return this._shapeArray}constructor(){this._shapeArray=[],this.camera=new wr,this.lights=new Pr}AddShapeObj(t){this._shapeArray.push(t)}RemoveShapeObj(t){let r=this._shapeArray.findIndex(i=>i.id==t);r>=0&&this._shapeArray.splice(r,1)}SetParent(t,r){if(r.transform.SetParent(t.transform),t==null)return;let i=this._shapeArray.findIndex(n=>n.id==t.id);i>=0&&(this.RemoveShapeObj(r.id),this._shapeArray.splice(i+1,0,r))}},Ir=Cr;var br=class{get depthMapTex(){return this._depthMapTex}get colorDepthMapTex(){return this._colorDepthMapTex}get depthFrameBuffer(){return this._depthFrameBuffer}get depthMaterial(){return this._depthMaterial}get stencilOutlineMaterial(){return this._stencilOutlineMaterial}constructor(t,r,i){this.gl=t,this.webglResouceAlloc=r,this.materialManager=i}CacheDepthMaterial(){let t=this.materialManager.GetGlShaderSet(X.DepthMap);this._depthMaterial=this.materialManager.CreateMaterial(t.vertShader,t.fragShader);let r=Q(this.gl);this._depthMaterial.PreloadProperties(this.gl,r)}CacheStencilOutlineMaterial(){let t=this.materialManager.GetGlShaderSet(X.StencilOutline);this._stencilOutlineMaterial=this.materialManager.CreateMaterial(t.vertShader,t.fragShader);let r=Q(this.gl);this._stencilOutlineMaterial.PreloadProperties(this.gl,r)}PrepareDepthFrameBuffer(t,r){let i=this.gl;this._colorDepthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.RGBA,i.UNSIGNED_BYTE,null),this._depthMapTex=this.webglResouceAlloc.CreateGLTexture(i,t,r,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null),this._depthFrameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._depthFrameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this._colorDepthMapTex,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,this._depthMapTex,0),this.webglResouceAlloc.SaveGlobalTextureSource(y.depthMapTexture,this._depthMapTex,i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}},Dr=br;var Ur=class extends Ht{constructor(t){super(t);this.previousTimeStamp=0,this.targetTextureWidth=512,this.targetTextureHeight=512,this.targetTextureTexel=z.fromValues(1/this.targetTextureWidth,1/this.targetTextureHeight),this.configJson=t,this.webglResouceAlloc=new ar,this.materialManager=new lr(this._gl,this.webglResouceAlloc),this.meshManager=new dr,this.shapeBuilder=new Sr(this._gl,this.materialManager,this.meshManager),this.webglDepthBuffer=new Dr(this._gl,this.webglResouceAlloc,this.materialManager),this.scene=new Ir}get isKatachiValid(){return this._gl!=null}async SetUp(t){return this.isKatachiValid?(this.UpdateLoopCallback=t,await this.materialManager.LoadAndPrepareShaders(this.configJson.shaders),this.webglDepthBuffer.PrepareDepthFrameBuffer(this.targetTextureWidth,this.targetTextureHeight),this.webglDepthBuffer.CacheDepthMaterial(),this.webglDepthBuffer.CacheStencilOutlineMaterial(),window.requestAnimationFrame(this.PerformGameLoop.bind(this)),!0):!1}PerformGameLoop(t){let r=(t-this.previousTimeStamp)/1e3;this.time=t/1e3,this.previousTimeStamp=t,this.UpdateLoopCallback!=null&&this.UpdateLoopCallback(this.time),this.scene.lights!=null&&this.time%.5>.45&&this.scene.lights.SyncLightRelativePosToCamera(this.scene.camera.transform),this._gl.stencilOp(this._gl.KEEP,this._gl.KEEP,this._gl.REPLACE),this.DrawCanvas(this.webglDepthBuffer.depthFrameBuffer,this.webglDepthBuffer.depthMaterial,this.scene.lights.directionLigth.projection,this.targetTextureWidth,this.targetTextureHeight),this.DrawCanvas(null,null,this.scene.camera.projection,this._gl.canvas.width,this._gl.canvas.height),window.requestAnimationFrame(this.PerformGameLoop.bind(this))}DrawCanvas(t,r,i,n,a){let s=this._gl;this.currentFrameBuffer=t,s.bindFramebuffer(s.FRAMEBUFFER,t),s.viewport(0,0,n,a),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT),i.aspectRatio=n/a;let o=i.viewMatrix,l=i.projectionMatrix;for(var h in this.scene.shapeArray){let c=this.scene.shapeArray[h];this.ProcessShapeObject(c,o,l,r)}}ProcessShapeObject(t,r,i,n){let a=n==null?t.material:n;this._gl.useProgram(a.glProgram),t.transform.UpdateModelMatrix();let s=t.GetMVPMatrix(r,i);t.ProcessMaterialAttr(this._gl,a),t.ProcessMaterialUniform(this._gl,a,this.time,t.transform.modelMatrix,t.transform.InverseTransposeMatrix,s,this.scene.camera.transform.position,this.scene.lights,this.currentFrameBuffer==null?this.webglDepthBuffer.depthMapTex:null,this.targetTextureTexel);var o=this._gl.TRIANGLES,l=0,h=t.mesh.vertCount;t.mesh.meshData.glBufferIndices?(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.mesh.meshData.glBufferIndices),this._gl.drawElements(o,h,this._gl.UNSIGNED_SHORT,0)):t.mesh.meshData.glBufferIndices==null&&this._gl.drawArrays(o,l,h)}},Lr=Ur;window.onload=()=>{let e=fetch("./Dataset/katachi_basic_layout.json"),t=fetch("./Dataset/sample_scene_layout.json");Promise.all([e,t]).then(r=>Promise.all(r.map(i=>i.json()))).then(function(r){let i=new Lr(r[0]);new Qt().SetUp(i,r[1])})};
//# sourceMappingURL=index.js.map
